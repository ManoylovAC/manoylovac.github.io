<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><meta data-react-helmet="true" name="description" content="У 1982 році Вільям Т. Рівз, дослідник із Lucasfilm Ltd., працював над фільмом Зоряний шлях 2: Гнів Хана. Значна частина фільму обертається навколо при"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://natureofcode.com"/><meta data-react-helmet="true" property="og:image" content="https://natureofcode.com/static/7dd3422c43faa1513528cd25636d9e6b/b08a9/cover.png"/><meta data-react-helmet="true" property="og:title" content="4. Системи частинок"/><meta data-react-helmet="true" property="og:description" content="У 1982 році Вільям Т. Рівз, дослідник із Lucasfilm Ltd., працював над фільмом Зоряний шлях 2: Гнів Хана. Значна частина фільму обертається навколо при"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="4. Системи частинок"/><meta data-react-helmet="true" name="twitter:description" content="У 1982 році Вільям Т. Рівз, дослідник із Lucasfilm Ltd., працював над фільмом Зоряний шлях 2: Гнів Хана. Значна частина фільму обертається навколо при"/><meta data-react-helmet="true" name="twitter:image" content="https://natureofcode.com/static/7dd3422c43faa1513528cd25636d9e6b/b08a9/cover.png"/>

    <link rel="stylesheet" href="./assets/styles/global.css">

    <noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="./favicon-32x32.png" type="image/png"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><title data-react-helmet="true">4. Системи частинок / Nature of Code</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="fixed left-0 right-0 top-0 z-40 bg-white px-6 lg:px-8"><div class="mx-auto flex h-[5em] max-w-6xl items-center justify-between"><div class="flex flex-col gap-x-6 lg:flex-row lg:items-center"><a href="./"><span class="text-lg font-black tracking-widest text-noc-400"><span class="font-black">ПРИРОДА</span> КОДУ</span></a><span class="hidden text-sm tracking-widest text-noc-400 xl:block">ДАНІЕЛЬ ШИФФМАН</span></div><button class="flex h-9 w-11 cursor-pointer flex-col items-center justify-between p-2 lg:hidden" aria-label="Toggle menu" title="Toggle menu"><span class="block h-0.5 w-full rounded bg-noc-200 transition-transform"></span><span class="block h-0.5 w-full rounded bg-noc-200 transition-opacity" style="opacity:1"></span><span class="block h-0.5 w-full rounded bg-noc-200 transition-transform"></span></button><div class="hidden items-center gap-6 lg:flex"><ul class="flex items-center gap-6"><li><a href="https://github.com/sponsors/CodingTrain" class="flex items-center gap-1.5 text-sm text-gray-500 hover:underline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="text-noc-200" height="1.2em" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"></path></svg>SUPPORT</a></li><li><a href="https://github.com/nature-of-code/noc-book-2" class="flex items-center gap-1.5 text-sm text-gray-500 hover:underline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="text-noc-200" height="1.2em" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>GITHUB</a></li><li><a href="https://thecodingtrain.com/" class="flex items-center text-sm text-gray-500 hover:underline"><img src="./static/codingtrain_logo-53b0a841be45c7eac7a12f88b7bea596.png" alt="Coding Train&#x27;s logo" class="-ml-2 w-8"/>CODING TRAIN</a></li></ul><div class="not-prose flex items-center gap-4 undefined"><div class="relative"><a href="https://natureofcode.com/" target="_blank" class="flex items-center text-sm text-gray-500 hover:underline"><img src="./favicon-32x32.png" alt="The Nature Of Code logo" class="noc2-logo"/>THE NATURE OF CODE</a></div></div></div></div></header>
    <nav class="fixed bottom-0 left-0 right-0 top-[5em] z-20 overflow-y-auto bg-white px-6 lg:hidden mb-menu hidden">
        <ul class="my-7 space-y-2">
            <li><a class="text-lg text-gray-800" href="./dedication.html">Присвята</a></li>
            <li><a class="text-lg text-gray-800" href="./acknowledgements.html">Подяки</a></li>
            <li><a class="text-lg text-gray-800" href="./introduction.html">Вступ</a></li>
            <li>
                <button class="sub-menu-btn flex items-center gap-2 text-lg text-gray-800">
                    <span>Розділи</span>
                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 transition-transform" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" style="transform: scaleY(1);"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </button>
                <ul class="space-y-2 py-2 pl-4 sub-menu hidden">
                    <li><a class="flex items-center text-gray-600" href="./random.html"><span class="w-8">0</span><span>Випадковість</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./vectors.html"><span class="w-8">1</span><span>Вектори</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./forces.html"><span class="w-8">2</span><span>Сили</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./oscillation.html"><span class="w-8">3</span><span>Коливання</span></a></li>
                    <li><a aria-current="page" class="flex items-center text-gray-600 font-bold" href="./particles.html"><span class="w-8">4</span><span>Система частинок</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./autonomous-agents.html"><span class="w-8">5</span><span>Автономні агенти</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./physics-libraries.html"><span class="w-8">6</span><span>Фізичні бібліотеки</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./cellular-automata.html"><span class="w-8">7</span><span>Клітинні автомати</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./fractals.html"><span class="w-8">8</span><span>Фрактали</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./genetic-algorithms.html"><span class="w-8">9</span><span>Еволюційне моделювання</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./neural-networks.html"><span class="w-8">10</span><span>Нейронні мережі</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./neuroevolution.html"><span class="w-8">11</span><span>Нейроеволюція</span></a></li>
                </ul>
            </li>
            <li><a class="text-lg text-gray-800" href="./appendix-creature.html">Додаток: Дизайн створінь</a></li>
            <li><a class="text-lg text-gray-800" href="./resources.html">Додаткові ресурси</a></li>
            <li><a class="text-lg text-gray-800" href="./credits.html">Credits</a></li>
            <li><a class="text-lg text-gray-800" href="./translation.html">Про переклад</a></li>
            <li><a class="text-lg text-gray-800" href="./examples.html">Приклади</a></li>
        </ul>
        <ul class="my-7 space-y-2">
            <li><a target="_blank" href="https://github.com/sponsors/CodingTrain" class="flex items-center gap-1 text-lg text-gray-800">Support<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>
            <li><a target="_blank" href="https://github.com/nature-of-code/noc-book-2" class="flex items-center gap-1 text-lg text-gray-800">GitHub<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>
            <li><a target="_blank" href="https://thecodingtrain.com/" class="flex items-center gap-1 text-lg text-gray-800">Coding Train<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>

            <li><a target="_blank" href="https://natureofcode.com/" class="flex items-center gap-1 text-lg text-gray-800">The Nature Of Code<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>
        </ul>
    </nav>
    <div class="mt-[6em] px-6 lg:px-8"><div class="mx-auto max-w-6xl lg:flex lg:justify-between lg:gap-10 xl:gap-14"><aside class="sticky top-[6em] z-10 hidden max-h-[calc(100vh-6em)] min-w-[14em] overflow-y-auto pb-8 lg:block lg:flex-grow"><nav class="border-noc-200 rounded-3xl border"><ul class="divide-noc-200 divide-y"><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./dedication.html">Присвята</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./acknowledgements.html">Подяки</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./introduction.html">Вступ</a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./random.html"><span class="w-8">0</span><span class="group-hover:underline">Випадковість</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./vectors.html"><span class="w-8">1</span><span class="group-hover:underline">Вектори</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./forces.html"><span class="w-8">2</span><span class="group-hover:underline">Сили</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./oscillation.html"><span class="w-8">3</span><span class="group-hover:underline">Коливання</span></a></li><li><a aria-current="page" class="group relative flex items-center px-3 py-2 text-sm font-bold" href="./particles.html"><span class="w-8">4</span><span class="group-hover:underline">Системи частинок</span></a><ul class="space-y-1 pb-2"><li><a href="#why-particle-systems-matter" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Чому системи частинок важливі</a></li><li><a href="#a-single-particle" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Окрема частинка</a></li><li><a href="#an-array-of-particles" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Масив частинок</a></li><li><a href="#a-particle-emitter" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Емітер частинок</a></li><li><a href="#a-system-of-emitters" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Система емітерів</a></li><li><a href="#inheritance-and-polymorphism" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Наслідування і поліморфізм</a></li><li><a href="#particle-systems-with-forces" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Системи частинок із силами</a></li><li><a href="#particle-systems-with-repellers" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Системи частинок із відштовхувачами</a></li><li><a href="#image-textures-and-additive-blending" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Текстури зображення й адитивне змішування</a></li></ul></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./autonomous-agents.html"><span class="w-8">5</span><span class="group-hover:underline">Автономні агенти</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./physics-libraries.html"><span class="w-8">6</span><span class="group-hover:underline">Фізичні бібліотеки</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./cellular-automata.html"><span class="w-8">7</span><span class="group-hover:underline">Клітинні автомати</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./fractals.html"><span class="w-8">8</span><span class="group-hover:underline">Фрактали</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./genetic-algorithms.html"><span class="w-8">9</span><span class="group-hover:underline">Еволюційне моделювання</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./neural-networks.html"><span class="w-8">10</span><span class="group-hover:underline">Нейронні мережі</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./neuroevolution.html"><span class="w-8">11</span><span class="group-hover:underline">Нейроеволюція</span></a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./appendix-creature.html">Додаток: Дизайн створінь </a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./resources.html">Додаткові ресурси</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./credits.html">Credits</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./translation.html">Про переклад</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./examples.html">Приклади</a></li></ul></nav></aside><main class="prose mx-auto max-w-[50em] pb-8"><section data-type="chapter" id="section-particles">
<h1 id="chapter-4-particle-systems">Розділ 4. Системи частинок</h1>
<div class="chapter-opening-quote">
  <blockquote data-type="epigraph">
    <p>Це розумно. Якщо звернутися до логіки,</p>
    <p>вона чітко підказує, що потреби багатьох</p>
    <p>переважають потреби кількох.</p>
    <div class="chapter-opening-quote-source">
      <p>— Спок</p>
    </div>
  </blockquote>
</div>
<div class="chapter-opening-figure">
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:3365px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1893&#x27; width=&#x27;3365&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/c6ec0b5d7ae10c7a0e2cca284681ff80/34293/04_particles_1.webp 841w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/6045a/04_particles_1.webp 1683w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/a44ac/04_particles_1.webp 3365w" sizes="(min-width: 3365px) 3365px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 3365px) 3365px, 100vw" decoding="async" loading="lazy" data-src="./static/c6ec0b5d7ae10c7a0e2cca284681ff80/11d5a/04_particles_1.png" data-srcset="./static/c6ec0b5d7ae10c7a0e2cca284681ff80/14ea3/04_particles_1.png 841w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/ea653/04_particles_1.png 1683w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/11d5a/04_particles_1.png 3365w" alt="Позитрон (фото Карла Д. Андерсона)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/c6ec0b5d7ae10c7a0e2cca284681ff80/34293/04_particles_1.webp 841w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/6045a/04_particles_1.webp 1683w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/a44ac/04_particles_1.webp 3365w" sizes="(min-width: 3365px) 3365px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 3365px) 3365px, 100vw" decoding="async" loading="lazy" src="./static/c6ec0b5d7ae10c7a0e2cca284681ff80/11d5a/04_particles_1.png" srcSet="./static/c6ec0b5d7ae10c7a0e2cca284681ff80/14ea3/04_particles_1.png 841w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/ea653/04_particles_1.png 1683w,./static/c6ec0b5d7ae10c7a0e2cca284681ff80/11d5a/04_particles_1.png 3365w" alt="Позитрон (фото Карла Д. Андерсона)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption></figcaption>
  </figure>
  <span id="positron-photo-by-carl-d-anderson"><a class="heading-link" href="#positron-photo-by-carl-d-anderson">Позитрон (фото Карла Д. Андерсона)</a></span>
  <p>Ця фотографія початку 20-го століття зроблена камерою Вільсона (або туманною камерою), вперше зафіксувала спостережуваний позитрон і дозволяє зазирнути у світ субатомних частинок. Хмарні камери — це пристрої, які роблять видимими траєкторії заряджених частинок, коли вони рухаються крізь перенасичену пару.</p>
<hr/></div>
<p>У 1982 році Вільям Т. Рівз, дослідник із Lucasfilm Ltd., працював над фільмом <em>Зоряний шлях 2: Гнів Хана</em>. Значна частина фільму обертається навколо пристрою Генезис — торпеди, якою можна вистрілити у безплідну планету, щоб реорганізувати її матерію і створити придатний для колонізації світ. У фільмі під час “тераформування” планетою пройшлась велика вогняна хвиля. Термін <strong>система частинок</strong> був придуманий при створенні саме цього конкретного ефекту і наразі являє собою надзвичайно поширену і корисну техніку у комп’ютерній графіці. Як сказав Рівз:</p>
<blockquote data-type="epigraph">
  <p><em>Система частинок — це сукупність багатьох дрібних частинок, які разом представляють нечіткий об’єкт. Протягом певного часу частинки генеруються у системі, рухаються і змінюються всередині неї та вмирають, зникаючи із системи.</em></p>
</blockquote>
<p>З початку 1980-х років системи частинок використовувалися у безлічі відеоігор, анімацій, творів цифрового мистецтва та інсталяцій для моделювання різноманітних нерегулярних природних явищ, таких як вогонь, дим, водоспади, туман, трава, бульбашки тощо.</p>
<p>Цей розділ присвячено розгляду стратегій програмування системи частинок і керування пов’язаними з нею даними. Як ви організуєте свій код? Де будете зберігати інформацію, пов’язану з окремими частинками та інформацію, що стосується системи в цілому? У прикладах, які я розгляну, для частинок використовуватимуться прості точки й застосовуватимуться лише найпростіші моделі поведінки. Однак ці характеристики не повинні обмежувати вашу уяву. Те, що системи частинок зазвичай виглядають як іскри, летять вперед чи падають під впливом гравітації, не означає, що ваша система також повинна мати такі характеристики. Спираючись на структуру цього розділу і додаючи більш творчі способи візуалізації частинок та обчислення їх поведінки, ви можете досягти різноманітних ефектів.</p>
<p>Іншими словами, фокус цього розділу полягає в тому <em>як</em> слідкувати за системою з багатьох елементів. Що ці елементи робитимуть і як вони виглядатимуть, залежить виключно від вас.</p>
<h2 id="why-particle-systems-matter"><a class="heading-link" href="#why-particle-systems-matter">Чому системи частинок важливі</a></h2>
<p>Система частинок — це сукупність незалежних об’єктів, часто представлених точками або іншими простими формами. Але чому це має значення? Звісно, перспектива моделювання деяких із перерахованих явищ є привабливою і потенційно корисною. Загалом, коли ви почнете розробляти складніші симуляції, ви, ймовірно, виявите, що працюєте з системами із <em>багатьма</em> об’єктами: групи з кульками, зграї птахів, еволюція екосистем, усілякі речі у множині. Обговорювані тут стратегії із системами частинок допоможуть вам у всіх цих ситуаціях.</p>
<p>Насправді майже кожен розділ, починаючи з цього, містить програми зі списками об’єктів, і це по суті саме те, що являє собою система частинок. Так, в деяких прикладах попередніх розділів, я вже використовував масиви. Але тепер настав час піти туди, куди раніше не заходив жоден масив (принаймні, у цій книзі).</p>
<p>По-перше, я хочу налаштувати гнучку кількість елементів. Деякі приклади можуть мати нуль речей, іноді одну річ, іноді десять речей, а інколи десять тисяч речей. По-друге, я хочу скористатися складнішим об’єктно-орієнтованим підходом. Окрім написання класу для опису окремої частинки, я також хочу написати клас, який описуватиме всю колекцію частинок — саму систему частинок. Мета полягає в можливості написати програму, яка виглядатиме якось так:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> system;
</code></pre><div class="comment"><p>Ах, хіба ця основна програма не проста і мила?</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">360</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  system = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParticleSystem</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  system.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>У цьому коді не згадується жодна частинка, але результат буде сповнений частинок, що літають по всьому полотну. Це працює, тому що деталі приховані всередині класу <code>ParticleSystem</code>, який містить у собі посилання на безліч екземплярів класу <code>Particle</code>. Звикання до цієї техніки написання програм із кількома класами, включаючи класи, які зберігають списки екземплярів інших класів, виявиться дуже корисним, коли ви дійдете до наступних розділів цієї книги.</p>
<p>Нарешті, робота з системами частинок — це також можливість використати ще дві складові ООП: наслідування (успадкування) і полім орфізм. У прикладах, які ви бачили дотепер, я завжди використовував масив одного типу об’єктів, як-от масив кульок або масив осциляторів. З успадкуванням і поліморфізмом я продемонструю зручний спосіб використання єдиного списку для зберігання об’єктів різних типів. Таким чином, система частинок вмітиме працювати з частинками різних типів.</p>
<h2 id="a-single-particle"><a class="heading-link" href="#a-single-particle">Окрема частинка</a></h2>
<p>Перш ніж я зможу розпочинати кодування самої системи частинок, мені потрібно написати клас для опису окремої частинки. Гарна новина: я це вже зробив! Клас <code>Mover</code> з <a href="/forces#section-forces">Розділу 2</a> слугує ідеальним шаблоном. Частинка — це незалежне тіло, яке рухається по полотну, тому як і об’єкт <code>Mover</code>, вона має властивості <code>position</code>, <code>velocity</code> і <code>acceleration</code>, конструктор для ініціалізації цих змінних й методи <code>show()</code> та <code>update()</code> для відображення себе та оновлення свого положення:</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Particle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>(x, y);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>();
  }
</code></pre><div class="comment"><p>Клас Particle – це просто інша назва для Mover. Він має положення, швидкість і прискорення.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">mult</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">fill</span>(<span class="hljs-number">175</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">circle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, <span class="hljs-number">8</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Це найпростіша частинка, наскільки можливо. Звідси я можу розвинути частинку у кількох напрямках. Я можу додати метод <code>applyForce()</code> для впливу на поведінку частинки (я ще зроблю це в майбутньому прикладі). Я також можу додати змінні для опису кольору і форми, або завантажити зображення <code>p5.Image</code>, щоб малювати частинку цікавішим способом. Однак наразі я зосереджусь лише на додаванні однієї додаткової деталі: <strong>тривалості життя</strong>.</p>
<p>Деякі системи частинок включають так званий <strong>емітер</strong>, який слугує джерелом частинок. Емітер (або інколи випромінювач) керує початковими налаштуваннями частинок: положенням, швидкістю тощо. Він може видавати одиничний викид частинок, безперервний потік або якусь варіацію цього. Нововведення полягає в тому, що частинки, народжені в емітері, не можуть існувати вічно. Якби вони існували постійно, то програма p5.js зрештою зупинилася б, оскільки число частинок з часом збільшиться до занадто громіздкої кількості. В міру народження нових частинок, старі необхідно видаляти, створюючи ілюзію нескінченного потоку частинок без шкоди для продуктивності програми.</p>
<p>Існує багато способів визначити, коли частинка готова до видалення. Наприклад, вона може “померти” при зіткненні з іншим об’єктом, або при виході за межі полотна. Наразі я вирішив нада ти частинкам змінну <code>lifespan</code>, яка діє як таймер. Він розпочнеться зі значення 255 і буде зменшуватися до 0 у міру роботи програми, після чого частинка вважатиметься мертвою. Ось доданий код у клас <code>Particle</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Particle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> = <span class="hljs-number">255</span>;
</code></pre><div class="comment"><p>Нова змінна для відстеження того, як до вго частинка була “живою”. Вона починається зі значення 255 і зменшується до 0.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> -= <span class="hljs-number">2.0</span>;
</code></pre><div class="comment"><p>Зменшення тривалості життя.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
    <span class="hljs-title function_">fill</span>(<span class="hljs-number">175</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
</code></pre><div class="comment"><p>Оскільки життя знаходиться у діапазоні від 255 до 0, його значення також можна використати для альфа-каналу (прозорості).</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">circle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, <span class="hljs-number">8</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Оскільки значення <code>lifespan</code> знаходиться у діапазоні від 255 до 0, його можна також використати для альфа-каналу кольору точки, що відповідатиме за прозорість частинки. Таким чином, коли частинка стане мертвою, вона буквально згасне.</p>
<p>З додаванням властивості <code>lifespan</code>, мені знадобиться ще один метод, який повертатиме <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">true</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span></span> або <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">false</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">se</span></span></span></span></span>, щоб визначити чи частинка вже мертва. Це стане у пригоді, коли я напишу окремий клас для керування списком частинок. Написати цей метод досить легко: мені просто потрібно перевірити, чи значення <code>lifespan</code> менше за 0. Якщо так, повертаємо <code>true</code>, інакше — <code>false</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">isDead</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> &lt; <span class="hljs-number">0.0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
</code></pre><div class="comment"><p>Частинка мертва чи жива?</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Навіть ще простіше, я можу просто повернути результат булевого виразу!</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">isDead</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> &lt; <span class="hljs-number">0.0</span>);
</code></pre><div class="comment"><p>Частинка мертва чи жива?</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Перш ніж перейти до наступного кроку зі створенням багатьох частинок, варто витратити пару хвилин, щоб переконатися, що частинка працює правильно. Для цього я створю програму із відображен ням одного об’єкта типу <code>Particle</code> за раз. Ось повний код із кількома невеликими доповненнями де частинці надається випадкова початкова швидкість, а також використовується метод <code>applyForce()</code> для імітації гравітації.</p>
<div data-type="example">
  <h3 id="example-41-a-single-particle"><a class="heading-link" href="#example-41-a-single-particle">Приклад 4.1: Окрема частинка</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_1_single_particle"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/1gpoE1dtG" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> particle;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">360</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  particle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  particle.<span class="hljs-title function_">update</span>();
  particle.<span class="hljs-title function_">show</span>();
</code></pre><div class="comment"><p>Дії окремої частинки.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> gravity = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
  particle.<span class="hljs-title function_">applyForce</span>(gravity);
</code></pre><div class="comment"><p>Застосування сили тяжіння.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">if</span> (particle.<span class="hljs-title function_">isDead</span>()) {
    particle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Particle dead!&quot;</span>);
  }
</code></pre><div class="comment"><p>Перевірка стану частинки і створення нової частинки.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Particle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x,y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> =  <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-title function_">random</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <span class="hljs-title function_">random</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">0</span>));
</code></pre><div class="comment"><p>Для демонстраційних цілей, частинка отримує випадкову швидкість.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> = <span class="hljs-number">255.0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> -= <span class="hljs-number">2.0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">mult</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">circle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, <span class="hljs-number">8</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyForce</span>(<span class="hljs-params">force</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">add</span>(force);
  }
</code></pre><div class="comment"><p>Використання того ж фізичного моделювання, що і у попередніх розділах.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">isDead</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> &lt; <span class="hljs-number">0.0</span>);
  }
</code></pre><div class="comment"><p>Перевірка стану частинки.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Для спрощення і тестування у цьому прикладі створюється лише одна частинка за раз. Кожного разу, коли частинка досягає кінця свого життя, змінна <code>particle</code> перезаписується новим екземпляром класу <code>Particle</code>. Це фактично замінює попередній об’єкт з частинкою. Важливо розуміти, що попередній об’єкт <code>Particle</code> не стільки видалено, скільки він більше не доступний або не використовується в коді. Програма, по суті, забуває про стару частинку і починає працювати зі щойно створеною.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-41"><a class="heading-link" href="#exercise-41">Вправа 4.1</a></h3>
  <p>У класі <code>Particle</code> створіть метод <code>run()</code>, який одночасно оброблятиме методи <code>update()</code>, <code>show()</code> і <code>applyForce()</code>, замість безпосереднього їх використання у функції <code>draw()</code>. Які переваги та недоліки цього підходу?</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-42"><a class="heading-link" href="#exercise-42">Вправа 4.2</a></h3>
  <p>Додайте кутову швидкість (обертання) до частинки й створіть частинку не круглої форми, щоб це обертання було видно.</p>
</div>
<h2 id="an-array-of-particles"><a class="heading-link" href="#an-array-of-particles">Масив частинок</a></h2>
<p>Тепер, коли у мене є клас для опису окремої частинки, настав час для наступного великого кроку: як я можу відстежувати багато частинок, точно не знаючи наперед, скільки їх може бути в будь-який момент? Відповідь — за допомогою масиву JavaScript, структури даних, яка зберігає довільно довгий список значень. У JavaScript масив є об’єктом, створеним із класу <code>Array</code>, який має багато вбудованих методів. Ці методи забезпечують всю необхідну функціональність для обслуговування списку об’єктів <code>Particle</code>, включаючи додавання частинок, видалення або інші маніпуляції із ними. Для відновлення знань про масиви, перегляньте відповідну <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="noopener">JavaScript документацію на сайті MDN Web Docs</a>.</p>
<p>З початком роботи із масивами, я використовуватиму рішення з вправи 4.1 і припускатиму існування методу <code>Particle.run()</code>, який керує всіма функціями окремої частинки. Хоча цей підхід також має деякі недоліки, він зробить подальші приклади коду більш лаконічними. Для початку я використаю цикл <code>for</code> у функції <code>setup()</code>, щоб заповнити масив частинками, а потім використаю інший цикл <code>for</code> у функції <code>draw()</code> для запуску кожної частинки:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> total = <span class="hljs-number">10</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> particles = [];
</code></pre><div class="comment"><p>Почнемо з порожнього масиву.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; total; i++) {
    particles[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(width / <span class="hljs-number">2</span>, height / <span class="hljs-number">2</span>);
  }
</code></pre><div class="comment"><p>Відомий вам спосіб доступу до елементів масиву за допомогою індексу т а квадратних дужок: [i].</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; particles.<span class="hljs-property">length</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> particle = particles[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Цикл <code>for</code> усередині <code>draw()</code> показує, як викликати метод для кожного елемента масиву, звертаючись до кожного його індексу. Я ініціалізую змінну <code>i</code> значенням <code>0</code> і поступово збільшую її на <code>1</code>, отримуючи доступ до кожного елемента масиву допоки <code>i</code> не досягне значення <code>particles.length</code> і  таким чином досягне кінця. Як виявляється, є ще кілька способів зробити те ж саме. Це те, що я одночасно люблю і ненавиджу в програмуванні на JavaScript — він має багато різних стилів і варіантів, які можна використати. З одного боку, це робить JavaScript дуже гнучкою й адаптивною мовою, але з іншого боку, велика кількість варіантів може бути приголомшливою та призвести до значної плутанини під час навчання.</p>
<p>Розглянемо можливі варіанти ітерування по масиву:</p>
<ul>
  <li>Традиційний цикл <code>for</code>. Ймовірно до нього ви звикли найбільше, він відповідає синтаксису інших мов програмування, таких як Java та C.</li>
  <li>Цикл <code>for...in</code>. Цей вид циклу дозволяє ітерувати всі властивості об’єкта. Він не особливо корисний для масивів, тому я не розглядатиму його тут.</li>
  <li>Цикл <code>forEach()</code>. Це чудовий варіант, і я раджу з ним ознайомитися! Це приклад функції вищого порядку, про що я розповім пізніше у цьому розділі.</li>
  <li>Цикл <code>for...of</code>. Це підхід, про який я розповім далі. При роботі з масивами об’єктів він надає чистий і лаконічний синтаксис порівняно з традиційним циклом <code>for</code>.</li>
</ul>
<p>Ось як виглядає цикл <code>for...of</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> particle <span class="hljs-keyword">of</span> particles) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Щоб перекласти цей код у слова, скажіть <em>each</em> замість <em>let</em> та <em>in</em> замість <em>of</em>. Зібравши все разом, ви прочитаєте: “Для кожної частинки із масиву частинок виконайте метод <code>run()</code>”. Метод <code>run()</code> у свою чергу оновить та відобразить кожну частинку.</p>
<p>Просто, елегантно, лаконічно, любо. Але перш ніж ви занадто захопитеся циклами <code>for...of</code>, зупиніться на мить і видихніть, оскільки я маю погану новину: вони не підійдуть для кожної ситуації. Так, я полюбляю цикли <code>for...of</code> і я використовуватиму їх у деяких наступних прикладах, де мені потрібно буде перебирати елементи у масиві, але не саме зараз. Зрештою, я хочу створити безперервний потік частинок з додаванням до масиву нових частинок кожного виконання функції <code>draw()</code> і видаленням із масиву старих частинок, після їх відмирання. Як ви незабаром побачите, саме тут цикл <code>for...of</code> мене підведе.</p>
<p>Створювати нову частинку на кожному кадрі легко: я можу просто викликати метод <code>push()</code> класу <code>Array</code> усередині функції <code>draw()</code>, щоб додати у кінець масиву новий об’єкт <code>Particle</code>. Це усуває необхідність попередньо створювати частинки у функції <code>setup()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> particles = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">360</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  particles.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>));
</code></pre><div class="comment"><p>Новий об’єкт Particle додається до масиву кожного кадру під час виконання функції draw().</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; particles.<span class="hljs-property">length</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    particles[i].<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Якщо запустити цей код на кілька хвилин, то ви побачите, що частота кадрів почне сповільнюватися все більше і більше, поки програма не зупиниться. У моїх тестах продуктивність суттєво знизилася вже через 15 хвилин. Проблема, звичайно, полягає в тому, що я додаю все більше і більше частинок без їх видалення.</p>
<p>Щоб виправити це, я можу використати метод <code>splice()</code>, щоб позбутися відмерлих частинок. Він видаляє один або кілька елементів з масиву, починаючи із заданого індексу. І саме тому я не можу використовувати тут цикл <code>for...of</code>, оскільки метод <code>splice()</code> потребує посилання на індекс частинки, яка видаляється, але цикли <code>for...of</code> не надають такої можливості. Тому натомість мені доведеться використовувати звичайний цикл <code>for</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; particles.<span class="hljs-property">length</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> particle = particles[i];
</code></pre><div class="comment"><p>Призначення елемента масиву окремій змінній для покращення читабельності.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (particle.<span class="hljs-title function_">isDead</span>()) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">      particles.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p>Видалення частинки під індексом i.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Хоча цей код працюватиме нормально і не призведе до зупинки програми, я тим самим відкрив невелику банку з хробаками, намагаючись маніпулювати вмістом масиву під час ітерації через цей самий масив. Це просто пряме запрошення проблеми. Візьмемо, наприклад, наступний код:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; particles.<span class="hljs-property">length</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> particle = particles[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    particles.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>));
</code></pre><div class="comment"><p>Додавання нової частинки до списку під час ітерації.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Це дещо екстремальний сценарій (з недолугою логікою), але він підтверджує тезу. Проходячи кожен елемент списку цей код додає нову частинку до масиву, таким чином його довжина і властивість <code>length</code> постійно збільшується. Це призведе до нескінченного циклу, оскільки я ніколи не зможу дійти до кінця масиву!</p>
<p>Хоча видалення елементів із масиву під час циклу не призводить до збою програми (на відміну від додавання), ця проблема, можливо, більш підступна, оскільки не залишає слідів. Щоб виявити недолік, я повинен спочатку встановити важливий факт: коли елемент видаляється з масиву за допомогою методу <code>splice()</code>, всі наступні елементи зміщуються ліворуч. На малюнку 4.1 показано, що відбувається, коли частинка C (під індексом 2) видаляється. Частин ки A і B зберігають той самий індекс, тоді як частинки D і E зсуваються з 3-го і 4-го на 2-й і 3-й індекси відповідно.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;648&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/746943801cf905f11d16440d49a0500a/2c37a/04_particles_2.webp 576w,./static/746943801cf905f11d16440d49a0500a/282b9/04_particles_2.webp 1152w,./static/746943801cf905f11d16440d49a0500a/93bc1/04_particles_2.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/746943801cf905f11d16440d49a0500a/82159/04_particles_2.png" data-srcset="./static/746943801cf905f11d16440d49a0500a/884ae/04_particles_2.png 576w,./static/746943801cf905f11d16440d49a0500a/837de/04_particles_2.png 1152w,./static/746943801cf905f11d16440d49a0500a/82159/04_particles_2.png 2304w" alt="Малюнок 4.1: Коли елемент видаляється з масиву, наступні елементи зміщуються вліво, щоб заповнити порожнє місце"/></picture><noscript><picture><source type="image/webp" srcSet="./static/746943801cf905f11d16440d49a0500a/2c37a/04_particles_2.webp 576w,./static/746943801cf905f11d16440d49a0500a/282b9/04_particles_2.webp 1152w,./static/746943801cf905f11d16440d49a0500a/93bc1/04_particles_2.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/746943801cf905f11d16440d49a0500a/82159/04_particles_2.png" srcSet="./static/746943801cf905f11d16440d49a0500a/884ae/04_particles_2.png 576w,./static/746943801cf905f11d16440d49a0500a/837de/04_particles_2.png 1152w,./static/746943801cf905f11d16440d49a0500a/82159/04_particles_2.png 2304w" alt="Малюнок 4.1: Коли елемент видаляється з масиву, наступні елементи зміщуються вліво, щоб заповнити порожнє місце"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 4.1: Коли елемент видаляється з масиву, наступні елементи зміщуються вліво, щоб заповнити порожнє місце</figcaption>
</figure>
<p>Розглянемо, що відбувається, коли лічильник <code>i</code> обходить елементи цього масиву:</p>
<table><thead><tr><th><code><strong>i</strong></code></th><th>Частинка</th><th>Дія</th></tr></thead><tbody><tr><td>0</td><td>Частинка A</td><td>Не видаляти!</td></tr><tr><td>1</td><td>Частинка B</td><td>Не видаляти!</td></tr><tr><td>2</td><td>Частинка C</td><td>Видалити! Переміщення частинок D і E зі слотів 3 і 4 у слоти 2 та 3.</td></tr><tr><td>3</td><td>Частинка E</td><td>Не видаляти!</td></tr></tbody></table>
<p>Помітили проблему? Частинка D не перевірялася! Коли C видаляється зі слота 2, D займає його місце під індексом 2, але змінна <code>i</code> вже перейшла до слота 3. На практиці це, можливо, не катастрофічно, оскільки частинку D буде перевірено наступного разу під час виконання функції <code>draw()</code>. Проте, очікується, що код повинен проходити кожен елемент масиву. Пропускати елементи без причини неприпустимо!</p>
<p>Ця проблема має два вирішення. Перший — це ітерація масиву у зворотному порядку. Оскільки при видаленні елементи зміщуються справа наліво, таким чином неможливо пропустити елемент, як було перед цим. Ось як виглядає такий код:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = particles.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
</code></pre><div class="comment"><p>Ітерація масиву у зворотному напрямку.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> particle = particles[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (particle.<span class="hljs-title function_">isDead</span>()) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      particles.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Друге рішення полягає у використанні <strong>функції вищого порядку</strong>. Це функція, яка приймає іншу функцію як аргумент (або повертає функцію як результат своєї роботи). Масиви JavaScript використовують багато методів вищого порядку. Наприклад, одним з поширених є метод <code>sort()</code>, який приймає як аргумент функцію, яка визначає, як порівнювати два елементи масиву, а потім сортує масив відповідно до цього порівняння.</p>
<p>З масивом частинок я можу використовувати метод вищого порядку <code>filter()</code>. Ця функція вищого порядку приймає функцію, яка визначає певну умову, перевіряючи нею кожен елемент масиву. В результаті повертаються лише ті елементи, для яких задана умова повертає значення <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">true</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span></span> (виключаючи елементи, які повертають <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">false</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">se</span></span></span></span></span>):</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  particles = particles.<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">particle</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">return</span> !particle.<span class="hljs-title function_">isDead</span>();
</code></pre><div class="comment"><p>Повернення частинок, які не відмерли!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  });
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зазвичай у JavaScript це записується у вигляді стрілкової нотації. Щоб дізнатися більше, перегляньте мій урок про <a href="https://thecodingtrain.com/hof" target="_blank" rel="noopener">функції вищого порядку та стрілкову нотацію</a>.</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  particles = particles.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">particle</span> =&gt;</span> !particle.<span class="hljs-title function_">isDead</span>());
</code></pre><div class="comment"><p></p></div></div></div>
<p>Для цілей цієї книги я буду використовувати метод <code>splice()</code>, але раджу вам дослідити написання коду з використанням згаданих функцій вищого порядку.</p>
<div data-type="example">
  <h3 id="example-42-an-array-of-particles"><a class="heading-link" href="#example-42-an-array-of-particles">Приклад 4.2: Масив частинок</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_2_array_particles"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/-xTbGZMim" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> particles = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  particles.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = particles.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
</code></pre><div class="comment"><p>Перебір масиву у зворотному порядку із видаленням непотрібних елементів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> particle = particles[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (particle.<span class="hljs-title function_">isDead</span>()) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      particles.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Вам може бути цікаво, чому замість того, щоб перевіряти кожну частинку окремо, я не видаляю просто найстарішу частинку після певного періоду часу (визначеного за допомогою перевірки змінної <code>frameCount</code> або довжини масиву). У цьому прикладі, де частинки вмирають у тому ж порядку, в якому вони народжуються, такий підхід дійсно спрацює. Я міг би навіть використати інший метод масиву під назвою <code>shift()</code>, який автоматично видаляє перший елемент масиву. Однак у багатьох системах частинок інші умови або взаємодії можуть призвести до того, що “молодші” частинки вмиратимуть раніше, ніж “старіші”. Перевірка <code>isDead()</code> у поєднанні зі <code>splice()</code> — це гарне комплексне рішення, яке забезпечує гнучкість керування частинками у різних сценаріях.</p>
<h2 id="a-particle-emitter"><a class="heading-link" href="#a-particle-emitter">Емітер частинок</a></h2>
<p>Я підкорив масив і використав його для керування списком об’єктів <code>Particle</code> з можливістю додавати та видаляти частинки за бажанням. Я міг би зупинитися на цьому і спочивати на лаврах, але я можу і повинен зробити додатковий крок: створити новий клас, який описуватиме сам список об’єктів <code>Particle</code>. На початку цього розділу, для представлення загальної колекції частинок, я використав спекулятивну назву класу <code>ParticleSystem</code>. Однак більш відповідним терміном для функціональності “емітування” (продукування) частинок є <code>Emitter</code>, який я відтепер і буду використовувати.</p>
<p>Клас <code>Emitter</code> дозволить мені спростити функцію <code>draw()</code>, прибравши громіздку логіку перебору всіх частинок. Як бонус, це також відкриє можливість до роботи з кількома емітерами частинок.</p>
<p>Згадайте, що одна з цілей, яку я поставив на початку цього розділу, полягала в тому, щоб написати функції <code>setup()</code> і <code>draw()</code> без посилань на окремі частинки. Ставлячи цю мету, я дражнив перспективою чудової простоти основного файлу програми. Ось ця програма знову, але вже з використанням нової назви класу <code>Emitter</code> замість <code>ParticleSystem</code>:</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> emitter;
</code></pre><div class="comment"><p>Лише один емітер частинок!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">360</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emitter</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Щоб дійти до цієї точки, подивіться на кожну частину функцій <code>setup()</code> і <code>draw()</code> з прикладу 4.2 та подумайте, як вони можуть вписатися у клас <code>Emitter</code>. Ніщо в поведінці коду не повинно змінюватися — єдина різниця полягає в організації коду:</p>
<table><tbody><tr><td style="width:50%"><strong>Масив усередині функцій </strong><code><strong>setup()</strong></code><strong> і </strong><code><strong>draw()</strong></code></td><td><strong>Масив у класі </strong><code><strong>Emitter</strong></code><strong></strong></td></tr><tr><td>
        <pre><code>

<strong>let particles = [];</strong>

function setup() {
  createCanvas(640, 240);
}

function draw() {
  <strong>particles.push(new Particle());
</strong>


  <strong>let length = particles.length - 1;</strong>
  <strong>for (let i = length; i &gt;= 0; i--) {
    let particles = particles[i];
    particle.run();
    if (particle.isDead()) {
      particles.splice(i, 1);
    }
  }</strong>
}

</code></pre>
      </td><td>
        <pre><code>class Emitter {
  constructor() {
    <strong>this.particles = [];</strong>
  }




  addParticle() {
    <strong>this.particles.push(new Particle());</strong>
  }

  run() {
<strong>    let length = this.particles.length - 1;
</strong>    <strong>for (let i = length; i &gt;= 0; i--) {</strong><strong>
      let particle = this.particles[i];
      particle.run();
      if (particle.isDead()) {
        this.particles.splice(i, 1);
      }
    }</strong>
  }
}</code></pre>
      </td></tr></tbody></table>
<p>Я міг би також додати нові можливості до самої системи частинок. Наприклад, для класу <code>Emitter</code> може бути корисним відстежувати початкову точку де народжуються частинки. Початкова точка може бути ініціалізована у конструкторі.</p>
<div data-type="example">
  <h3 id="example-43-a-single-particle-emitter"><a class="heading-link" href="#example-43-a-single-particle-emitter">Приклад 4.3: Один емітер частинок</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_3_particle_emitter"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/WkX_YtT7xN" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Emitter</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p>Ця конкретна реалізація системи частинок включає початкову точку, з якої починається кожна частинка.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">addParticle</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(origin.<span class="hljs-property">x</span>, origin.<span class="hljs-property">y</span>));
</code></pre><div class="comment"><p>Початкова точка передається кожній частинці.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Показаний приклад емітера являє собою статичне джерело частинок, що є гарним способом почати роботу з системами частинок. Однак, емітер може мати власну поведінку: відчувати фізику, коливатися, реагувати на дії користувача або проявляти будь-який інший вид руху, продемонстрований у попередніх розділах. З часом частинки можуть виходити з різни х позицій, створюючи сліди або інші, складніші й цікавіші візерунки.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-43"><a class="heading-link" href="#exercise-43">Вправа 4.3</a></h3>
  <p>Що, якщо випромінювач буде рухатися? Чи можете ви випускати частинки з позиції курсора або використовувати швидкість і прискорення, щоб рухати систему автономно?</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-44"><a class="heading-link" href="#exercise-44">Вправа 4.4</a></h3>
  <p>Спираючись на приклад гри <em>Asteroids</em> з <a href="/oscillation#section-oscillation">Розділу 3</a>, використовуйте систему частинок, щоб випускати частинки з двигунів корабля щоразу, коли застосовується сила тяги. Початкова швидкість частинок повинна бути пов’язана з поточним напрямком корабля.</p>
</div>
<h2 id="a-system-of-emitters"><a class="heading-link" href="#a-system-of-emitters">Система емітерів</a></h2>
<p>Поки що я описав окрему частинку та організував її код у класі <code>Particle</code>. Я також описав систему частинок і організував код у класі <code>Emitter</code>. Ця система частинок не що інше, як сукупність незалежних об’єктів <code>Particle</code>. Але якщо система частинок являє собою об’єкт класу <code>Emitter</code>, чому б мені не створити колекцію багатьох емітерів частинок: систему систем!</p>
<p>Я міг би розвинути цей напрямок думок ще далі, замкнувшись у підвалі на кілька днів і намалювавши діаграму системи систем системи систем у системі систем... допоки я не отримаю всю цю систему своєї системи. Зрештою, я можу описати світ схожим чином: орган — це система клітин, людське тіло — це система органів, район — це система людських тіл, місто — це система районів і так далі. Я ще не готовий зайти так далеко, але може бути корисно подумати, як написати програму для відстеження багатьох систем частинок, кожна з яких відстежує багато інших своїх частинок.</p>
<p>Розгляньте такий сценарій: ви починаєте з порожнього екрана (малюнок 4.2).</p>
<figure>
  <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_4_multiple_emitters_0"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/tYplPGTcR" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
  <figcaption>Малюнок 4.2: Початок з порожнім екраном</figcaption>
</figure>
<p>Ви клацаєте мишкою і створюєте систему частинок у позиції курсора (малюнок 4.3).</p>
<figure>
  <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_4_emitters_1"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/GEO-ZFcf_" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
  <figcaption>Малюнок 4.3: Додавання системи частинок</figcaption>
</figure>
<p>Ви продовжуєте клацати мишкою. Кожного разу там де ви клацнули, виникає інша система частинок (малюнок 4.4).</p>
<figure>
  <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_4_emitters_2"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/_196ApjwA" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
  <figcaption>Малюнок 4.4: Додавання кількох систем частинок</figcaption>
</figure>
<p>Як це зробити? У прикладі 4.3 я завів змінну <code>emitter</code> для посилання на один об’єкт типу <code>Emitter</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> emitter;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emitter</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">addParticle</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер я назву змінну <code>emitters</code> у множині й зроблю її масивом, щоб я міг відстежувати кілька об’єктів типу <code>Emitter</code>. На початку програми масив порожній.</p>
<div data-type="example">
  <h3 id="example-44-a-system-of-systems"><a class="heading-link" href="#example-44-a-system-of-systems">Приклад 4.4: Система систем</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_4_multiple_emitters"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/s_Y3-Mmo7" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption>Клацання мишкою додаватиме новий емітер.</figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> emitters = [];
</code></pre><div class="comment"><p>Цього разу тип елементів, які ми додаємо до масиву — це сам емітер частинок!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Щоразу, коли відбувається клацання мишкою, створюється новий об’єкт типу <code>Emitter</code>, який додається у масив:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mousePressed</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitters.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Emitter</span>(mouseX, mouseY));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Потім у функції <code>draw()</code>, замість посилання на один об’єкт типу <code>Emitter</code>, я тепер перебираю всі емітери й викликаю на кожному з них метод <code>run()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> emitter <span class="hljs-keyword">of</span> emitters) {
    emitter.<span class="hljs-title function_">run</span>();
    emitter.<span class="hljs-title function_">addParticle</span>();
  }
</code></pre><div class="comment"><p>Оскільки емітери тут не видаляються, тому можна використовувати цикл for...of!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зверніть увагу, що я повернувся до використання циклу <code>for...of</code>, оскільки з масиву  <code>emitters</code> не видаляються жодні елементи.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-45"><a class="heading-link" href="#exercise-45">Вправа 4.5</a></h3>
  <p>Перепишіть приклад 4.4, щоб кожна система частинок не жила вічно. Встановіть обмеження на кількість частинок, які може створити окрема система. Потім, коли система частинок стане порожньою (більше не матиме частинок), видаліть її з масиву <code>emitters</code>.</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-46"><a class="heading-link" href="#exercise-46">Вправа 4.6</a></h3>
  <p>Створіть симуляцію об’єкта, що розбивається на багато частин. Як можна перетворити одну велику форму на багато малих частинок? Чи можете ви створити на екрані кілька великих форм, кожна з яких розбиватиметься при клацанні на них?</p>
</div>
<h2 id="inheritance-and-polymorphism"><a class="heading-link" href="#inheritance-and-polymorphism">Наслідування і поліморфізм</a></h2>
<p>Досі всі частинки в моїх системах були ідентичними, з однаковим виглядом і поведінкою. Хто сказав, що має бути тільки так? Використовуючи два фундаментальні принципи ООП, <strong>наслідування</strong> і <strong>поліморфізм</strong>, я можу створити системи частинок зі значно більшою різноманітністю.</p>
<p>Можливо, до цієї книги ви вже стикалися з цими двома термінами у своєму програмістському житті. Наприклад, в моїй книзі “<em>Learning Processing</em>” є цілий розділ (№22) присвячений їм. Можливо, ви вивчали наслідування і поліморфізм тільки на абстрактному рівні й ніколи не мали причин використовувати їх по-справжньому. Якщо це так, ви опинилися в потрібному місці. Без цих підходів ваша здатність програмувати різноманітні частинки та системи частинок вкрай обмежена. (У <a href="/physics-libraries#section-physics-libraries">Розділі 6</a> я також покажу, як розуміння цих тем допоможе вам використовувати фізичні js-бібліотеки.)</p>
<p>Уявіть собі, що сьогодні суботній ранок. Ви щойно повернулися з чудової пробіжки, з’їли тарілку смачних пластівців і спокійно сидите за комп’ютером із чашкою теплого ромашкового чаю. У вашого старого друга день народження і ви вирішили зробити для нього вітальну листівку за допомогою p5.js. Як щодо імітації конфетті? Фіолетове конфетті, рожеве конфетті, конфетті у вигляді зірок, квадратне конфетті, швидке конфетті, миготливе конфетті — усі види конфетті, з різним виглядом і різною поведінкою, одночасно вибухають на екрані.</p>
<p>Набір окремих частинок конфетті — це явно кейс для системи частинок. Ви можете вміло переконструювати клас <code>Particle</code>, щоб в ньому були змінні для зберігання кольору, форми, поведінки тощо. Щоб створити різноманітні частинки, ви можете ініціалізувати ці змінні випадковими значеннями. Але що, якщо деякі з ваших частинок кардинально відрізняються? Вся ця історія може стати дуже безладною, якщо тримати всі варіації коду для різних частинок і їх особливостей в одному класі. Іншим підходом може бути наступне рішення:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HappyConfetti</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FunConfetti</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WackyConfetti</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Це гарне рішення: створити три різних класи для опису різних типів конфеті, які є частиною вашої системи частинок. Тоді конструктор класу <code>Emitter</code> може містити код для випадкового вибору з трьох класів під час заповнення масиву (зверніть увагу, що цей спосіб випадкового вибору такий самим, який я використав у прикладах випадкових блукачів у <a href="/random#the-random-walker-class">Розділі 0</a>):</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Emitter</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">num</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; num; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> r = <span class="hljs-title function_">random</span>(<span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0.33</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HappyConfetti</span>());
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0.67</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FunConfetti</span>());
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WackyConfetti</span>());
      }
</code></pre><div class="comment"><p>Випадковий вибір типу частинок.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Дозвольте мені на мить зупинитися. Ви не зробили нічого н еправильного. Ви просто хотіли привітати свого друга з днем народження і насолодитися створенням коду. Але попри досить розумну аргументацію цього підходу, тут є проблема: чи не доведеться вам копіювати багато коду між різними класами конфетті?</p>
<p>Так, ймовірно, доведеться. Навіть якщо види частинок досить різні і є сенс винести їх в окремі класи, все одно між ними буде чимало спільного коду. Наприклад, усі вони матимуть вектори для відстеження положення, швидкості й прискорення, метод <code>update()</code> з реалізацією алгоритму руху та багато іншого.</p>
<p>Ось тут на сцену виходить <strong>наслідування</strong>. Наслідування дозволяє вам написати клас, який бере (<em>успадковує</em>) змінні та методи з іншого класу і при цьому може мати свої власні методи. Вам також може бути цікаво, чи спрацює додавання всіх цих різних типів конфетті в один масив <code>particles</code>. Все-таки я зазвичай не змішую різні види об’єктів в одному масиві, оскільки це може стати досить заплутаним. Як код у класі <code>Emitter</code> дізнається, яка частинка належить до якого виду конфетті? Чи не легше керувати окремими масивами?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-variable language_">this</span>.<span class="hljs-property">happyParticles</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-variable language_">this</span>.<span class="hljs-property">funParticles</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-variable language_">this</span>.<span class="hljs-property">wackyParticles</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"> }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Насправді розділяти частинки на різні масиви незручно. Єдиний масив для всіх частинок у системі буде набагато практичнішим. На щастя, можливість змішувати об’єкти різних типів в одному масиві є вбудованою особливістю JavaScript, а концепція <strong>поліморфізму</strong> дозволяє працювати зі змішаними об’єктами так, ніби вони належать до одного типу. Я можу наповнити масив різними видами частинок і кожна частинка все одно зберігатиме свою унікальну поведінку та характеристики, як визначено у відповідному класі.</p>
<p>Далі я детальніше проілюструю успадкування і поліморфізм, а потім створю систему частинок, яка включатиме ці концепції.</p>
<h3 id="inheritance-basics"><a class="heading-link" href="#inheritance-basics">Основи наслідування</a></h3>
<p>Щоб продемонструвати, як працює успадкування, я розгляну приклад зі світу тварин: собак, котів, мавп, панд, вомбатів, назвіть свій власний варіант. Я почну з класу <code>Dog</code>. Клас <code>Dog</code> матиме змінну <code>age</code>, а також методи <code>eat()</code>, <code>sleep()</code> і <code>bark()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">eat</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Ням!&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">sleep</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Хррррр...&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;ГАВ!&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер я створю кота:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = <span class="hljs-number">0</span>;
  }
</code></pre><div class="comment"><p>Собаки і коти мають багато спільних змінних (age) та методів (eat, sleep).</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">eat</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Ням!&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">sleep</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Хррррр...&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">meow</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;НЯВ!&quot;</span>);
  }
</code></pre><div class="comment"><p>У котів немає методу bark(), але натомість є унікальний метод для нявкання.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Коли я перейду до переписування того самого коду для риб, коней, коал і лемурів, цей процес стане досить нудним. Кращим рішенням буде розробка загального класу <code>Animal</code>, який може описувати будь-який тип тварин. Адже всі тварини їдять і сплять. Тоді я міг би сказати наступне:</p>
<ul>
  <li>Собака — це тварина, яка має всі властивості тварин та може робити все, що роблять тварини. Крім того, собака може гавкати.</li>
  <li>Кішка — це тварина, яка має всі властивості тварин та може робити все, що роблять тварини. Крім того, кішка може нявкати.</li>
</ul>
<p>Наслідування робить це можливим, дозволяючи класам <code>Dog</code> і <code>Cat</code> бути визначеними як діти (<strong>підкласи</strong>) класу <code>Animal</code>. Дочірні класи автоматично успадковують усі змінні й методи від свого батьківського класу (<strong>суперкласу</strong>), але вони також можуть включати методи та змінн і, яких немає в батьківському класі. Подібно до філогенетичного дерева життя, успадкування схоже на структуру дерева (див. малюнок 4.2): собаки наслідують ссавців, які наслідуються від тварин і так далі.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1064&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/92b90e5064bc06b49247c9dbc3e78708/bc11b/04_particles_3.webp 576w,./static/92b90e5064bc06b49247c9dbc3e78708/3424c/04_particles_3.webp 1152w,./static/92b90e5064bc06b49247c9dbc3e78708/45130/04_particles_3.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/92b90e5064bc06b49247c9dbc3e78708/df520/04_particles_3.png" data-srcset="./static/92b90e5064bc06b49247c9dbc3e78708/76b31/04_particles_3.png 576w,./static/92b90e5064bc06b49247c9dbc3e78708/ae68d/04_particles_3.png 1152w,./static/92b90e5064bc06b49247c9dbc3e78708/df520/04_particles_3.png 2304w" alt="Малюнок 4.2: Дерево наслідування"/></picture><noscript><picture><source type="image/webp" srcSet="./static/92b90e5064bc06b49247c9dbc3e78708/bc11b/04_particles_3.webp 576w,./static/92b90e5064bc06b49247c9dbc3e78708/3424c/04_particles_3.webp 1152w,./static/92b90e5064bc06b49247c9dbc3e78708/45130/04_particles_3.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/92b90e5064bc06b49247c9dbc3e78708/df520/04_particles_3.png" srcSet="./static/92b90e5064bc06b49247c9dbc3e78708/76b31/04_particles_3.png 576w,./static/92b90e5064bc06b49247c9dbc3e78708/ae68d/04_particles_3.png 1152w,./static/92b90e5064bc06b49247c9dbc3e78708/df520/04_particles_3.png 2304w" alt="Малюнок 4.2: Дерево наслідування"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 4.2: Дерево наслідування</figcaption>
</figure>
<p>Ось як працює синтаксис наслідування:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
</code></pre><div class="comment"><p>Клас Animal є батьківським класом (або суперкласом).</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p>Dog і Cat успадкують змінну віку.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">eat</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Ням!&quot;</span>);
  }
  
  <span class="hljs-title function_">sleep</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Хррррр...&quot;</span>);
  }
</code></pre><div class="comment"><p>Dog і Cat успадкують методи eat() та sleep().</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
</code></pre><div class="comment"><p>Клас Dog є дочірнім класом або підкласом, що вказується за допомогою коду extends Animal.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">super</span>();
</code></pre><div class="comment"><p>метод super() виконує код конструктора батьківського класу.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;ГАВ!&quot;</span>);
  }
</code></pre><div class="comment"><p>Метод bark() визначено в дочірньому класі, оскільки він не є частиною батьківського класу.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">super</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">meow</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;НЯВ!&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>У цьому коді використовуються дві особливі можливості JavaScript. По-перше, зверніть увагу на ключове слово <code>extends</code>, яке вказує на батьківський клас для наслідування (розширення). Підклас може розширювати лише один суперклас. Однак класи можуть розширювати класи, які розширюють інші класи, наприклад <code>Dog extends Animal</code>, <code>Terrier extends Dog</code>. Все успадковується вниз по лінії від <code>Animal</code> до <code>Terrier</code>.</p>
<p>По-друге, зверніть увагу на виклик <code>super()</code> у конструкторах класів <code>Dog</code> і <code>Cat</code>. Таким чином викликається конструктор батьківського класу. Іншими словами, щоб ви не робили в батьківському конструкторі, виконайте це також і в дочірньому конструкторі. У цьому випадку це не є обов’язковим, але <code>super()</code> також може приймати аргументи, які відповідають аргументам батьківського констр уктора, якщо такі були закладені.</p>
<p>Ви можете розширити підклас, щоб включити додаткові методи, окрім тих, що містяться в суперкласі. Тут я додав метод <code>bark()</code> до класу <code>Dog</code> і метод <code>meow()</code> до класу <code>Cat</code>. У конструктор підкласу ви також можете включити додатковий код, окрім виклику <code>super()</code>, щоб надати цьому підкласу додаткові змінні. Наприклад, припустимо, що окрім <code>age</code>, об’єкт типу <code>Dog</code> повинен мати змінну <code>haircolor</code>. Тепер клас виглядатиме так:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">super</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">haircolor</span> = <span class="hljs-title function_">color</span>(<span class="hljs-number">210</span>, <span class="hljs-number">105</span>, <span class="hljs-number">30</span>);
</code></pre><div class="comment"><p>Дочірній клас може додавати нові змінні, яких немає в батьківському.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;ГАВ!&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зверніть увагу, що в першу чергу викликається батьківський конструктор через <code>super()</code>, який встановлює до змінної <code>age</code> значення <code>0</code>, а потім змінна <code>haircolor</code> встановлюється всередині конструктора класу <code>Dog</code>.</p>
<p>Якщо об’єкт типу <code>Dog</code> їсть інакше, ніж описано в загальному класі <code>Animal</code>, батьківський метод можна <em>перевизначити</em> через створення власного визначення відповідного методу в середині підкласу:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">     <span class="hljs-variable language_">super</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">     <span class="hljs-variable language_">this</span>.<span class="hljs-property">haircolor</span> = <span class="hljs-title function_">color</span>(<span class="hljs-number">210</span>, <span class="hljs-number">105</span>, <span class="hljs-number">30</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">eat</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p>Якщо необхідно, дочірній клас може перевизначити батьківський метод.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Гав! Гав! Хльок! Хльок!&quot;</span>)
</code></pre><div class="comment"><p>Специфічні особливості харчування собаки.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;ГАВ!&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Але що, якщо собака їсть майже так само, як звичайна тварина, тільки з деякою додатковою особливістю? Підклас може запускати код із методу свого батьківського класу й одночасно включати власний код:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">     <span class="hljs-variable language_">super</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">     <span class="hljs-variable language_">this</span>.<span class="hljs-property">haircolor</span> = <span class="hljs-title function_">color</span>(<span class="hljs-number">210</span>, <span class="hljs-number">105</span>, <span class="hljs-number">30</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-title function_">eat</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">     <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">eat</span>();
</code></pre><div class="comment"><p>Виклик батьківського методу eat() з класу Animal. Дочірній клас може виконувати методи батьківського класу.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">     <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;Гав!!!&quot;</span>);
</code></pre><div class="comment"><p>Додатковий код для специфічних дій притаманних харчуванню об’єкта Dog.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-string">&quot;ГАВ!&quot;</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Подібно до виклику <code>super()</code> в конструкторі, виклик <code>super.eat()</code> всередині методу <code>eat()</code> у класі <code>Dog</code> призводить до виклику методу <code>eat()</code> батьківського класу <code>Animal</code>. Після цього виклику метод підкласу можна продовжити з будь-яким додатковим кодом.</p>
<h3 id="polymorphism-basics"><a class="heading-link" href="#polymorphism-basics">Основи поліморфізму</a></h3>
<p>Ви застосували успадкування для створення купи різних підкласів. Тепер спробуйте уявити, як ваш код керуватиме цим різноманітним царством тварин із собаками, котами, черепахами й ківі, які бавляться довкола:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> dogs = [];
<span class="hljs-keyword">let</span> cats = [];
<span class="hljs-keyword">let</span> turtles = [];
<span class="hljs-keyword">let</span> kiwis = [];
</code></pre><div class="comment"><p>Окремі масиви для кожної тварини.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  dogs.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  cats.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  turtles.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Turtle</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">98</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  kiwis.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Kiwi</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>На початку дня всі тварини дуже голодні й шукають їжу. Настав час для циклів:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> dog <span class="hljs-keyword">of</span> dogs) {
  dog.<span class="hljs-title function_">eat</span>();
}
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> cat <span class="hljs-keyword">of</span> cats) {
  cat.<span class="hljs-title function_">eat</span>();
}
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> turtle <span class="hljs-keyword">of</span> turtles) {
  turtle.<span class="hljs-title function_">eat</span>();
}
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> kiwi <span class="hljs-keyword">of</span> kiwis) {
  kiwi.<span class="hljs-title function_">eat</span>();
}
</code></pre><div class="comment"><p>Окремі цикли для кожної тварини.</p></div></div></div>
<p>Це працює, але з розширенням світу, при включенні більшої кількості видів тварин, ви застрягнете у написанні багатьох окремих циклів. Чи це дійсно необхідно? Зрештою, всі ці створіння є тваринами й всі вони полюбляють їсти. Чому б просто не створити один масив і заповнити його усіма видами тварин?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> kingdom = [];
</code></pre><div class="comment"><p>Лише один масив для всіх тварин!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  kingdom.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  kingdom.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  kingdom.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Turtle</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">98</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  kingdom.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Kiwi</span>());
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> animal <span class="hljs-keyword">of</span> kingdom) {
  animal.<span class="hljs-title function_">eat</span>();
}
</code></pre><div class="comment"><p>Один цикл для всіх тварин!</p></div></div></div>
<p>Це поліморфізм (від грецького <em>polymorphos</em>, що означає “багато форм”) у дії. Хоча всі тварини згруповані у масив і обробляються в одному циклі <code>for</code>, JavaScript може визначити їх справжні типи та викликати відповідний метод <code>eat()</code> для кожного з них. Все настільки просто!</p>
<h3 id="particles-with-inheritance-and-polymorphism"><a class="heading-link" href="#particles-with-inheritance-and-polymorphism">Частинки з наслідуванням і поліморфізмом</a></h3>
<p>Тепер, коли я розглянув теорію і синтаксис успадкування та поліморфізму, я готовий написати їх робочий приклад у p5.js на основі мого класу <code>Particle</code>. Спершу погляньте ще раз на базову реалізацію класу <code>Particle</code> адаптовану з <a href="#example-41-a-single-particle">прикладу 4.1</a>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Particle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-title function_">random</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <span class="hljs-title function_">random</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">0</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> = <span class="hljs-number">255.0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">update</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">show</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> -= <span class="hljs-number">2.0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">mult</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyForce</span>(<span class="hljs-params">force</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">add</span>(force);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">isDead</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> &lt; <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">circle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, <span class="hljs-number">8</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<div class="avoid-break">
  <p>Цей клас має змінні та методи, які повинен мати будь-який елемент системи частинок. Далі я створю підклас <code>Confetti</code>, який розширює клас <code>Particle</code>. Він використовує <code>super()</code>, щоб виконати код конструктора батьківського класу й успадковує більшість методів класу <code>Particle</code>. Однак я надам класу <code>Confetti</code> його власний метод <code>show()</code>, перевизначаючи батьківський, тому об’єкти типу <code>Confetti</code> будуть малюватися квадратами, а не кругами:</p>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Confetti</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Particle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">super</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-comment">/* Тут я можу додати змінні притаманні лише для Confetti. */</span>
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-comment">/* Інші методи, такі як update(), успадковуються від батьківського класу. */</span>
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">rectMode</span>(<span class="hljs-variable constant_">CENTER</span>);
    <span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
    <span class="hljs-title function_">square</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, <span class="hljs-number">12</span>);
  }
</code></pre><div class="comment"><p>Перевизначення методу show().</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зробимо поведінку трохи складнішою. Скажімо, я хочу, щоб при польоті кожна частинка <code>Confetti</code> оберталася. Одним із варіантів є моделювання кутової швидкості та прискорення, як описано у <a href="/oscillation#section-oscillation">Розділі 3</a>. Однак для простоти я реалізую щось менш формальне.</p>
<p>Я знаю, що частинка має <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">x</span></span></span></span></span>-позицію десь між 0 і шириною полотна. Що, якби я сказав, що коли <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">x</span></span></span></span></span>-позиція частинки дорівнює 0, то її обертання має бути рівним 0. Коли ж положення <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">x</span></span></span></span></span> дорівнює ширині, то обертання має дорівнювати <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">4\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span>? Це вам щось нагадує? Як говорилося у <a href="/random#a-smoother-approach-with-perlin-noise">Розділі 0</a>, коли значення має один діапазон, який потрібно зіставити з іншим діапазоном, ви можете використовувати функцію <code>map()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> angle = <span class="hljs-title function_">map</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-number">0</span>, width, <span class="hljs-number">0</span>, <span class="hljs-variable constant_">TWO_PI</span> * <span class="hljs-number">2</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Ось як цей код вписується у метод <code>show()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> angle = <span class="hljs-title function_">map</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-number">0</span>, width, <span class="hljs-number">0</span>, <span class="hljs-variable constant_">TWO_PI</span> * <span class="hljs-number">2</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">rectMode</span>(<span class="hljs-variable constant_">CENTER</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">push</span>();
    <span class="hljs-title function_">translate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>);
    <span class="hljs-title function_">rotate</span>(angle);
    <span class="hljs-title function_">rectMode</span>(<span class="hljs-variable constant_">CENTER</span>);
    <span class="hljs-title function_">square</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">12</span>);
    <span class="hljs-title function_">pop</span>();
</code></pre><div class="comment"><p>Для обертання фігур у p5.js, потріб ні певні трансформації. Щоб дізнатися більше, відвідайте сторінку https://thecodingtrain.com/transformations.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Вибір <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">4\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span> може здатися довільним, але це навмисно — два повних оберти додають частинці значний ступінь обертання порівняно з одним.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-47"><a class="heading-link" href="#exercise-47">Вправа 4.7</a></h3>
  <p>Замість використання функції <code>map()</code> для обчислення <code>angle</code>, спробуйте змоделювати кутову швидкість і прискорення.</p>
</div>
<p>Тепер, коли у мене є підклас <code>Confetti</code>, який розширює базовий клас <code>Particle</code>, наступним кроком буде додавання об’єктів типу <code>Confetti</code> до масиву частинок, визначеного у класі <code>Emitter</code>.</p>
<div data-type="example">
  <h3 id="example-45-a-particle-system-with-inheritance-and-polymorphism"><a class="heading-link" href="#example-45-a-particle-system-with-inheritance-and-polymorphism">Приклад 4.5: Система частинок  з наслідуванням і поліморфізмом</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/noc_4_05_particle_system_inheritance_polymorphism"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/2ZlNJp2EW" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Emitter</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span> = [];
</code></pre><div class="comment"><p>Один масив для всіх частинок типу Particle або інших типів які розширюють клас Particle.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">addParticle</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> r = <span class="hljs-title function_">random</span>(<span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0.5</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">y</span>));
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Confetti</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">y</span>));
    }
</code></pre><div class="comment"><p>Імовірність додавання кожного типу частинок становить 50%.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> particle = <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">if</span> (particle.<span class="hljs-title function_">isDead</span>()) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Чи ви бачите, як цей приклад використовує поліморфізм? Це те, що дозволяє об’єктам типу <code>Particle</code> і <code>Confetti</code> змішуватися в одному масиві <code>particles</code> в межах класу <code>Emitter</code>. Завдяки зв’язку через наслідування їх оби два можна розглядати як тип <code>Particle</code>, безпечно перебирати масив з ними й викликати для кожного об’єкта такі методи, як <code>run()</code> та <code>isDead()</code>. Разом успадкування і поліморфізм дозволяють керувати різними типами частинок, об’єднаних в одному масиві, незалежно від їх початкового класу.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-48"><a class="heading-link" href="#exercise-48">Вправа 4.8</a></h3>
  <p>Створіть систему частинок із більш ніж двома типами частинок. Спробуйте додатково змінити поведінку частинок.</p>
</div>
<h2 id="particle-systems-with-forces"><a class="heading-link" href="#particle-systems-with-forces">Системи частинок із силами</a></h2>
<p>Поки що, для керування колекцією частинок, у цьому розділі я зосереджувався на структуруванні коду в об’єктно-орієнтованому стилі. Хоча я і залишив метод <code>applyForce()</code> у класі <code>Particle</code>, я зробив кілька скорочень, щоб спростити код. Тепер я поверну назад властивість <code>mass</code>, змінюючи у процесі методи <code>constructor()</code> і <code>applyForce()</code> (решта класу залишається незмінною):</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Particle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-title function_">random</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<span class="hljs-title function_">random</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">0</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p>Тепер почнемо з прискорення (0, 0).</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span> = <span class="hljs-number">255.0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mass</span> = <span class="hljs-number">1</span>;
</code></pre><div class="comment"><p>Додамо властивість маси. Спробуйте змінювати масу, щоб от римати різні цікаві результати!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyForce</span>(<span class="hljs-params">force</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> f = force.<span class="hljs-title function_">copy</span>();
    f.<span class="hljs-title function_">div</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mass</span>);
</code></pre><div class="comment"><p>Ділення сили на масу.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">add</span>(f);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">	}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Тепер, коли клас <code>Particle</code> завершено, у мене є важливе запитання: де мені слід викликати метод <code>applyForce()</code>? Де в коді доцільно застосувати силу до частинки? На мою думку, тут немає правильної чи неправильної відповіді. Насправді все залежить від потрібної функціональності й цілей конкретної програми. Моїм швидким і простим рішенням у попередніх прикладах було просте ств орення та застосування сили <code>gravity</code> у методі <code>run()</code> для кожної частинки:</p>
<div class="snip-below snip-above">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> gravity = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.05</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(gravity);
</code></pre><div class="comment"><p>Створення захардкодженого вектора і застосування його як сили.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">update</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">show</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Тепер я хотів би розглянути ширше й універсальніше рішення, яке дозволить застосовувати різні сили до окремих частинок у системі. Наприклад, що, якби для кожного кадру у функції <code>draw()</code> я прикладав глобальну силу до всіх частинок?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-comment">/* Застосувати силу до всіх частинок? */</span>
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">addParticle</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Ой, здається є невелика проблема. Метод <code>applyForce()</code> написаний всередині класу <code>Particle</code>, але там немає посилань на окремі частинки, лише на <code>emitter</code>, об’єкт класу <code>Emitter</code>. Оскільки я хочу, щоб усі частинки отримували силу, я можу передати силу емітера і дозволити йому керувати всіма окремими частинками:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> gravity = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">applyForce</span>(gravity);
</code></pre><div class="comment"><p>Застосування сили до емітера.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">addParticle</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Звісно, якщо я викликаю метод <code>applyForce()</code> на об’єкті типу <code>Emitter</code> мені потрібно визначити цей метод у класі <code>Emitter</code>. Звичайною мовою цей метод повинен мати можливість отр имати силу у вигляді <code>p5.Vector</code> і застосувати її до всіх частинок. Ось переклад цієї пропозиції у код:</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyForce</span>(<span class="hljs-params">force</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> particle <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      particle.<span class="hljs-title function_">applyForce</span>(force);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Здається, що писати цей метод безглуздо. По суті код говорить: “Застосуйте силу до системи частинок, щоб система могла застосувати цю силу до всіх окремих частинок”. Хоча це може здатися дещо обхідним шляхом, цей підхід цілком розумний. Зрештою, саме емітер відповідає за керування частинками, тому, якщо ви хочете взаємодіяти з частинками, ви повинні взаємодіяти з ними через їх менеджера. (Також т ут є можливість використати зручний цикл <code>for...of</code>, оскільки частинки не видаляються!)</p>
<p>Ось повний приклад із цією зміною. (Код припускає наявність класу <code>Particle</code>, написаного раніше, який немає сенсу показувати знову, оскільки в ньому нічого не змінилося.)</p>
<div data-type="example">
  <h3 id="example-46-a-particle-system-with-forces"><a class="heading-link" href="#example-46-a-particle-system-with-forces">Приклад 4.6: Система частинок із силами</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/4_6_particle_system_forces"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/uZ9CfjLHL" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> emitter;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emitter</span>(<span class="hljs-title function_">createVector</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> gravity = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
  emitter.<span class="hljs-title function_">applyForce</span>(gravity);
</code></pre><div class="comment"><p>Застосування сили до емітера.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">addParticle</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Emitter</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">addParticle</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">y</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyForce</span>(<span class="hljs-params">force</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> particle <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>) {
      particle.<span class="hljs-title function_">applyForce</span>(force);
    }
</code></pre><div class="comment"><p>Використання циклу for...of для застосування сили до всіх частинок.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
      <span class="hljs-keyword">let</span> particle = <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>[i];
      particle.<span class="hljs-title function_">run</span>();
      <span class="hljs-keyword">if</span> (particle.<span class="hljs-title function_">isDead</span>()) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
      }
    }
</code></pre><div class="comment"><p>Тут неможливо використати for...of через перевірку частинок на видалення.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Хоча цей приклад має захардкоджену силу тяжіння, варто розглянути, як можна залучити інші сили з попередніх розділів, такі як вітер або опір. Ви також можете експериментувати з тим, як і коли застосовуються сили. Що якби замість сили, що постійно діє на частинки у кожному кадрі, сила діяла лише за певних умов або в особливі моменти? У проєктуванні систем з частинками багато простору для творчості та інтерактивних можливостей!</p>
<h2 id="particle-systems-with-repellers"><a class="heading-link" href="#particle-systems-with-repellers">Системи частинок із відштовхувачами</a></h2>
<p>Що якщо ми підемо ще далі зі своєю програмою і додамо об’єкт <code>Repeller</code> — протилежність об’єкта <code>Attractor</code>, описаного у <a href="/forces#gravitational-attraction">Розділі 2</a>, — який відштовхуватиме будь-які частинки, які знаходяться занадто близько? Це потребує трохи більшої складності аніж рівномірне застосування сили тяжіння, тому що сила, якою відштовхувач діє на конкретну частинку, є унікальною і повинна розраховуватися окремо для кожної частинки (див. малюнок 4.6).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;879&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/317cf5f5162fe1d759967d676fd0dc40/513d4/04_particles_4.webp 576w,./static/317cf5f5162fe1d759967d676fd0dc40/5a51f/04_particles_4.webp 1152w,./static/317cf5f5162fe1d759967d676fd0dc40/ad066/04_particles_4.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/317cf5f5162fe1d759967d676fd0dc40/f0254/04_particles_4.png" data-srcset="./static/317cf5f5162fe1d759967d676fd0dc40/75cad/04_particles_4.png 576w,./static/317cf5f5162fe1d759967d676fd0dc40/6af06/04_particles_4.png 1152w,./static/317cf5f5162fe1d759967d676fd0dc40/f0254/04_particles_4.png 2304w" alt="Малюнок 4.6: Ліворуч — сила тяжіння, де всі вектори однакові. Праворуч — сила відштовхування, де всі вектори спрямовані у різні напрямки"/></picture><noscript><picture><source type="image/webp" srcSet="./static/317cf5f5162fe1d759967d676fd0dc40/513d4/04_particles_4.webp 576w,./static/317cf5f5162fe1d759967d676fd0dc40/5a51f/04_particles_4.webp 1152w,./static/317cf5f5162fe1d759967d676fd0dc40/ad066/04_particles_4.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/317cf5f5162fe1d759967d676fd0dc40/f0254/04_particles_4.png" srcSet="./static/317cf5f5162fe1d759967d676fd0dc40/75cad/04_particles_4.png 576w,./static/317cf5f5162fe1d759967d676fd0dc40/6af06/04_particles_4.png 1152w,./static/317cf5f5162fe1d759967d676fd0dc40/f0254/04_particles_4.png 2304w" alt="Малюнок 4.6: Ліворуч — сила тяжіння, де всі вектори однакові. Праворуч — сила відштовхування, де всі вектори спрямовані у різні напрямки"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 4.6: Ліворуч — сила тяжіння, де всі вектори однакові. Праворуч — сила відштовхування, де всі вектори спрямовані у різні напрямки</figcaption>
</figure>
<p>Для включення у систему частинок нового об’єкта типу <code>Repeller</code>, мені знадобляться два важливі доповнення до коду:</p>
<ul>
  <li>Об’єкт типу <code>Repeller</code> (оголошений, ініціалізований і відображений)</li>
  <li>Метод, який передає об’єкт типу <code>Repeller</code> у емітер частинок, щоб відштовхувач потім міг застосувати свою силу до кожної частинки</li>
</ul>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> emitter;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> repeller;
</code></pre><div class="comment"><p>Новий код: оголошення змінної для зберігання об’єкту типу Repeller.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emitter</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">50</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  repeller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Repeller</span>(width / <span class="hljs-number">2</span> - <span class="hljs-number">20</span>, height / <span class="hljs-number">2</span>);
</code></pre><div class="comment"><p>Новий код: ініціалізація об’єкта типу Repeller.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">addParticle</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> gravity = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">applyForce</span>(gravity);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">applyRepeller</span>(repeller);
</code></pre><div class="comment"><p>Новий код: метод для застосування сили відштовхувача.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  repeller.<span class="hljs-title function_">show</span>();
</code></pre><div class="comment"><p>Новий код: відображення об’єкта відштовхувача.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Створити клас <code>Repeller</code> просто — це дублікат класу <code>Attractor</code> прикладу 2.6 з <a href="/forces#section-forces">Розділу 2</a>. Оскільки в цьому розділі не розглядається концепція маси, я додам до класу <code>Repeller</code> властивість, яка називається <code>power</code>. Цю властивість можна використовувати для регулювання потужності сили відштовхування:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Repeller</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>)  {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p>Відштовхувач не рухається, тому нам потрібна лише позиція.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">power</span> = <span class="hljs-number">150</span>;
</code></pre><div class="comment"><p>Замість маси використовується концепція потужності для масштабування сили відштовхування.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">fill</span>(<span class="hljs-number">127</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">circle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, <span class="hljs-number">32</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Складніше завдання — це написання методу <code>applyRepeller()</code>. Замість передачі об’єкта <code>p5.Vector</code> аргументом, як у методі <code>applyForce()</code>, мені потрібно передати об’єкт <code>Repeller</code> у метод <code>applyRepeller()</code> і попросити цей метод обчислити силу між відштовхувачем та кожною частинкою. Подивіться на обидва ці методи поруч:</p>
<table><tbody><tr><td>
        <pre><code>applyForce(force) {
  for (let particle of this.particles) {
    particle.applyForce(force);
  }
}</code></pre>
      </td><td>
        <pre><code>applyRepeller(repeller) {
  for (let particle of this.particles) {
    let force = repeller.repel(particle);
    particle.applyForce(force);
  }
}</code></pre>
      </td></tr></tbody></table>
<p>Методи практично однакові, але мають дві відмінності. Одну з них я згадував раніше: аргумент методу <code>applyRepeller()</code> є об’єктом <code>Repeller</code>, а не <code>p5.Vector</code>. Друга відмінність важливіша. Для кожної частинки мені потрібно обчислити й застосувати власну силу <code>p5.Vector</code>. Як розраховується ця сила? Сила розраховується у методі <code>repel()</code> класу <code>Repeller</code>, який є зворотним до методу <code>attract()</code> з класу <code>Attractor</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">repel</span>(<span class="hljs-params">particle</span>) {
</code></pre><div class="comment"><p>Всі ті ж самі кроки для обчислення сили притягування, лише з протилежним напрямком.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> force = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, particle.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p>Крок 1: Отримуємо напрямок сили.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> distance = force.<span class="hljs-title function_">mag</span>();
    distance = <span class="hljs-title function_">constrain</span>(distance, <span class="hljs-number">5</span>, <span class="hljs-number">50</span>);
</code></pre><div class="comment"><p>Крок 2: Отримуємо і обмежуємо відстань.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> strength = -<span class="hljs-number">1</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">power</span> / (distance * distance);
</code></pre><div class="comment"><p>Крок 3: Обчислюємо магнітуду, використовуючи змінну power.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    force.<span class="hljs-title function_">setMag</span>(strength);
    <span class="hljs-keyword">return</span> force;
</code></pre><div class="comment"><p>Крок 4: Складаємо вектор із напрямку і магнітуди.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зауважте, що протягом всього цього процесу додавання відштовхувача у середовище я жодного разу не звертався до редагування класу <code>Particle</code>. Частинка не повинна нічого знати про деталі свого середовища, їй просто потрібно керувати своїм положенням, швидкістю і прискоренням, а також мати здатність сприймати зовнішню силу та реагувати на неї.</p>
<p>Тепер я готовий написати цей приклад повністю, знову оминувши клас <code>Particle</code> , який не змінився.</p>
<div data-type="example">
  <h3 id="example-47-a-particle-system-with-a-repeller"><a class="heading-link" href="#example-47-a-particle-system-with-a-repeller">Приклад 4.7: Система частинок із відштовхувачем</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/example_4_7_particle_system_with_repeller"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/H4TMayNak" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> emitter;
</code></pre><div class="comment"><p>Один емітер частинок.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> repeller;
</code></pre><div class="comment"><p>Один відштовхувач.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emitter</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  repeller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Repeller</span>(width / <span class="hljs-number">2</span>, <span class="hljs-number">200</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">100</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">addParticle</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> gravity = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
  emitter.<span class="hljs-title function_">applyForce</span>(gravity);
</code></pre><div class="comment"><p>Налаштування загальної гравітації.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">applyRepeller</span>(repeller);
</code></pre><div class="comment"><p>Застосування відштовхувача.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  repeller.<span class="hljs-title function_">show</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Emitter</span> {
</code></pre><div class="comment"><p>Клас Emitter керує всіма частинками.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">addParticle</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">y</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyForce</span>(<span class="hljs-params">force</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> particle <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>) {
      particle.<span class="hljs-title function_">applyForce</span>(force);
    }
</code></pre><div class="comment"><p>Застосування сили у вигляді вектора p5.Vector.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyRepeller</span>(<span class="hljs-params">repeller</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> particle <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>) {
      <span class="hljs-keyword">let</span> force = repeller.<span class="hljs-title function_">repel</span>(particle);
      particle.<span class="hljs-title function_">applyForce</span>(force);
    }
</code></pre><div class="comment"><p>Розрахунок сили для кожної частинки на основі відштовхувача.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> particle = <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      particle.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">if</span> (particle.<span class="hljs-title function_">isDead</span>()) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Repeller</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">power</span> = <span class="hljs-number">150</span>;
</code></pre><div class="comment"><p>Потужність відштовхувача.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">fill</span>(<span class="hljs-number">127</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">circle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>, <span class="hljs-number">32</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">repel</span>(<span class="hljs-params">particle</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> force = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, particle.<span class="hljs-property">position</span>);
    <span class="hljs-keyword">let</span> distance = force.<span class="hljs-title function_">mag</span>();
</code></pre><div class="comment"><p></p></div></div><div class="continue bottom-align pair split"><pre><code class="hljs code language-javascript">    distance = <span class="hljs-title function_">constrain</span>(distance, <span class="hljs-number">5</span>, <span class="hljs-number">50</span>);
    <span class="hljs-keyword">let</span> strength = -<span class="hljs-number">1</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">power</span> / (distance * distance);
    force.<span class="hljs-title function_">setMag</span>(strength);
    <span class="hljs-keyword">return</span> force;
</code></pre><div class="comment"><p>Алгоритм цього методу майже такий самий, як у Розділі 2 де сила заснована на гравітаційному притяганні.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зверніть увагу на додавання змінної <code>power</code> у класі <code>Repeller</code>, яка є величиною відштовхуваної сили. Ця властивість стає особливо цікавою, коли ви маєте кілька притягувачів (атракторів) і відштовхувачів (репелерів), кожен з різними значеннями потужності. Наприклад, сильні а трактори й слабкі репелери можуть призвести до скупчення частинок навколо атракторів, тоді як більш потужні репелери можуть призвести до утворення деяких шляхів або каналів між ними. Це натяки на те, що вас очікує у <a href="/autonomous-agents#section-autonomous-agents">Розділі 5</a>, де я досліджуватиму концепцію складної системи.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-49"><a class="heading-link" href="#exercise-49">Вправа 4.9</a></h3>
  <p>Розширте приклад 4.7, щоб включити в нього кілька репелерів і атракторів. Як ви можете використати наслідування і поліморфізм для створення окремих класів <code>Repeller</code> та <code>Attractor</code> без дублювання коду?</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-410"><a class="heading-link" href="#exercise-410">Вправа 4.10</a></h3>
  <p>Створіть систему частинок у якій кожна частинка реагує на кожну іншу частинку. (Як це можна зробити я також детально покажу в <a href="/autonomous-agents#section-autonomous-agents">Розділі 5</a>.)</p>
</div>
<h2 id="image-textures-and-additive-blending"><a class="heading-link" href="#image-textures-and-additive-blending">Текстури зображення й адитивне змішування</a></h2>
<p>Хоча ця книга майже повністю зосереджена на алгоритмах і поведінці, а не на комп’ютерній графіці та дизайні, я не думаю, що зміг би спокійно жити, якби завершив обговорення про системи частинок не глянувши хоча б раз на приклад, який включає текстурування частинок зображенням. Все-таки спосіб зображення частинок є ключовою складовою у головоломці створення певних типів візуальних ефектів. Наприклад, порівняйте дві симуляції диму, показані на малюнку 4.7.</p>
<figure>
  <div class="col-list">
    <div>
      <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/figure_4_8_circles"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/Cq4knsBaA" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    </div>
    <div>
      <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/figure_4_8_image"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/hr2PwuoId" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    </div>
  </div>
  <figcaption>Малюнок 4.7: Білі круги зліва і нечітке зображення кругів з прозорістю справа</figcaption>
</figure>
<p>Обидва зображення згенеровані ідентичними алгоритмами. Єдина різниця полягає в тому, що кожна частинка в анімації ліворуч намальована звичайним білим кругом, тоді як в анімації праворуч кожна частинка намальована нечітким кругом. На малюнку 4.8 показано обидва типи текстур для цих частинок.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:5334px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1196&#x27; width=&#x27;5334&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/73997710f1444f7f9c9e6113f082abe2/89f69/04_particles_5.webp 1334w,./static/73997710f1444f7f9c9e6113f082abe2/8ff91/04_particles_5.webp 2667w,./static/73997710f1444f7f9c9e6113f082abe2/890be/04_particles_5.webp 5334w" sizes="(min-width: 5334px) 5334px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 5334px) 5334px, 100vw" decoding="async" loading="lazy" data-src="./static/73997710f1444f7f9c9e6113f082abe2/1c552/04_particles_5.png" data-srcset="./static/73997710f1444f7f9c9e6113f082abe2/f02fb/04_particles_5.png 1334w,./static/73997710f1444f7f9c9e6113f082abe2/feaf9/04_particles_5.png 2667w,./static/73997710f1444f7f9c9e6113f082abe2/1c552/04_particles_5.png 5334w" alt="Малюнок 4.8: Дві текстури зображень, повністю білий круг та нечіткий руго з розфокусованими краями"/></picture><noscript><picture><source type="image/webp" srcSet="./static/73997710f1444f7f9c9e6113f082abe2/89f69/04_particles_5.webp 1334w,./static/73997710f1444f7f9c9e6113f082abe2/8ff91/04_particles_5.webp 2667w,./static/73997710f1444f7f9c9e6113f082abe2/890be/04_particles_5.webp 5334w" sizes="(min-width: 5334px) 5334px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 5334px) 5334px, 100vw" decoding="async" loading="lazy" src="./static/73997710f1444f7f9c9e6113f082abe2/1c552/04_particles_5.png" srcSet="./static/73997710f1444f7f9c9e6113f082abe2/f02fb/04_particles_5.png 1334w,./static/73997710f1444f7f9c9e6113f082abe2/feaf9/04_particles_5.png 2667w,./static/73997710f1444f7f9c9e6113f082abe2/1c552/04_particles_5.png 5334w" alt="Малюнок 4.8: Дві текстури зображень, повністю білий круг та нечіткий руго з розфокусованими краями"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 4.8: Дві текстури зображень, повністю білий круг та нечіткий круг з розфокусованими краями</figcaption>
</figure>
<p>Використання зображення для текстурування частинок може дати вам задешево багато можливостей для створення реалістичності візуального ефекту. Однак спочатку вам потрібно буде створити зображення необхідної текстури. Я рекомендую використовувати формат PNG, оскільки p5.js збереже його альфа-канал (відповідає за прозорість) при малюванні зображення, що необхідно для змішування текстур при накладанні частинок одна на одну. Ви можете створити ці текстури багатьма способами: ви навіть можете створити їх програмно за допомоги p5.js (я додам приклад на сайті книги), або ви можете використовувати інші безплатні чи комерційні інструменти редагування графіки.</p>
<p>Після створення PNG-файлу і розміщення його у теці <em>data</em> вашого проєкту, знадобиться додати лише кілька рядків коду.</p>
<div data-type="example">
  <h3 id="example-48-an-image-texture-particle-system"><a class="heading-link" href="#example-48-an-image-texture-particle-system">Приклад 4.8: Текстурована система частинок</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/example_4_8_image_texture_system_smoke"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/9c_CPrg3Bp" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<p>Спочатку оголосіть змінну для зберігання зображення:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> img;
</code></pre><div class="comment"><p></p></div></div></div>
<div class="avoid-break">
  <p>Потім завантажте зображення у функції <code>preload()</code>:</p>
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">preload</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  img = <span class="hljs-title function_">loadImage</span>(<span class="hljs-string">&quot;texture.png&quot;</span>);
</code></pre><div class="comment"><p>Завантаження файлу PNG.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Під час малювання частинки використовуйте змінну <code>img</code> , замість малювання круга або прямокутника:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">imageMode</span>(<span class="hljs-variable constant_">CENTER</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">tint</span>(<span class="hljs-number">255</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifespan</span>);
</code></pre><div class="comment"><p>Зверніть увагу, що функція tint() для зображення є еквівалентом функції fill() для фігур.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">image</span>(img, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Цей приклад із димом також є хорошою нагодою переглянути частину цієї книги про гауссівський розподіл, а саме <a href="/random#a-normal-distribution-of-random-numbers" class="page-reference">“Нормальний розподіл випадкових чисел”</a>. Замість запуску частинок у чисто випадковому напрямку, що створює фонтаноподібний ефект, результат виглядатиме більш схожим на дим, якщо значення початкових швидкостей векторів формуються переважно навколо середнього значення, з меншою ймовірністю значних відхилень.</p>
<div class="avoid-break">
  <p>Використовуючи функцію <code>randomGaussian()</code>, швидкості для частинок можна ініціалізувати наступним чином:</p>
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> vx = <span class="hljs-title function_">randomGaussian</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> vy = <span class="hljs-title function_">randomGaussian</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">0.3</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>(vx, vy);
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Також у цьому прикладі я застосував до диму силу вітру, зіставлену з горизонтальним положенням курсора:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> dx = <span class="hljs-title function_">map</span>(mouseX, <span class="hljs-number">0</span>, width, -<span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>);
  <span class="hljs-keyword">let</span> wind = <span class="hljs-title function_">createVector</span>(dx, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p>Напрямок сили вітру залежить від змінної mouseX.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">applyForce</span>(wind);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">addParticle</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Крім розробки самої текстури, вам слід враховувати її роздільну здатність. Рендеринг великої кількості текстур високої роздільної здатності може значно вплинути на продуктивність програми, особливо якщо код має динамічно змінювати їх розмір. Найкращим сценарієм для оптимальної швидкості є підготовка текстури відповідного розміру до тої роздільної здатності, яку ви збираєтеся використовувати. Якщо вам потрібні частинки різного розмі ру, то в ідеалі ви повинні створити текстуру максимального розміру, яка може бути використана для будь-якої з частинок.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-411"><a class="heading-link" href="#exercise-411">Вправа 4.11</a></h3>
  <p>Спробуйте створити інші текстури для різних типів ефектів. Чи можете ви зробити так, щоб ваша система частинок виглядала як вогонь, а не дим?</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-412"><a class="heading-link" href="#exercise-412">Вправа 4.12</a></h3>
  <p>Використайте масив зображень і застосуйте їх до різних об’єктів <code>Particle</code>. Деякі частинки малюватимуть одне й те саме зображення, але його достатньо завантажити лише один раз, а отже не потрібно викликати функцію <code>loadImage()</code> більше, ніж потрібно. (Досить одного разу для кожного файлу зображення!)</p>
</div>
<p>Також варто зазначити, що у комп’ютерній графіці існує багато різних алгоритмів змішування кольорів. Їх часто називають <strong>режимами змішування</strong>. Зазвичай, коли ви малюєте щось поверх чогось іншого в p5.js, ви бачите лише верхній шар — це типова поведінка для “змішування” без змішування взагалі. Коли ж пікселі мають значення альфа-прозорості (як у прикладі з димом), p5.js автомати чно використовує алгоритм альфа-композиції, який на основі цих альфа-значень поєднує у відповідних відсотках пікселі фону з новими пікселями переднього плану.</p>
<p>Однак можна малювати за допомогою інших режимів змішування. Наприклад, дуже популярною технікою для систем частинок є <strong>адитивне змішування</strong>. Першопроходцем цього режиму був Роберт Ходжін у його класичному дослідженні системи частинок і сил <a href="https://roberthodgin.com/project/magnetosphere" target="_blank" rel="noopener">Магнітосфери</a>, яке згодом стало візуальною складовою для ранніх версій iTunes і відображенні анімованих візуальних ефектів, які реагували на звук.</p>
<p>Адитивне змішування — це простий алгоритм змішування, який додає значення пікселів одного шару до іншого, обмежуючи всі значення до 255. Це призводить до ефекту сяйва у космічному стилі, коли при додаванні більшої кількості шарів кольори стають все яскравішими і яскравішими.</p>
<div data-type="example">
  <h3 id="example-49-additive-blending"><a class="heading-link" href="#example-49-additive-blending">Приклад 4.9: Адитивне змішування</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/04_particles/noc_4_08_particle_system_smoke_webgl"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/fUCtCcOtB" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<p>Перш ніж щось малювати, встановіть режим змішування за допомогою функції <code>blendMode()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">blendMode</span>(<span class="hljs-variable constant_">ADD</span>);
</code></pre><div class="comment"><p>Використання адитивного змішування.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">clear</span>();
</code></pre><div class="comment"><p>Виклик функції clear() потрібен оскільки фон додається у результат і не перекриває раніше намальовану сцену.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">0</span>);
</code></pre><div class="comment"><p>Ефект світіння адитивного змішування не працюватиме з білим (або дуже яскравим) фоном.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> dx = <span class="hljs-title function_">map</span>(mouseX, <span class="hljs-number">0</span>, width, -<span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> wind = <span class="hljs-title function_">createVector</span>(dx, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">applyForce</span>(wind);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  emitter.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    emitter.<span class="hljs-title function_">addParticle</span>();
  }
</code></pre><div class="comment"><p>У цьому прикладі, для збільшення ефекту, замість додавання одної частинки за раз додаються одразу 3.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Адитивне змішування і система частинок дають можливість обговорити рендерери комп’ютерної графіки. <strong>Рендерер</strong> — це певна програма, яка відповідає за малювання на екрані (рендеринг). По замовчуванню бібліотека p5.js використовує стандартний рендерер для візуалізації 2D-зображень та анімації, який входить до складу сучасних веббраузерів і яким ви досі користувалися, не усвідомлюючи цього. Однак існує додатковий варіант рендерингу під назвою <code>WEBGL</code>. WebGL, що розшифровується як Web Graphics Library, є високопродуктивним рендерером на основі браузера для 2D та 3D графіки. Він використовує додатк ові можливості, доступні у графічній карті вашого комп’ютера. Щоб увімкнути його, додайте третій аргумент до функції <code>createCanvas()</code>.</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>, <span class="hljs-variable constant_">WEBGL</span>);
</code></pre><div class="comment"><p>Увімкнення WEBGL рендерингу.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Як правило рендеринг WebGL необхідний лише якщо ви малюєте у своїй програмі 3D-форми. Однак навіть для двовимірних програм рендеринг WebGL може бути корисним у деяких випадках — в залежності від апаратного забезпечення комп’ютера і конкретних деталей вашої програми, він може значно покращити продуктивність малювання. Система частинок (особливо з увімкненим адитивним змішуванням) саме один із таких випадків, де у режимі <code>WEBGL</code> можна намалювати набагато більше частинок без сповільнення роботи програми. Майте на увазі, що режим <code>WEBGL</code> змінює початкову точку координат <code>(0,0)</code>, зміщуючи її у центр полотна, на відміну від лівого верхнього кута як у звичайному режимі. Режим <code>WEBGL</code> також змінює поведінку деяких функцій і може вплинути на якість самого рендерингу. Крім того, деякі старіші пристрої або браузери не підтримують WebGL, хоча такі випадки трапляються рідко. Ви можете дізнатися більше інформації у <a href="https://thecodingtrain.com/webgl" target="_blank" rel="noopener">відеороликах про WebGL на вебсайті Coding Train</a>.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-413"><a class="heading-link" href="#exercise-413">Вправа 4.13</a></h3>
  <p>У прикладі 4.9, щоб створити більш нашарований ефект, всередині функції <code>draw()</code> розміщено цикл <code>for</code>, який за один раз додає одразу по три частинки. Кращим рішенням було б змінити метод <code>addParticle()</code>, щоб саме він приймав аргумент кількості частинок, які слід додати, наприклад <code>addParticle(3)</code>. Заповніть нове визначення цього методу. Зробіть так, щоб якщо не передається жодне значення, за замовчуванням додавалася лише одна частинка.</p>
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">addParticle</span>(<span class="hljs-params">amount = <span class="hljs-number">1</span></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; amount; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">particles</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Particle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span>.<span class="hljs-property">y</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
  <p></p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-414"><a class="heading-link" href="#exercise-414">Вправа 4.14</a></h3>
  <p>Використовуйте функцію <code>tint()</code> в поєднанні з адитивним змішуванням для створення ефекту веселки. Спробуйте змішування з іншими режимами, такими як: <code>SUBTRACT</code>, <code>LIGHTEST</code>, <code>DARKEST</code>, <code>DIFFERENCE</code>, <code>EXCLUSION</code> або <code>MULTIPLY</code>.</p>
</div>
<div data-type="project" class="callout">
  <h3 id="the-ecosystem-project-5"><a class="heading-link" href="#the-ecosystem-project-5">Проєкт “Екосистема”</a></h3>
  <p>Візьміть своє створіння з третього розділу і налаштуйте систему створінь. Як вони взаємодіють одне з одним? Чи можете ви використати наслідування і поліморфізм для створення різних створінь, що походять з одної кодової бази? Розробіть методологію того, як вони конкурують за ресурси (наприклад, за їжу). Чи можете ви відстежувати здоров’я створінь, так само як тривалість життя частинки, за необхідності видаляючи їх із системи? Які правила можна включити у систему для контролю народжуваності створінь?</p>
  <p>(Для дизайну створіння ви також можете використати систему частинок. Що станеться, якщо емітер буде зв’язаний з положенням створіння?)</p>
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1420&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#a8a8a8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/14db32daa721654a3e88f7af2fc5f627/be6fc/04_particles_6.webp 576w,./static/14db32daa721654a3e88f7af2fc5f627/7c4ba/04_particles_6.webp 1152w,./static/14db32daa721654a3e88f7af2fc5f627/2e9c6/04_particles_6.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/14db32daa721654a3e88f7af2fc5f627/43bff/04_particles_6.png" data-srcset="./static/14db32daa721654a3e88f7af2fc5f627/09264/04_particles_6.png 576w,./static/14db32daa721654a3e88f7af2fc5f627/8a8ae/04_particles_6.png 1152w,./static/14db32daa721654a3e88f7af2fc5f627/43bff/04_particles_6.png 2304w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="./static/14db32daa721654a3e88f7af2fc5f627/be6fc/04_particles_6.webp 576w,./static/14db32daa721654a3e88f7af2fc5f627/7c4ba/04_particles_6.webp 1152w,./static/14db32daa721654a3e88f7af2fc5f627/2e9c6/04_particles_6.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/14db32daa721654a3e88f7af2fc5f627/43bff/04_particles_6.png" srcSet="./static/14db32daa721654a3e88f7af2fc5f627/09264/04_particles_6.png 576w,./static/14db32daa721654a3e88f7af2fc5f627/8a8ae/04_particles_6.png 1152w,./static/14db32daa721654a3e88f7af2fc5f627/43bff/04_particles_6.png 2304w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption></figcaption>
  </figure>
</div>
</section>
<hr/><section class="not-prose flex w-full justify-between"><div><a class="group block" href="./oscillation.html"><p class="text-gray-500">Попередній розділ</p><span class="text-lg font-semibold group-hover:underline">← <!-- -->3. Коливання</span></a></div><div><a class="group block text-right" href="./autonomous-agents.html"><p class="text-gray-500">Наступний розділм</p><span class="text-lg font-semibold group-hover:underline">5. Автономні агенти<!-- --> →</span></a></div></section></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script src="./assets/js/main.js"></script></body></html>