<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><meta data-react-helmet="true" name="description" content="Досі я демонстрував неживі об’єкти, розташовані на полотні бездушні фігури, які рухаються під впливом сил свого середовища. Але це Природа коду. Що, я"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://natureofcode.com"/><meta data-react-helmet="true" property="og:image" content="https://natureofcode.com/static/7dd3422c43faa1513528cd25636d9e6b/b08a9/cover.png"/><meta data-react-helmet="true" property="og:title" content="5. Автономні агенти"/><meta data-react-helmet="true" property="og:description" content="Досі я демонстрував неживі об’єкти, розташовані на полотні бездушні фігури, які рухаються під впливом сил свого середовища. Але це Природа коду. Що, я"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="5. Автономні агенти"/><meta data-react-helmet="true" name="twitter:description" content="Досі я демонстрував неживі об’єкти, розташовані на полотні бездушні фігури, які рухаються під впливом сил свого середовища. Але це Природа коду. Що, я"/><meta data-react-helmet="true" name="twitter:image" content="https://natureofcode.com/static/7dd3422c43faa1513528cd25636d9e6b/b08a9/cover.png"/>

    <link rel="stylesheet" href="./assets/styles/global.css">

    <noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="./favicon-32x32.png" type="image/png"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><title data-react-helmet="true">5. Автономні агенти / Nature of Code</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="fixed left-0 right-0 top-0 z-40 bg-white px-6 lg:px-8"><div class="mx-auto flex h-[5em] max-w-6xl items-center justify-between"><div class="flex flex-col gap-x-6 lg:flex-row lg:items-center"><a href="/noc2/static"><span class="text-lg font-black tracking-widest text-noc-400"><span class="font-black">ПРИРОДА</span> КОДУ</span></a><span class="hidden text-sm tracking-widest text-noc-400 xl:block">ДАНІЕЛЬ ШИФФМАН</span></div><button class="flex h-9 w-11 cursor-pointer flex-col items-center justify-between p-2 lg:hidden" aria-label="Toggle menu" title="Toggle menu"><span class="block h-0.5 w-full rounded bg-noc-200 transition-transform"></span><span class="block h-0.5 w-full rounded bg-noc-200 transition-opacity" style="opacity:1"></span><span class="block h-0.5 w-full rounded bg-noc-200 transition-transform"></span></button><div class="hidden items-center gap-6 lg:flex"><ul class="flex items-center gap-6"><li><a href="https://github.com/sponsors/CodingTrain" class="flex items-center gap-1.5 text-sm text-gray-500 hover:underline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="text-noc-200" height="1.2em" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"></path></svg>SUPPORT</a></li><li><a href="https://github.com/nature-of-code/noc-book-2" class="flex items-center gap-1.5 text-sm text-gray-500 hover:underline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="text-noc-200" height="1.2em" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>GITHUB</a></li><li><a href="https://thecodingtrain.com/" class="flex items-center text-sm text-gray-500 hover:underline"><img src="./static/codingtrain_logo-53b0a841be45c7eac7a12f88b7bea596.png" alt="Coding Train&#x27;s logo" class="-ml-2 w-8"/>CODING TRAIN</a></li></ul><div class="not-prose flex items-center gap-4 undefined"><div class="relative"><a href="https://natureofcode.com/" target="_blank" class="flex items-center text-sm text-gray-500 hover:underline"><img src="./favicon-32x32.png" alt="The Nature Of Code logo" class="noc2-logo"/>THE NATURE OF CODE</a></div></div></div></div></header>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YD31R75NSS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YD31R75NSS');
    </script>
    <nav class="fixed bottom-0 left-0 right-0 top-[5em] z-20 overflow-y-auto bg-white px-6 lg:hidden mb-menu hidden">
        <ul class="my-7 space-y-2">
            <li><a class="text-lg text-gray-800" href="./dedication.html">Присвята</a></li>
            <li><a class="text-lg text-gray-800" href="./acknowledgements.html">Подяки</a></li>
            <li><a class="text-lg text-gray-800" href="./introduction.html">Вступ</a></li>
            <li>
                <button class="sub-menu-btn flex items-center gap-2 text-lg text-gray-800">
                    <span>Розділи</span>
                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 transition-transform" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" style="transform: scaleY(1);"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </button>
                <ul class="space-y-2 py-2 pl-4 sub-menu hidden">
                    <li><a class="flex items-center text-gray-600" href="./random.html"><span class="w-8">0</span><span>Випадковість</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./vectors.html"><span class="w-8">1</span><span>Вектори</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./forces.html"><span class="w-8">2</span><span>Сили</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./oscillation.html"><span class="w-8">3</span><span>Коливання</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./particles.html"><span class="w-8">4</span><span>Система частинок</span></a></li>
                    <li><a aria-current="page" class="flex items-center text-gray-600 font-bold" href="./autonomous-agents.html"><span class="w-8">5</span><span>Автономні агенти</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./physics-libraries.html"><span class="w-8">6</span><span>Фізичні бібліотеки</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./cellular-automata.html"><span class="w-8">7</span><span>Клітинні автомати</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./fractals.html"><span class="w-8">8</span><span>Фрактали</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./genetic-algorithms.html"><span class="w-8">9</span><span>Еволюційне моделювання</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./neural-networks.html"><span class="w-8">10</span><span>Нейронні мережі</span></a></li>
                    <li><a class="flex items-center text-gray-600" href="./neuroevolution.html"><span class="w-8">11</span><span>Нейроеволюція</span></a></li>
                </ul>
            </li>
            <li><a class="text-lg text-gray-800" href="./appendix-creature.html">Додаток: Дизайн створінь</a></li>
            <li><a class="text-lg text-gray-800" href="./resources.html">Додаткові ресурси</a></li>
            <li><a class="text-lg text-gray-800" href="./credits.html">Credits</a></li>
            <li><a class="text-lg text-gray-800" href="./translation.html">Про переклад</a></li>
            <li><a class="text-lg text-gray-800" href="./examples.html">Приклади</a></li>
        </ul>
        <ul class="my-7 space-y-2">
            <li><a target="_blank" href="https://github.com/sponsors/CodingTrain" class="flex items-center gap-1 text-lg text-gray-800">Support<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>
            <li><a target="_blank" href="https://github.com/nature-of-code/noc-book-2" class="flex items-center gap-1 text-lg text-gray-800">GitHub<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>
            <li><a target="_blank" href="https://thecodingtrain.com/" class="flex items-center gap-1 text-lg text-gray-800">Coding Train<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>

            <li><a target="_blank" href="https://natureofcode.com/" class="flex items-center gap-1 text-lg text-gray-800">The Nature Of Code<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 text-gray-400" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li>
        </ul>
    </nav>
    <div class="mt-[6em] px-6 lg:px-8"><div class="mx-auto max-w-6xl lg:flex lg:justify-between lg:gap-10 xl:gap-14"><aside class="sticky top-[6em] z-10 hidden max-h-[calc(100vh-6em)] min-w-[14em] overflow-y-auto pb-8 lg:block lg:flex-grow"><nav class="border-noc-200 rounded-3xl border"><ul class="divide-noc-200 divide-y"><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./dedication.html">Присвята</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./acknowledgements.html">Подяки</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./introduction.html">Вступ</a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./random.html"><span class="w-8">0</span><span class="group-hover:underline">Випадковість</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./vectors.html"><span class="w-8">1</span><span class="group-hover:underline">Вектори</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./forces.html"><span class="w-8">2</span><span class="group-hover:underline">Сили</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./oscillation.html"><span class="w-8">3</span><span class="group-hover:underline">Коливання</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./particles.html"><span class="w-8">4</span><span class="group-hover:underline">Системи частинок</span></a></li><li><a aria-current="page" class="group relative flex items-center px-3 py-2 text-sm font-bold" href="./autonomous-agents.html"><span class="w-8">5</span><span class="group-hover:underline">Автономні агенти</span></a><ul class="space-y-1 pb-2"><li><a href="#forces-from-within" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Внутрішні сили</a></li><li><a href="#vehicles-and-steering" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Агенти й керування</a></li><li><a href="#flow-fields" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Поле потоків</a></li><li><a href="#path-following" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Слідування шляхом</a></li><li><a href="#complex-systems" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Складні системи</a></li><li><a href="#algorithmic-efficiency-or-why-does-my-sketch-run-so-slowly" class="ml-11 block py-0.5 pr-2 text-sm text-gray-500 hover:underline false">Ефективність алгоритмів (або чому моя програма працює так повільно?)</a></li></ul></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./physics-libraries.html"><span class="w-8">6</span><span class="group-hover:underline">Фізичні бібліотеки</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./cellular-automata.html"><span class="w-8">7</span><span class="group-hover:underline">Клітинні автомати</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./fractals.html"><span class="w-8">8</span><span class="group-hover:underline">Фрактали</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./genetic-algorithms.html"><span class="w-8">9</span><span class="group-hover:underline">Еволюційне моделювання</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./neural-networks.html"><span class="w-8">10</span><span class="group-hover:underline">Нейронні мережі</span></a></li><li><a class="group relative flex items-center px-3 py-2 text-sm" href="./neuroevolution.html"><span class="w-8">11</span><span class="group-hover:underline">Нейроеволюція</span></a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./appendix-creature.html">Додаток: Дизайн створінь </a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./resources.html">Додаткові ресурси</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./credits.html">Credits</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./translation.html">Про переклад</a></li><li><a class="relative block px-3 py-2 text-sm hover:underline" href="./examples.html">Приклади</a></li></ul></nav></aside><main class="prose mx-auto max-w-[50em] pb-8"><section data-type="chapter" id="section-autonomous-agents">
<h1 id="chapter-5-autonomous-agents">Розділ 5. Автономні агенти</h1>
<div class="chapter-opening-quote">
  <blockquote data-type="epigraph">
    <p>Життя — це подорож, а не пункт призначення.</p>
    <div class="chapter-opening-quote-source">
      <p>— Ральф Волдо Емерсон</p>
    </div>
  </blockquote>
</div>
<div class="chapter-opening-figure">
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1920px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1080&#x27; width=&#x27;1920&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#083848;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/d03fbfe781eced2c4f36cf7667e139f1/3a3a2/05_steering_1.webp 480w,./static/d03fbfe781eced2c4f36cf7667e139f1/bde8a/05_steering_1.webp 960w,./static/d03fbfe781eced2c4f36cf7667e139f1/c512e/05_steering_1.webp 1920w" sizes="(min-width: 1920px) 1920px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1920px) 1920px, 100vw" decoding="async" loading="lazy" data-src="./static/d03fbfe781eced2c4f36cf7667e139f1/a764f/05_steering_1.jpg" data-srcset="./static/d03fbfe781eced2c4f36cf7667e139f1/fb67e/05_steering_1.jpg 480w,./static/d03fbfe781eced2c4f36cf7667e139f1/3059d/05_steering_1.jpg 960w,./static/d03fbfe781eced2c4f36cf7667e139f1/a764f/05_steering_1.jpg 1920w" alt="Риба Моі (фото надано національним управлінням океанічних і атмосферних досліджень США)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/d03fbfe781eced2c4f36cf7667e139f1/3a3a2/05_steering_1.webp 480w,./static/d03fbfe781eced2c4f36cf7667e139f1/bde8a/05_steering_1.webp 960w,./static/d03fbfe781eced2c4f36cf7667e139f1/c512e/05_steering_1.webp 1920w" sizes="(min-width: 1920px) 1920px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1920px) 1920px, 100vw" decoding="async" loading="lazy" src="./static/d03fbfe781eced2c4f36cf7667e139f1/a764f/05_steering_1.jpg" srcSet="./static/d03fbfe781eced2c4f36cf7667e139f1/fb67e/05_steering_1.jpg 480w,./static/d03fbfe781eced2c4f36cf7667e139f1/3059d/05_steering_1.jpg 960w,./static/d03fbfe781eced2c4f36cf7667e139f1/a764f/05_steering_1.jpg 1920w" alt="Риба Моі (фото надано національним управлінням океанічних і ат мосферних досліджень США)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption></figcaption>
  </figure>
  <span id="moi-fish-photo-courtesy-of-the-us-national-oceanic-and-atmospheric-administration"><a class="heading-link" href="#moi-fish-photo-courtesy-of-the-us-national-oceanic-and-atmospheric-administration">Риба Моі (фото надано національним управлінням океанічних і атмосферних досліджень США)</a></span>
  <p>Шестипалі ниткопери (<em>Polydactylus sexfilis</em>), також відомі як риби королів або <em>мóі</em> на гавайський манір. Риба моі мала особливий статус для гавайської королівської сім’ї й вирощувалася у спеціальних ставках, щоб забезпечити зростання її популяції та запобігти вимиранню. Зграя проявляє витончений і злагоджений танець у своєму спільному русі, при цьому кожна окрема рибина тонко впливає та реагує на своїх сусідів.</p>
<hr/></div>
<p></p>
<p>Досі я демонстрував неживі об’єкти, розташовані на полотні бездушні фігури, які рухаються під впливом сил свого середовища. Але це <em><strong>Природа</strong> коду</em>. Що, якби я міг вдихнути життя у ці фігури? Що, якби ці фігури могли жити за своїми власними правилами? Чи можуть фігури мати надії, мрії та страхи? Запитання такого роду є предметом, що розглядається у цьому розділі. Ці питання відокремлюють бездумні об’єкти від чогось набагато цікавішого: автономних агентів.</p>
<h2 id="forces-from-within"><a class="heading-link" href="#forces-from-within">Внутрішні сили</a></h2>
<p><strong>Автономний агент</strong> — це сутність, яка самостійно вирішує, як діяти у своєму оточенні, без будь-якого впливу лідера чи глобального плану. У цій книзі <em>діяти</em> зазвичай означає рухатися. Наприклад, замість моделювання частинки, яка пасивно притягується до іншої фігури або відштовхується від неї через сили, подібні до гравітації, я б хотів створити сутність, яка має здатність або навіть “бажання” приймати рішення щодо своїх рухів. Вона може <em>вирішити</em> рухатися до цілі або від неї, як метелик, що летить на полум’я, або маленька рибка, яка ухиляється від хижака.</p>
<p>Перехід від неживих об’єктів до автономних агентів є значним конц ептуальним стрибком, але кодова база при цьому майже не змінюється. “Бажання” автономного агента рухатися — це просто інша сила, подібно до сили тяжіння або сили вітру. Просто тепер сила надходить <em>зсередини</em>.</p>
<p>Ось три ключові складові автономних агентів, які варто мати на увазі, поки я будуватиму приклади цього розділу:</p>
<ul>
  <li>
    <strong>Автономний агент має обмежену здатність до сприйняття свого довкілля.</strong> Цілком зрозуміло, що жива істота повинна бути обізнаною щодо свого середовища. Однак ця досвідченість стосується не лише зовнішнього середовища, а й внутрішнього стану агента — його положення, швидкості та інших потенційних властивостей чи навіть змодельованих емоцій. У цьому розділі я розглядатиму способи, якими агенти можуть враховувати свій власний стан під час прийняття рішень. Я також розгляну техніку програмування об’єктів зі збереженням посилань на інші об’єкти для “сприйняття” агентами свого оточення.
    Ще важливо враховувати частину про <em>обмежену</em> здатність. Чи маєте ви створити всезнавчу сутність, що рухатиметься по полотну й буде обізнана одразу про всі інші елементи на цьому полотні? Чи цей агент матиме можливість розгледіти інші об’єкти лише в межах 15 пікселів від себе? Звісно, однозначної відповіді на це питання немає, все залежить від того, що ви хочете. Я розгляну кілька можливостей протягом цього розділу, але загалом обмеження — це хороша річ для симуляції, щоб вона виглядала більш “природно”. Комаха, наприклад, може бути обмежена лише видимістю і запахами, які безпосередньо її оточують. Для моделювання істоти із реального світу, можна вивчити її фактичні обмеження з наукової точки зору. На щастя, я можу просто вигадати щось і спробувати це.
  </li>
</ul>
  <div class="avoid-break">
    <ul>
      <li><strong>Автономний агент обробляє інформацію зі свого оточення і розраховує дію.</strong> Це буде найлегша частина, оскільки дія — це сила. Середовище може повідомити агенту, що прямо на нього пливе велика страшна акула і відповідна дія буде потужною силою спрямованою у протилежному напрямку.</li>
    </ul>
  </div>
<ul>
  <li><strong>Автономний агент не має лідера.</strong> Цей третій принцип мене цікавить трохи менше і я звертатиму на нього увагу в залежності від контексту. Наприклад, якщо ви розробляєте систему, де є сенс мати лідера, що видає команди різним об’єктам, то це саме те, що ви хочете реалізувати. Однак багато прикладів у цьому розділі не матимуть лідера з важливої причини: наприкінці розділу я розгляну групову поведінку і проєктування списку автономних агентів, які проявлятимуть властивості <strong>складних систем</strong>. Це розумна і структурована групова динаміка, що виникає не від лідера, а від локальних взаємодій самих елементів.</li>
</ul>
<p>Існує багато варіантів з яких я міг би почати своє дослідження автономних агентів. Наприклад, штучне моделювання колоній мурах і термітів є фантастичною демонстрацією системи агентів. (Для отримання додаткової інформації про цю тему я рекомендую вам прочитати роботу Мітчела Резніка під назвою <em>“Turtles, Termites, and Traffic Jams”</em>.) Однак я хочу почати з розгляду поведінки агентів, яка базується на основі роботи перших чотирьох розділів цієї книги: моделювання руху за допомогою векторів та сил. Тож я повернуся до постійних героїв книги — спочатку до класу <code>Walker</code>, далі до класу <code>Mover</code>, а потім до класу <code>Particle</code> і надам йому ще одну інкарнацію.</p>
<h2 id="vehicles-and-steering"><a class="heading-link" href="#vehicles-and-steering">Агенти й керування</a></h2>
<p>Наприкінці 1980-х років комп’ютерний науковець <a href="https://www.red3d.com/cwr/" target="_blank" rel="noopener">Крейг Рейнольдс</a> розробив алгоритмічні поведінкові моделі <strong>керування</strong> анімованими персонажами. Ці поведінкові моделі дозволяли окремим елементам орієнтуватися у своєму цифровому середовищі реалістичним чином, зі стратегіями для втечі, блукання, наближення, переслідування, ухиляння тощо. Пізніше, у своїй статті 1999 року під назвою “Steering Behaviors for Autonomous Characters” Рейнольдс, для опису своїх автономних агентів, використовує слово <em>vehicle</em> (засіб переміще ння, авто, апарат — в цілому це будь-який об’єкт, що може самостійно пересуватися). Я піду тим же слідом і назву свій клас автономних агентів <code>Vehicle</code>:</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-comment">/* Що ще мені потрібно додати? */</span>
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Подібно до класів <code>Mover</code> і <code>Particle</code>, рух класу <code>Vehicle</code> контролюється його векторами положення, швидкості та прискорення. Це зробить реалізацію поведінкової моделі для одного автономного агента досить простою. Але створюючи систему з кількох елементів, які самостійно керуються відповідно до простих, локально залежних правил, можуть виникати несподівано дивовижні рівні складності. Найвідомішим прикладом є модель “boids” Рейнольдса для поведінки зграї або рою, яку я продемонструю пізніше у прикладі 5.11.</p>
<div data-type="note" class="callout">
  <h3 id="why-vehicles"><a class="heading-link" href="#why-vehicles">Чому “Vehicles”?</a></h3>
  <p>У своїй книзі 1986 року <em>“Vehicles: Experiments in Synthetic Psychology”</em>, італійський нейробіолог і кібернетик Валентіно Брайтенберг описав серію гіпотетичних апаратів (vehicles) із простими внутрішніми структурами, написавши: “Це задача з вигаданої науки або наукової фантастики, якщо вам так більше до вподоби”. Брейтенберг стверджує, що його надзвичайно прості механічні машини проявляють такі поведінки як страх, агресія, любов, передбачення та оптимізм. Рейнольдс черпав натхнення у Брейтенбер га, а я візьму своє у Рейнольдса.</p>
</div>
<p>Рейнольдс описує рух <em>ідеалізованих</em> апаратів — ідеалізованих тому, що він не займався фактичною розробкою таких машин, а радше почав з припущення, що вони працюють і відповідають визначеним правилам. Ці машини мають три рівні:</p>
<ol>
  <li><strong>Вибір дії</strong>: апарат має мету (або кілька) і може вибрати дію (або комбінацію дій) на основі цієї мети. По суті, це той момент на якому я зупинив попереднє обговорення автономних агентів. Апарат розглядає своє навколишнє середовище й <em>обирає</em> дію на основі бажання чи потреби: “Я бачу зомбі, що йде до мене. Оскільки я не хочу, щоб мої мізки були з’їдені, я збираюся втікати від зомбі”. Метою є збереження власних мізків, а дією — втеча. Стаття Рейнольдса описує багато намірів і пов’язаних з ними дій, таких як пошук цілі, уникнення перешкоди та слідування шляхом. За мить я почну створювати ці приклади за допомогою коду p5.js.</li>
  <li><strong>Керування</strong>: після вибору дії апарат має розрахувати свій наступний рух. Цей наступний рух буде силою — точніше, керувальною силою. На щастя, Рейнольдс розробив просту формулу керувальної сили, яку я використовуватиму у прикладах цього розділу: <strong>керувальна сила = бажана швидкість – поточна швидкість</strong>. Далі я детальніше розповім про цю формулу і поясню чому вона працює так ефективно.</li>
  <li><strong>Локомоція</strong> (сукупність рухів переміщення): здебільшого я збираюся ігнорувати цей третій рівень. У випадку з втечею від зомбі локомоцію можна описати як “крок лівою ногою, крок правою, лівою, правою, якнайшвидше”. Однак в межах полотна такий реальний рух для прямокутника, кола чи трикутника не має значення. Проте це не означає, що ви повинні повністю ігнорувати локомоцію. Ви можете знайти велику користь у роздумах про дизайн локомоції вашого агента і про можливі способи його анімації. Приклади в цьому розділі залишаться візуально простими, але гарною вправою була б розробка якоїсь додаткової анімації. Наприклад, ви можете додати обертання коліс, коливання весел або перебирання кінцівок.</li>
</ol>
<p>Зрештою, найважливішим рівнем для нашого розгляду є вибір дії. Що являють собою елементи вашої системи і які їхні цілі? У цьому розділі я збираюся охопити серію керувальних поведінок (тобто дій): пошуку, втечі, слідування шляхом, слідування полем потоків, руху у зграї тощо. Нагадаю, як я вже говорив у інших розділах, що основна ідея полягає не в тому, щоб ви використовували саме вказані способи поведінки в усіх своїх проєктах. Скоріше, суть полягає в тому, щоб показати вам <em>як</em> у коді моделювати керувальну поведінку — <em>будь-яку</em> керувальну поведінку — і надати основу для проєктування та розробки ваших власних рухомих об’єктів з новими й захопливими ідеями та поведінкою.</p>
<p>Що ще важливо, навіть якщо приклади в цій главі будуть дуже буквальними, ви повинні дозволити собі мислити більш абстрактно (як Брайтенберг). Що означало б для вашого агента мати “любов” як свою мету чи “страх” як рушійну силу? Нарешті (і я розгляну це в розділі <a href="#combining-behaviors" class="page-reference">“Поєднання поведінок”</a>), ви не зайдете дуже далеко, розробляючи симуляції лише з однією дією. Так, дія першого прикладу полягатиме у пошуку цілі. Але якщо ви проявите творчість, щоб зробити ці керувальні поведінки <em>вашими</em> — все зведеться до змішування й узгодження кількох дій в одному агенті. Розглядайте наступні приклади не як на самостійні варіанти симуляції поведінки, а як частини великого пазла, який ви зрештою складете.</p>
<h3 id="the-steering-force"><a class="heading-link" href="#the-steering-force">Керувальна сила</a></h3>
<p>Що ж таке керувальна сила? Щоб відповісти, розглянемо такий сценарій: агент із поточною швидкістю шукає ціль. Задля розваги, представимо цього агента у вигляді комахоподібного створіння, яке бажає поласувати смачною полуницею, як на малюнку 5.1.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;591&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/0eaa65f3efd1621bc033531c9b45f543/ae345/05_steering_2.webp 576w,./static/0eaa65f3efd1621bc033531c9b45f543/ed550/05_steering_2.webp 1152w,./static/0eaa65f3efd1621bc033531c9b45f543/0c8ae/05_steering_2.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/0eaa65f3efd1621bc033531c9b45f543/b7554/05_steering_2.png" data-srcset="./static/0eaa65f3efd1621bc033531c9b45f543/f1c37/05_steering_2.png 576w,./static/0eaa65f3efd1621bc033531c9b45f543/96f6f/05_steering_2.png 1152w,./static/0eaa65f3efd1621bc033531c9b45f543/b7554/05_steering_2.png 2304w" alt="Малюнок 5.1: Агент зі швидкістю і ціллю"/></picture><noscript><picture><source type="image/webp" srcSet="./static/0eaa65f3efd1621bc033531c9b45f543/ae345/05_steering_2.webp 576w,./static/0eaa65f3efd1621bc033531c9b45f543/ed550/05_steering_2.webp 1152w,./static/0eaa65f3efd1621bc033531c9b45f543/0c8ae/05_steering_2.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/0eaa65f3efd1621bc033531c9b45f543/b7554/05_steering_2.png" srcSet="./static/0eaa65f3efd1621bc033531c9b45f543/f1c37/05_steering_2.png 576w,./static/0eaa65f3efd1621bc033531c9b45f543/96f6f/05_steering_2.png 1152w,./static/0eaa65f3efd1621bc033531c9b45f543/b7554/05_steering_2.png 2304w" alt="Малюнок 5.1: Агент зі швидкістю і ціллю"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.1: Агент зі швидкістю і ціллю</figcaption>
</figure>
<p>Мета агента і подальша дія полягає у пошуку цілі. Пригадавши <a href="/forces#section-forces">Розділ 2</a>, ви можете почати з того, що перетворите ціль на атрактор і застосуєте гравітаційну силу, яка притягуватиме агента до цілі. Це було б цілком розумним рішенням, але концептуально це не те, що я шукаю.</p>
<p> Я не хочу просто обчислювати силу, яка тягне агента до цілі. Я скоріше хочу попросити нашого агента прийняти розумне рішення спрямуватись до цілі на основі його сприйняття власного стану (швидкості й напрямку поточного руху) та його оточення (розташування цілі). Агент має розглянути, як він бажає рухатися (вектор, який вказує на ціль), порівняти цю мету з тим, як він рухається наразі (його швидкість), і відповідним чином застосувати силу. Це саме те, про що говорить формула керувальної сили Рейнольдса:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>керувальна сила</mtext><mo>=</mo><mtext>бажана швидкість</mtext><mo>−</mo><mtext>поточна швидкість</mtext></mrow><annotation encoding="application/x-tex">\text{керувальна сила} = \text{бажана швидкість} - \text{поточна швидкість}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord cyrillic_fallback">керувальна</span><span class="mord"> </span><span class="mord cyrillic_fallback">сила</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord cyrillic_fallback">бажана</span><span class="mord"> </span><span class="mord cyrillic_fallback">швидкість</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord cyrillic_fallback">поточна</span><span class="mord"> </span><span class="mord cyrillic_fallback">швидкість</span></span></span></span></span></span></div>
<p>Або ось як це можна записати у коді p5.js:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, velocity);
</code></pre><div class="comment"><p></p></div></div></div>
<p><em>Поточна</em> швидкість не є проблемою: у класі <code>Vehicle</code> вже є змінна для цього. Однак потрібно розрахувати <em>бажану</em> швидкість. Подивіться на малюнок 5.2. Якщо мета агента визначена як <em>пош ук цілі</em>, то його бажана швидкість є вектором, що вказує від його поточного положення до положення цілі.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;593&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/2a271be02b167e6650d5f67305d1459a/ae345/05_steering_3.webp 576w,./static/2a271be02b167e6650d5f67305d1459a/dcbe7/05_steering_3.webp 1152w,./static/2a271be02b167e6650d5f67305d1459a/902dd/05_steering_3.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/2a271be02b167e6650d5f67305d1459a/dc354/05_steering_3.png" data-srcset="./static/2a271be02b167e6650d5f67305d1459a/f1c37/05_steering_3.png 576w,./static/2a271be02b167e6650d5f67305d1459a/aa88d/05_steering_3.png 1152w,./static/2a271be02b167e6650d5f67305d1459a/dc354/05_steering_3.png 2304w" alt="Малюнок 5.2: Бажана швидкість агента вказує від його положення до цілі. (Бажаний вектор має вказувати від центру агента до центру цілі, але для ілюстрації він трохи скорочений)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/2a271be02b167e6650d5f67305d1459a/ae345/05_steering_3.webp 576w,./static/2a271be02b167e6650d5f67305d1459a/dcbe7/05_steering_3.webp 1152w,./static/2a271be02b167e6650d5f67305d1459a/902dd/05_steering_3.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/2a271be02b167e6650d5f67305d1459a/dc354/05_steering_3.png" srcSet="./static/2a271be02b167e6650d5f67305d1459a/f1c37/05_steering_3.png 576w,./static/2a271be02b167e6650d5f67305d1459a/aa88d/05_steering_3.png 1152w,./static/2a271be02b167e6650d5f67305d1459a/dc354/05_steering_3.png 2304w" alt="Малюнок 5.2: Бажана швидкість агента вказує від його положення до цілі. (Бажаний вектор має вказувати від центру агента до центру цілі, але для ілюстрації він трохи скорочений)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.2: Бажана швидкість агента вказує від його положення до цілі. (Бажаний вектор має вказувати від центру агента до центру цілі, але для ілюстрації він трохи скорочений)</figcaption>
</figure>
<p>Якщо припустити наявність вектора <code>p5.Vector</code> під назвою <code>target</code>, який визначає позицію цілі, тоді маємо наступне:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, position);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Однак є ще дещо. Що, якщо полотно матиме високу роздільну здатність (роздільність), а ціль знаходиться за тисячі пікселів у стороні? Звісно, агент може захотіти миттєво телепортуватися на цільову позицію з величезною швидкістю, але це не створить ефективної анімації. Я переформулюю бажану швидкість наступним чином:</p>
<p><span class="callout highlight"><em>Агент бажає рухатися до цілі з максимально можливою швидкістю.</em></span></p>
<p>Іншими словами, вектор <code>desired</code> має вказувати від поточного положення агента до цільового положення об’єкта з магнітудою, що дорівнює максимально можливій швидкості агента, як показано на малюнку 5.3.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;640&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/5e082d0523bb9f0b37581cdf00a08c8b/baa42/05_steering_4.webp 576w,./static/5e082d0523bb9f0b37581cdf00a08c8b/28618/05_steering_4.webp 1152w,./static/5e082d0523bb9f0b37581cdf00a08c8b/7c1f8/05_steering_4.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/5e082d0523bb9f0b37581cdf00a08c8b/ed74a/05_steering_4.png" data-srcset="./static/5e082d0523bb9f0b37581cdf00a08c8b/23c77/05_steering_4.png 576w,./static/5e082d0523bb9f0b37581cdf00a08c8b/b7e74/05_steering_4.png 1152w,./static/5e082d0523bb9f0b37581cdf00a08c8b/ed74a/05_steering_4.png 2304w" alt="Малюнок 5.3: Величина бажаної швидкості агента — це “максимальна швидкість”"/></picture><noscript><picture><source type="image/webp" srcSet="./static/5e082d0523bb9f0b37581cdf00a08c8b/baa42/05_steering_4.webp 576w,./static/5e082d0523bb9f0b37581cdf00a08c8b/28618/05_steering_4.webp 1152w,./static/5e082d0523bb9f0b37581cdf00a08c8b/7c1f8/05_steering_4.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/5e082d0523bb9f0b37581cdf00a08c8b/ed74a/05_steering_4.png" srcSet="./static/5e082d0523bb9f0b37581cdf00a08c8b/23c77/05_steering_4.png 576w,./static/5e082d0523bb9f0b37581cdf00a08c8b/b7e74/05_steering_4.png 1152w,./static/5e082d0523bb9f0b37581cdf00a08c8b/ed74a/05_steering_4.png 2304w" alt="Малюнок 5.3: Величина бажаної швидкості агента — це “максимальна швидкість”"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.3: Величина бажаної швидкості агента — це <em>максимальна швидкість</em></figcaption>
</figure>
<p>Поняття максимальної швидкості було введено у <a href="/vectors#section-vectors">Розділі 1</a> для гарантії, що швидкість певного об’єкта залишатиметься в межах розумного діапазону. Однак я не завжди використовував його у наступних розділах. У <a href="/forces#section-forces">Розділі 2</a> інші сили, такі як тертя й опір, утримували швидкість під контролем, тоді як у <a href="/oscillation#section-oscillation">Розділі 3</a> коливання були викликані протилежними силами, які обмежували швидкість. У цьому розділі максимальна швидкість є ключовим параметром для управління поведінкою керованого агента, тому я включу її в усі приклади.</p>
<p>Хоча я заохочую вас розглянути, як інші сили, такі як тертя й опір, можуть поєднуватися з керувальними поведінками, я збираюся зосередитися лише на керувальних силах. Таким чином я можу включити концепцію максимальної швидкості як обмежувальний фактор при обчисленні сили. Спершу мені потрібно додати властивість, що відповідатиме за максимальну швидкість у класі <code>Vehicle</code>:</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span> = ????;
</code></pre><div class="comment"><p>Максимальна швидкість.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Потім, при обчисленні бажаної швидкості, я буду масштабувати її відповідно до максимальної швидкості:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зібравши все це разом, я тепер можу написати метод під назвою <code>seek()</code>, який отримує ціль типу <code>p5.Vector</code> і обчислює керувальну силу до цієї цілі:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">seek</span>(<span class="hljs-params">target</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target,<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
    desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p>Розрахунок бажаної швидкості до цілі на максимальній швидкості.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p>Формула Рейнольдса для керувальної сили.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
</code></pre><div class="comment"><p>Використання фізичної моделі і застосування сили
до прискорення агента.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зверніть увагу, що я завершую метод, передаючи керувальну силу у метод <code>applyForce()</code>. Це передбачає, що код побудований на основі, яку я розробив у <a href="/forces#section-forces" class="page-reference">Розділі 2</a>.</p>
<p>Щоб зрозуміти, чому керувальна формула Рейнольдса працює так добре, погляньте на малюнок 5.4. Він показує, як виглядає керувальна сила відносно положень агента і його цілі.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;747&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/ba185628a8d33ad6d57059ce9d923aab/b3c93/05_steering_5.webp 576w,./static/ba185628a8d33ad6d57059ce9d923aab/744ae/05_steering_5.webp 1152w,./static/ba185628a8d33ad6d57059ce9d923aab/489a0/05_steering_5.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/ba185628a8d33ad6d57059ce9d923aab/ade5a/05_steering_5.png" data-srcset="./static/ba185628a8d33ad6d57059ce9d923aab/c61e9/05_steering_5.png 576w,./static/ba185628a8d33ad6d57059ce9d923aab/f0003/05_steering_5.png 1152w,./static/ba185628a8d33ad6d57059ce9d923aab/ade5a/05_steering_5.png 2304w" alt="Малюнок 5.4: Агент застосовує керувальну силу рівну його бажаній швидкості мінус його поточна швидкість"/></picture><noscript><picture><source type="image/webp" srcSet="./static/ba185628a8d33ad6d57059ce9d923aab/b3c93/05_steering_5.webp 576w,./static/ba185628a8d33ad6d57059ce9d923aab/744ae/05_steering_5.webp 1152w,./static/ba185628a8d33ad6d57059ce9d923aab/489a0/05_steering_5.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/ba185628a8d33ad6d57059ce9d923aab/ade5a/05_steering_5.png" srcSet="./static/ba185628a8d33ad6d57059ce9d923aab/c61e9/05_steering_5.png 576w,./static/ba185628a8d33ad6d57059ce9d923aab/f0003/05_steering_5.png 1152w,./static/ba185628a8d33ad6d57059ce9d923aab/ade5a/05_steering_5.png 2304w" alt="Малюнок 5.4: Агент застосовує керувальну силу рівну його бажаній швидкості мінус його поточна швидкість"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.4: Агент застосовує керувальну силу рівну його бажаній швидкості мінус його поточна швидкість</figcaption>
</figure>
<p>Ця сила виглядає трохи інакше, ніж гравітаційне тяжіння. Пригадайте один із принципів автономних агентів: автономний агент має <em>обмежену</em> здатність сприймати своє оточення, включаючи власний стан. Ось ця здатність, тонко, але потужно вбудована у керувальну формулу Рейнольдса. У випадку з гравітаційним тяжінням, сила, що притягає один об’єкт до іншого, залишається о днаковою, незалежно від того, як цей об’єкт рухається. Але тут об’єкт-агент активно усвідомлює свою власну швидкість і його керувальна сила компенсується відповідно. Це додає симуляції реалістичності, оскільки спосіб, яким агент рухається до цілі, залежить від його власного розуміння свого поточного руху.</p>
<p>У всьому цьому азарті я пропустив останній крок. Якого типу цей рухомий агент? Це витончений швидкісний суперкар із чудовою керованістю? Або великий міський автобус, якому потрібно більше простору і завчасно входити у поворот? Граціозна панда чи незграбний слон? У прикладі коду, як він є зараз, немає можливості враховувати цю варіацію керувальної сили. Для цього мені потрібно обмежити величину керувальної сили. Я називатиму це обмеження максимальною силою (<code>maxforce</code> у коді):</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span> = ????;
</code></pre><div class="comment"><p>Максимальна швидкість.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span> = ????;
</code></pre><div class="comment"><p>Тепер також маємо властивість для значення максимальної сили.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Тепер мені потрібно просто залучити це обмеження перед застосуванням керувальної сили:</p>
<div class="snip-below snip-above">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">seek</span>(<span class="hljs-params">target</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
</code></pre><div class="comment"><p>Обмеження магнітуди керувальної сили.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Обмеження керувальної сили підводить до важливого моменту: мета полягає не в тому, щоб доставити агента до цілі якомога швидше. Якби це було так, я просто сказав би: “Встановіть позицію  тотожну цілі” і агент миттєво телепортувався б у вказану локацію! Замість цього, як каже Рейнольдс, мета полягає в тому, щоб рухати об’єкт “реалістично та імпровізовано”.</p>
<p>Я намагаюся зробити так, щоб агент прямував до цілі, тому, щоб імітувати задану поведінку, мушу грати з силами й змінними системи. Наприклад, велика максимальна сила керування призведе до зовсім іншої траєкторії, ніж мала (див. малюнок 5.5). Жодна з них не краща і не гірша за іншу — все залежить від бажаного ефекту. (Звісно, ці значення не обов’язково мають бути фіксованими й можуть змінюватися залежно від інших умов. Можливо, агент матиме властивість <em>енергії</em>: чим вище енергія, тим краще його керованість.)</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;489.99999999999994&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/ddbfe02747c2c7442a5a3f15f8c02e18/6a699/05_steering_6.webp 576w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/96e6e/05_steering_6.webp 1152w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/60c4f/05_steering_6.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/ddbfe02747c2c7442a5a3f15f8c02e18/5394d/05_steering_6.png" data-srcset="./static/ddbfe02747c2c7442a5a3f15f8c02e18/f1230/05_steering_6.png 576w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/397dc/05_steering_6.png 1152w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/5394d/05_steering_6.png 2304w" alt="Малюнок 5.5: Шлях з більшою максимальною силою (ліворуч) порівняно зі слабшою (праворуч)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/ddbfe02747c2c7442a5a3f15f8c02e18/6a699/05_steering_6.webp 576w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/96e6e/05_steering_6.webp 1152w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/60c4f/05_steering_6.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/ddbfe02747c2c7442a5a3f15f8c02e18/5394d/05_steering_6.png" srcSet="./static/ddbfe02747c2c7442a5a3f15f8c02e18/f1230/05_steering_6.png 576w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/397dc/05_steering_6.png 1152w,./static/ddbfe02747c2c7442a5a3f15f8c02e18/5394d/05_steering_6.png 2304w" alt="Малюнок 5.5: Шлях з більшою максимальною силою (ліворуч) порівняно зі слабшою (праворуч)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.5: Шлях з більшою максимальною силою (ліворуч) порівняно зі слабшою (праворуч)</figcaption>
</figure>
<p>Ось повний клас <code>Vehicle</code>, який включає решту елементів класу <code>Mover</code> з <a href="/forces#section-forces">Розділу 2</a>.</p>
<div data-type="example">
  <h3 id="example-51-seeking-a-target"><a class="heading-link" href="#example-51-seeking-a-target">Приклад 5.1: Пошук цілі</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_01_seek"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/Y74O77yxy" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x, y</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-title function_">createVector</span>(x, y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span> = <span class="hljs-number">6.0</span>;
</code></pre><div class="comment"><p>Додаткова змінна для розміру агента.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span> = <span class="hljs-number">8</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span> = <span class="hljs-number">0.2</span>;
</code></pre><div class="comment"><p>Довільні значення для максимальної швидкості та сили. Спробуйте змінювати їх!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">mult</span>(<span class="hljs-number">0</span>);
  }
</code></pre><div class="comment"><p>Стандартна функція оновлення.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyForce</span>(<span class="hljs-params">force</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">acceleration</span>.<span class="hljs-title function_">add</span>(force);
  }
</code></pre><div class="comment"><p>Другий закон Ньютона (спрощений).</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">seek</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
    desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
  }
</code></pre><div class="comment"><p>Алгоритм керувальної сили пошуку.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> angle = <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">heading</span>();
    <span class="hljs-title function_">fill</span>(<span class="hljs-number">127</span>);
    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>);
    <span class="hljs-title function_">push</span>();
    <span class="hljs-title function_">translate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>);
    <span class="hljs-title function_">rotate</span>(angle);
    <span class="hljs-title function_">beginShape</span>();
    <span class="hljs-title function_">vertex</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span> * <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);
    <span class="hljs-title function_">vertex</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span> * <span class="hljs-number">2</span>, -<span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span>);
    <span class="hljs-title function_">vertex</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span> * <span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span>);
    <span class="hljs-title function_">endShape</span>(<span class="hljs-variable constant_">CLOSE</span>);
    <span class="hljs-title function_">pop</span>();
</code></pre><div class="comment"><p>Поточний агент — це трикутник, спрямований у напрямку швидкості.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зауважте, що на відміну від кругів, які використовувалися для представлення рухомих об’єктів і частинок у попередніх розділах, об’єкт <code>Vehicle</code> намальовано як трикутник, визначений трьома користувацькими вершинами, встановленими за допомогою функцій <code>beginShape()</code> та <code>endShape()</code>. Це дозволяє спрямувати положення об’єкта агента в напрямку його руху, визначеного за допомогою методу <code>heading()</code>, як це було продемонстровано у <a href="/oscillation#section-oscillation">Розділі 3</a>.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-51"><a class="heading-link" href="#exercise-51">Вправа 5.1</a></h3>
  <p>Реалізуйте поведінку <em>втечі</em> (бажана швидкість така ж, як для <em>пошуку</em>, але спрямована в протилежному напрямку).</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-52"><a class="heading-link" href="#exercise-52">Вправа 5.2</a></h3>
  <p>Створіть програму, де максимальна сила та максимальна швидкість агента не залишаються постійними, а змінюються залежно від факторів навколишнього середовища.</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-53"><a class="heading-link" href="#exercise-53">Вправа 5.3</a></h3>
  <p>Реалізуйте поведінку пошуку рухомої цілі, таку поведінку часто називають <em>переслідуванням</em>. У цьому випадку потрібний вектор буде вказувати не на поточне положення цільового об’єкта, а на його майбутнє положення, екстрапольоване з його поточної швидкості. Ви побачите цю можливість агента “передбачити майбутнє” у пізніших прикладах. Рішення описано у відео <a href="https://thecodingtrain.com/pursuit" target="_blank" rel="noopener">“Pursue &amp; Evade” на вебсайті Coding Train</a>.</p>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/exercise_5_2"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/RkDbZ0drr" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<h3 id="the-arrive-behavior"><a class="heading-link" href="#the-arrive-behavior">Поведінка наближення</a></h3>
<p>Попрацювавши трохи з поведінкою пошуку ви, ймовірно, запитаєте себе: “А якщо я хочу, щоб агент сповільнювався при наближенні до цілі?” Перш ніж я зможу почати відповідати на це запитання, мені слід пояснити, чому пошукова поведінка змушує агента пролітати повз ціль, спонукаючи його розвертатися і повертатися назад. Розглянемо мозок агента в процесі пошуку. Що він думає у кожному кадрі анімації?</p>
<ul>
  <li>Я хочу якомога швидше рухатись до цілі.</li>
  <li>Я хочу якомога швидше рухатись до цілі.</li>
  <li>Я хочу якомога швидше рухатись до цілі.</li>
  <li>Я хочу якомога швидше рухатись до цілі.</li>
  <li>Я хочу якомога швидше рухатись до цілі.</li>
  <li>І так далі...</li>
</ul>
<div class="half-width-right">
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1502px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;917&#x27; width=&#x27;1502&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/9184c08c847a43cc135f94d8e635bb56/d5c1b/05_steering_7.webp 376w,./static/9184c08c847a43cc135f94d8e635bb56/33d53/05_steering_7.webp 751w,./static/9184c08c847a43cc135f94d8e635bb56/14b32/05_steering_7.webp 1502w" sizes="(min-width: 1502px) 1502px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1502px) 1502px, 100vw" decoding="async" loading="lazy" data-src="./static/9184c08c847a43cc135f94d8e635bb56/4bf74/05_steering_7.png" data-srcset="./static/9184c08c847a43cc135f94d8e635bb56/1a134/05_steering_7.png 376w,./static/9184c08c847a43cc135f94d8e635bb56/6d221/05_steering_7.png 751w,./static/9184c08c847a43cc135f94d8e635bb56/4bf74/05_steering_7.png 1502w" alt="Малюнок 5.6: Верхній агент має бажану швидкість рівну максимальній швидкості й перескакує ціль. Нижній агент ілюструє ідею масштабування бажаної швидкості залежно від відстані до цілі. (Хоча я закликаю вас і надалі думати про агента як про милу, схожу на жука істоту, для простоти він буде намальований у вигляді трикутника)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/9184c08c847a43cc135f94d8e635bb56/d5c1b/05_steering_7.webp 376w,./static/9184c08c847a43cc135f94d8e635bb56/33d53/05_steering_7.webp 751w,./static/9184c08c847a43cc135f94d8e635bb56/14b32/05_steering_7.webp 1502w" sizes="(min-width: 1502px) 1502px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1502px) 1502px, 100vw" decoding="async" loading="lazy" src="./static/9184c08c847a43cc135f94d8e635bb56/4bf74/05_steering_7.png" srcSet="./static/9184c08c847a43cc135f94d8e635bb56/1a134/05_steering_7.png 376w,./static/9184c08c847a43cc135f94d8e635bb56/6d221/05_steering_7.png 751w,./static/9184c08c847a43cc135f94d8e635bb56/4bf74/05_steering_7.png 1502w" alt="Малюнок 5.6: Верхній агент має бажану швидкість рівну максимальній швидкості й перескакує ціль. Нижній агент ілюструє ідею масштабування бажаної швидкості залежно від відстані до цілі. (Хоча я закликаю вас і надалі думати про агента як про милу, схожу на жука істоту, для простоти він буде намальований у вигляді трикутника)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption>Малюнок 5.6: Верхній агент має бажану швидкість рівну максимальній швидкості й перескакує ціль. Нижній агент ілюструє ідею масштабування бажаної швидкості залежно від відстані до цілі. (Хоча я закликаю вас і надалі думати про агента як про милу, схожу на жука істоту, для простоти він буде намальований у вигляді трикутника)</figcaption>
  </figure>
</div>
<p>Агент настільки схвильований рухом до цілі, що не турбується про прийняття будь-яких розумних рішень щодо своєї швидкості. Незалежно від відстані до цілі, він завжди хоче рухатися якнайшвидше. Це означає, що коли агент дуже близько, то він перескочить свою ціль (див. верхню частину малюнку 5.6).</p>
<p>У деяких випадках це є бажаною поведінкою. Уявіть цуценя, яке грається зі своєю улюбленою іграшкою: воно не сповільнюється, незалежно від того, наскільки близька до неї відстань!) Але в багатьох інших випадках (авто, що зупиняється на паркувальному місці, бджола, яка сідає на квітку) міркування агента повинні враховувати його швидкість відносно відстані до цілі (див. нижню частинку малюнку 5.6). Наприклад:</p>
<ul>
  <li>Я дуже далеко. Я хочу якомога швидше рухатись до цілі.</li>
  <li>Я поки далеко. Я все ще хочу якомога швидше рухатись до цілі.</li>
  <li>Я наближаюся. Я хочу повільніше рухатись до цілі.</li>
  <li>Я майже на місці. Я хочу дуже повільно рухатись до цілі.</li>
  <li>Я на місці. Я хочу зупинитися!</li>
</ul>
<p>Як ви можете реалізувати цю поведінку <em>наближення</em> у коді? Пригадайте метод <code>seek()</code>. Яка частина коду встановлює величину бажаної швидкості?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Цей підхід завжди встановлює величину вектора <code>desired</code> рівною значенню <code>maxspeed</code>, як показано на малюнку 5.7.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2303px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;826&#x27; width=&#x27;2303&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/f881e6bb16f2d77da128f321d20e6e55/d9fcc/05_steering_8.webp 576w,./static/f881e6bb16f2d77da128f321d20e6e55/3fe5a/05_steering_8.webp 1152w,./static/f881e6bb16f2d77da128f321d20e6e55/50a8e/05_steering_8.webp 2303w" sizes="(min-width: 2303px) 2303px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2303px) 2303px, 100vw" decoding="async" loading="lazy" data-src="./static/f881e6bb16f2d77da128f321d20e6e55/bba3c/05_steering_8.png" data-srcset="./static/f881e6bb16f2d77da128f321d20e6e55/a17da/05_steering_8.png 576w,./static/f881e6bb16f2d77da128f321d20e6e55/05955/05_steering_8.png 1152w,./static/f881e6bb16f2d77da128f321d20e6e55/bba3c/05_steering_8.png 2303w" alt="Малюнок 5.7: Агенти мають бажану швидкість із величиною, встановленою на максимальну швидкість, незалежно від їх відстані до цілі"/></picture><noscript><picture><source type="image/webp" srcSet="./static/f881e6bb16f2d77da128f321d20e6e55/d9fcc/05_steering_8.webp 576w,./static/f881e6bb16f2d77da128f321d20e6e55/3fe5a/05_steering_8.webp 1152w,./static/f881e6bb16f2d77da128f321d20e6e55/50a8e/05_steering_8.webp 2303w" sizes="(min-width: 2303px) 2303px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2303px) 2303px, 100vw" decoding="async" loading="lazy" src="./static/f881e6bb16f2d77da128f321d20e6e55/bba3c/05_steering_8.png" srcSet="./static/f881e6bb16f2d77da128f321d20e6e55/a17da/05_steering_8.png 576w,./static/f881e6bb16f2d77da128f321d20e6e55/05955/05_steering_8.png 1152w,./static/f881e6bb16f2d77da128f321d20e6e55/bba3c/05_steering_8.png 2303w" alt="Малюнок 5.7: Агенти мають бажану швидкість із величиною, встановленою на максимальну швидкість, незалежно від їх відстані до цілі"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.7: Агенти мають бажану швидкість із величиною, встановленою на максимальну швидкість, незалежно від їх відстані до цілі</figcaption>
</figure>
<p>Що, якби величина бажаної швидкості натомість дорівнювала половині відстані?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   desired.<span class="hljs-title function_">mult</span>(<span class="hljs-number">0.5</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Я все одно хотів би обмежити величину змінної <code>desired</code> не більше максимальної швидкості, щоб агенти, які знаходяться дуже далеко, не рухалися надто швидко (малюнок 5.8).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2303px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;726&#x27; width=&#x27;2303&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/0e1c8642400c6d594e8956c575c00340/9e5a9/05_steering_9.webp 576w,./static/0e1c8642400c6d594e8956c575c00340/3a5b3/05_steering_9.webp 1152w,./static/0e1c8642400c6d594e8956c575c00340/0ad67/05_steering_9.webp 2303w" sizes="(min-width: 2303px) 2303px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2303px) 2303px, 100vw" decoding="async" loading="lazy" data-src="./static/0e1c8642400c6d594e8956c575c00340/94c96/05_steering_9.png" data-srcset="./static/0e1c8642400c6d594e8956c575c00340/19ec7/05_steering_9.png 576w,./static/0e1c8642400c6d594e8956c575c00340/f89d3/05_steering_9.png 1152w,./static/0e1c8642400c6d594e8956c575c00340/94c96/05_steering_9.png 2303w" alt="Малюнок 5.8: Величина бажаної швидкості кожного агента дорівнює половині відстані до цілі. У випадку агента ліворуч, його швидкість обмежена значенням максимальної швидкості"/></picture><noscript><picture><source type="image/webp" srcSet="./static/0e1c8642400c6d594e8956c575c00340/9e5a9/05_steering_9.webp 576w,./static/0e1c8642400c6d594e8956c575c00340/3a5b3/05_steering_9.webp 1152w,./static/0e1c8642400c6d594e8956c575c00340/0ad67/05_steering_9.webp 2303w" sizes="(min-width: 2303px) 2303px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2303px) 2303px, 100vw" decoding="async" loading="lazy" src="./static/0e1c8642400c6d594e8956c575c00340/94c96/05_steering_9.png" srcSet="./static/0e1c8642400c6d594e8956c575c00340/19ec7/05_steering_9.png 576w,./static/0e1c8642400c6d594e8956c575c00340/f89d3/05_steering_9.png 1152w,./static/0e1c8642400c6d594e8956c575c00340/94c96/05_steering_9.png 2303w" alt="Малюнок 5.8: Величина бажаної швидкості кожного агента дорівнює половині відстані до цілі. У випадку агента ліворуч, його швидкість обмежена значенням максимальної швидкості"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.8: Величина бажаної швидкості кожного агента дорівнює половині відстані до цілі. У випадку агента ліворуч, його швидкість обмежена значенням максимальної швидкості</figcaption>
</figure>
<p>Хоча ця зміна добре демонструє мету прив’язки бажаної швидкості до відстані від цілі, це не дуже хороше рішення. Зрештою, відстань у 10 пікселів вже досить близька, а бажана швидкість у 5 досить велика. Бажана швидкість з величиною рівною, наприклад, 5 відсоткам від відстані, може спрацювати краще:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  desired.<span class="hljs-title function_">mult</span>(<span class="hljs-number">0.05</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Рейнольдс описує ще більш досконалий підхід. Уявіть коло навколо цілі із заданим радіусом <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span></span></span></span></span>. Якщо агент знаходиться в межах цього кола, він поступово сповільнюється — від максимальної швидкості на самому краю кола до нульової швидкості біля самої цілі (малюнок 5.9).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1371&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/8f51c22be9e85688ecad7b34c9d854cf/fcf53/05_steering_10.webp 576w,./static/8f51c22be9e85688ecad7b34c9d854cf/726d9/05_steering_10.webp 1152w,./static/8f51c22be9e85688ecad7b34c9d854cf/7ab3d/05_steering_10.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/8f51c22be9e85688ecad7b34c9d854cf/7e262/05_steering_10.png" data-srcset="./static/8f51c22be9e85688ecad7b34c9d854cf/705b2/05_steering_10.png 576w,./static/8f51c22be9e85688ecad7b34c9d854cf/7a4f2/05_steering_10.png 1152w,./static/8f51c22be9e85688ecad7b34c9d854cf/7e262/05_steering_10.png 2304w" alt="Малюнок 5.9: За межами кола величина бажаної швидкості агентів встановлюється на максимальну швидкість. Коли агенти входять у коло і наближаються до цілі, їх магнітуда бажаної швидкості зменшується"/></picture><noscript><picture><source type="image/webp" srcSet="./static/8f51c22be9e85688ecad7b34c9d854cf/fcf53/05_steering_10.webp 576w,./static/8f51c22be9e85688ecad7b34c9d854cf/726d9/05_steering_10.webp 1152w,./static/8f51c22be9e85688ecad7b34c9d854cf/7ab3d/05_steering_10.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/8f51c22be9e85688ecad7b34c9d854cf/7e262/05_steering_10.png" srcSet="./static/8f51c22be9e85688ecad7b34c9d854cf/705b2/05_steering_10.png 576w,./static/8f51c22be9e85688ecad7b34c9d854cf/7a4f2/05_steering_10.png 1152w,./static/8f51c22be9e85688ecad7b34c9d854cf/7e262/05_steering_10.png 2304w" alt="Малюнок 5.9: За межами кола величина бажаної швидкості агентів встановлюється на максимальну швидкість. Коли агенти входять у коло і наближаються до цілі, їх магнітуда бажаної швидкості зменшується"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.9: За межами кола величина бажаної швидкості агентів встановлюється на максимальну швидкість. Коли агенти входять у коло і наближаються до цілі, їх магнітуда бажаної швидкості зменшується</figcaption>
</figure>
<p>Іншими словами, якщо відстань до цілі менше ніж <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span></span></span></span></span>, то бажана швидкість знаходиться між 0 і максимальною швидкістю, зіставленою відповідно до цієї відстані.</p>
<div data-type="example">
  <h3 id="example-52-arriving-at-a-target"><a class="heading-link" href="#example-52-arriving-at-a-target">Приклад 5.2: Наближення до цілі</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_02_arrive"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/v-yJm8WUx" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">arrive</span>(<span class="hljs-params">target</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> d = desired.<span class="hljs-title function_">mag</span>();
</code></pre><div class="comment"><p>Відстань — це величина
вектора, спрямованого від
позиції до цілі.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">100</span>) {
</code></pre><div class="comment"><p>Якщо ми ближче ніж 100 пікселів...</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> m = <span class="hljs-title function_">map</span>(d, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
      desired.<span class="hljs-title function_">setMag</span>(m);
</code></pre><div class="comment"><p>...встановіть величину залежно від того, наскільки ми близько.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    } <span class="hljs-keyword">else</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">      desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p>В іншому випадку рухаємось з максимальною швидкістю.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p>Звичайна керувальна формула: steering = desired - velocity.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Поведінка наближення є чудовою демонстрацією сприйняття автономним агентом середовища, включаючи його власний стан. Ця модель відрізняється від неживих сил у <a href="/forces#section-forces">Розділі 2</a>: небесне тіло, яке притягується до іншого тіла, не знає, що воно відчуває гравітацію, тоді як гепард, який переслідує свою здобич, знає, що він її переслідує.</p>
<p>Ключ у способі розрахунку сили. Наприклад, у програмі гравітаційного тяжіння ( приклад 2.6) сила завжди вказувала прямо від об’єкта до цілі — точний напрямок бажаної швидкості. Тут, навпаки, об’єкт-агент сприймає свою відстань до цілі й регулює бажану швидкість відповідним чином, сповільнюючи швидкість у міру наближення. Таким чином, сила, що діє на сам об’єкт, базується не лише на бажаній швидкості, а також і на бажаній швидкості <em>відносно його поточної швидкості</em>. Об’єкт-агент враховує свій власний стан як частину оцінки оточення.</p>
<p>Іншими словами, магія рівняння Рейнольдса <code>desired - velocity</code> полягає в тому, що воно, по суті, робить керувальну силу проявом <em>помилки</em> поточної швидкості: “Я мав би рухатися з такою-то швидкістю в цьому напрямку, але насправді рухаюся з такою-то швидкістю в іншому напрямку. Моя помилка полягає в різниці між тим, куди я хочу потрапити й тим, куди я прямую наразі”. Іноді це може призвести до начебто несподіваних результатів, як показано на малюнку 5.10.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;538&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/c2c20046a00d7f6c6063202df2fb6325/30b09/05_steering_11.webp 576w,./static/c2c20046a00d7f6c6063202df2fb6325/c2f57/05_steering_11.webp 1152w,./static/c2c20046a00d7f6c6063202df2fb6325/6ef92/05_steering_11.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/c2c20046a00d7f6c6063202df2fb6325/f4eeb/05_steering_11.png" data-srcset="./static/c2c20046a00d7f6c6063202df2fb6325/b12ef/05_steering_11.png 576w,./static/c2c20046a00d7f6c6063202df2fb6325/d7fe2/05_steering_11.png 1152w,./static/c2c20046a00d7f6c6063202df2fb6325/f4eeb/05_steering_11.png 2304w" alt="Малюнок 5.10: Агент, що рухається до своєї цілі швидше, ніж його бажана швидкість, призведе до того, що керувальна сила буде направлена в протилежну сторону від цілі"/></picture><noscript><picture><source type="image/webp" srcSet="./static/c2c20046a00d7f6c6063202df2fb6325/30b09/05_steering_11.webp 576w,./static/c2c20046a00d7f6c6063202df2fb6325/c2f57/05_steering_11.webp 1152w,./static/c2c20046a00d7f6c6063202df2fb6325/6ef92/05_steering_11.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/c2c20046a00d7f6c6063202df2fb6325/f4eeb/05_steering_11.png" srcSet="./static/c2c20046a00d7f6c6063202df2fb6325/b12ef/05_steering_11.png 576w,./static/c2c20046a00d7f6c6063202df2fb6325/d7fe2/05_steering_11.png 1152w,./static/c2c20046a00d7f6c6063202df2fb6325/f4eeb/05_steering_11.png 2304w" alt="Малюнок 5.10: Агент, що рухається до своєї цілі швидше, ніж його бажана швидкість, призведе до того, що керувальна сила буде направлена в протилежну сторону від цілі"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.10: Агент, що рухається до своєї цілі швидше, ніж його бажана швидкість, призведе до того, що керувальна сила буде направлена в протилежну сторону від цілі</figcaption>
</figure>
<p>У цьому прикладі поведінки наближення агент рухається занадто швидко до цілі. Керувальна сила, або помилка, каже йому сповільнитися, фактично вказуючи в протилежному напрямку від цілі. Напротивагу, з гравітаційним притяганням у вас ніколи не буде ситуації, коли сила спрямована від цілі, незалежно від того, наскільки близько вона знаходиться. Застосування помилки як керувальної сили п ризводить до більш динамічних та реалістичних симуляцій.</p>
<h3 id="your-own-behaviors"><a class="heading-link" href="#your-own-behaviors">Ваші власні поведінки</a></h3>
<p>Перші два приклади, які я розглянув — пошук і наближення — зводяться до обчислення єдиного вектора для кожної поведінки: <em>бажаної</em> швидкості. Насправді цьому патерну відповідає кожна керувальна поведінка Рейнольдса. У цьому розділі я збираюся розглянути ще кілька поведінок Рейнольдса — поле потоків, слідування шляхом та рух у зграї. Однак спочатку хочу ще раз підкреслити, що це <em>приклади</em> — демонстрації звичайних поведінкових моделей, корисних для процедурних анімацій. Вони не є останніми серед усіх можливих, що <em>ви</em> можете зробити. Поки ви можете вигадати вектор, який описує <em>бажану</em> швидкість агента, ви можете створити власну керувальну поведінку.</p>
<p>Наприклад, подивімося, як Рейнольдс визначає бажану швидкість для своєї поведінки блукання:</p>
<blockquote data-type="epigraph">
  <p><em>Блукання — це тип випадкового керування, яке має певний довготривалий порядок: керувальний напрямок в одному кадрі пов’язаний із керувальним напрямком у наступному. Це створює цікавіший р ух ніж проста генерація випадкового керувального напрямку для кожного кадру.</em></p>
</blockquote>
<p>Для Рейнольдса метою блукання є не випадковий рух, а скоріше відчуття руху в одному напрямку протягом деякого часу, потім блукання деякий час в іншому напрямку і так далі. Малюнок 5.11 ілюструє, як Рейнольдс обчислює ціль пошуку, щоб досягти зазанчений ефект.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1374&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/21d65e71b525edc2db4fcaea6f34bd05/a02d9/05_steering_12.webp 576w,./static/21d65e71b525edc2db4fcaea6f34bd05/be820/05_steering_12.webp 1152w,./static/21d65e71b525edc2db4fcaea6f34bd05/ab679/05_steering_12.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/21d65e71b525edc2db4fcaea6f34bd05/f7cd9/05_steering_12.png" data-srcset="./static/21d65e71b525edc2db4fcaea6f34bd05/b6b84/05_steering_12.png 576w,./static/21d65e71b525edc2db4fcaea6f34bd05/a6844/05_steering_12.png 1152w,./static/21d65e71b525edc2db4fcaea6f34bd05/f7cd9/05_steering_12.png 2304w" alt="Малюнок 5.11: Поведінка керувального блукання розраховується як пошук цілі, яка рухається випадковим чином вздовж периметра круга, спроєктованого перед рухомим агентом"/></picture><noscript><picture><source type="image/webp" srcSet="./static/21d65e71b525edc2db4fcaea6f34bd05/a02d9/05_steering_12.webp 576w,./static/21d65e71b525edc2db4fcaea6f34bd05/be820/05_steering_12.webp 1152w,./static/21d65e71b525edc2db4fcaea6f34bd05/ab679/05_steering_12.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/21d65e71b525edc2db4fcaea6f34bd05/f7cd9/05_steering_12.png" srcSet="./static/21d65e71b525edc2db4fcaea6f34bd05/b6b84/05_steering_12.png 576w,./static/21d65e71b525edc2db4fcaea6f34bd05/a6844/05_steering_12.png 1152w,./static/21d65e71b525edc2db4fcaea6f34bd05/f7cd9/05_steering_12.png 2304w" alt="Малюнок 5.11: Поведінка керувального блукання розраховується як пошук цілі, яка рухається випадковим чином вздовж периметра круга, спроєктованого перед рухомим агентом"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.11: Поведінка керувального блукання розраховується як пошук цілі, яка рухається випадковим чином вздовж периметра круга, спроєктованого перед рухомим агентом</figcaption>
</figure>
<p>Спершу агент передбачає своє майбутнє положення на фіксованій відстані перед ним (у напрямку його поточної швидкості). Потім малює коло з радіусом <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span></span></span></span></span> з центром навколо цієї позиції та вибирає випадкову точку вздовж окружності цього кола. Ця точка, яка переміщується випадковим чином навколо кола у кожному кадрі анімації, є ціллю агента, тому його бажана швидкість вказує в цьому ж напрямку.</p>
<p>Звучить безглуздо, правда? Або, принаймні, трохи свавільно. Насправді це кмітливе і продумане рішення — воно використовує випадковість для керування агентом, але обмежує цю випадковість вздовж траєкторії кола, щоб уникнути тремтячих і абсолютно випадкових рухів.</p>
<p>Здається, що випадк ова і довільна природа цього рішення має підсилити думку, яку я намагаюся висловити: це <em>вигадані</em> поведінки, навіть якщо вони натхнені рухом з реального життя. Ви так само легко можете вигадати якийсь інший продуманий сценарій для обчислення бажаної швидкості. І ви повинні!</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-54"><a class="heading-link" href="#exercise-54">Вправа 5.4</a></h3>
  <p>Напишіть код для поведінки блукання Рейнольдса. Використовуйте полярні координати для обчислення цілі агента вздовж периметра кола.</p>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_04_exercise_wander"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/rgCpC9OV3" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<p>Наведу ще один приклад, скажімо, я хочу створити керувальну поведінку під назвою “<em>залишатись в межах стін</em>”. Щоб визначити бажану швидкість, я встановлю правило: якщо агент наближається до стіни на відстань <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">d</span></span></span></span></span>, тоді він бажає рухатися з максимальною швидкістю в протилежному напрямку від цієї стіни (див. малюнок 5.12).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1335&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/961654432c4fab219cbc76be605730a3/de848/05_steering_13.webp 576w,./static/961654432c4fab219cbc76be605730a3/35a8a/05_steering_13.webp 1152w,./static/961654432c4fab219cbc76be605730a3/0785f/05_steering_13.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/961654432c4fab219cbc76be605730a3/7cf4c/05_steering_13.png" data-srcset="./static/961654432c4fab219cbc76be605730a3/c5483/05_steering_13.png 576w,./static/961654432c4fab219cbc76be605730a3/352ea/05_steering_13.png 1152w,./static/961654432c4fab219cbc76be605730a3/7cf4c/05_steering_13.png 2304w" alt="Малюнок 5.12: Бажана швидкість вказує у протилежний бік від тої стіни до якої агент наближається занадто близько"/></picture><noscript><picture><source type="image/webp" srcSet="./static/961654432c4fab219cbc76be605730a3/de848/05_steering_13.webp 576w,./static/961654432c4fab219cbc76be605730a3/35a8a/05_steering_13.webp 1152w,./static/961654432c4fab219cbc76be605730a3/0785f/05_steering_13.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/961654432c4fab219cbc76be605730a3/7cf4c/05_steering_13.png" srcSet="./static/961654432c4fab219cbc76be605730a3/c5483/05_steering_13.png 576w,./static/961654432c4fab219cbc76be605730a3/352ea/05_steering_13.png 1152w,./static/961654432c4fab219cbc76be605730a3/7cf4c/05_steering_13.png 2304w" alt="Малюнок 5.12: Бажана швидкість вказує у протилежний бік від тої стіни до якої агент наближається занадто близько"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.12: Бажана швидкість вказує у протилежний бік від тої стіни до якої агент наближається занадто близько</figcaption>
</figure>
<p>Я можу визначити для стін простір біля краю полотна зі значенням ширини у змінній <code>offset</code> зі значенням 25, і написати відповідний код за допомогою послідовності умовних операторів <code>if</code>.</p>
<div data-type="example">
  <h3 id="example-53-stay-within-walls-steering-behavior"><a class="heading-link" href="#example-53-stay-within-walls-steering-behavior">Приклад 5.3: Керувальна поведінка “залишатись в межах стін”</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_03_stay_within_walls"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/fGNwVP3h7" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">boundaries</span>(<span class="hljs-params">offset</span>) {
</code></pre><div class="comment"><p>Метод приймає значення відступу від країв.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = <span class="hljs-literal">null</span>;
</code></pre><div class="comment"><p>Починаємо з null-значення для бажаної швидкості.</p></div></div><div class="offset pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> &lt; offset) {
      desired = <span class="hljs-title function_">createVector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-property">y</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> &gt; width - offset) {
      desired = <span class="hljs-title function_">createVector</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-property">y</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> &lt; offset) {
      desired = <span class="hljs-title function_">createVector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> &gt; height - offset) {
      desired = <span class="hljs-title function_">createVector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-property">x</span>, -<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
    }
</code></pre><div class="comment"><p>Якщо агент знаходиться у межі бокових стін (ліворуч чи праворуч), встановлюємо бажану швидкість, яка зберігає y-напрямок агента,
але вказує його x-напрямок від
країв полотна. Схожа логіка діє і для вертикальних меж.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (desired !== <span class="hljs-literal">null</span>) {
      desired.<span class="hljs-title function_">normalize</span>();
      desired.<span class="hljs-title function_">mult</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
      <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
      steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
    }
</code></pre><div class="comment"><p>Якщо бажана швидкість не null, застосовуємо керування.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Вам може бути цікаво, чому в цьому методі <code>boundaries()</code> для змінної <code>desired</code> я на початку встановив значення <code>null</code>. Чому б просто не встановити їй нульовий вектор? Пам’ятайте, що керувальна сила дорівнює бажаній швидкості мінус поточна швидкість! Якщо агент буде рухатися зі швидкістю 0, то результівна сила сповільнить рух агента до його зупинки. Ініціалізуючи змінну <code>desired</code> значенням <code>null</code> і перевіряючи, що вона не рівна <code>null</code> перед застосуванням її для керівної сили, ми не вплинемо на агента, коли він знаходиться на достатній відстані від країв полотна.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-55"><a class="heading-link" href="#exercise-55">Вправа 5.5</a></h3>
  <p>Придумайте власну довільну схему для розрахунку бажаної швидкості.</p>
</div>
<h2 id="flow-fields"><a class="heading-link" href="#flow-fields">Поле потоків</a></h2>
<p>Ще однією керованою поведінкою Рейнольдса є <strong>слідування полем потоків</strong>. Але що таке поле потоків або як інакше кажуть векторне поле? Уявіть полотно у вигляді сітки (малюнок 5.13). У кожній комірці сітки є стрілка, яка вказує у певному напрямку — певний вектор. Коли агент рухається довкола полотна, він запитує: “Привіт, який піді мною вектор? Тепер це моя бажана швидкість!”</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2321px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1186&#x27; width=&#x27;2321&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/281794ad86b655f8dc23b69cca400ac2/59bbd/05_steering_14.webp 580w,./static/281794ad86b655f8dc23b69cca400ac2/f9809/05_steering_14.webp 1161w,./static/281794ad86b655f8dc23b69cca400ac2/2ad2c/05_steering_14.webp 2321w" sizes="(min-width: 2321px) 2321px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2321px) 2321px, 100vw" decoding="async" loading="lazy" data-src="./static/281794ad86b655f8dc23b69cca400ac2/5431b/05_steering_14.png" data-srcset="./static/281794ad86b655f8dc23b69cca400ac2/dfbf7/05_steering_14.png 580w,./static/281794ad86b655f8dc23b69cca400ac2/c2ac5/05_steering_14.png 1161w,./static/281794ad86b655f8dc23b69cca400ac2/5431b/05_steering_14.png 2321w" alt="Малюнок 5.13: 2D сітка, повна одиничних векторів, спрямованих у випадкових напрямках"/></picture><noscript><picture><source type="image/webp" srcSet="./static/281794ad86b655f8dc23b69cca400ac2/59bbd/05_steering_14.webp 580w,./static/281794ad86b655f8dc23b69cca400ac2/f9809/05_steering_14.webp 1161w,./static/281794ad86b655f8dc23b69cca400ac2/2ad2c/05_steering_14.webp 2321w" sizes="(min-width: 2321px) 2321px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2321px) 2321px, 100vw" decoding="async" loading="lazy" src="./static/281794ad86b655f8dc23b69cca400ac2/5431b/05_steering_14.png" srcSet="./static/281794ad86b655f8dc23b69cca400ac2/dfbf7/05_steering_14.png 580w,./static/281794ad86b655f8dc23b69cca400ac2/c2ac5/05_steering_14.png 1161w,./static/281794ad86b655f8dc23b69cca400ac2/5431b/05_steering_14.png 2321w" alt="Малюнок 5.13: 2D сітка, повна одиничних векторів, спрямованих у випадкових напрямках"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.13: 2D сітка, повна одиничних векторів, спрямованих у випадкових напрямках</figcaption>
</figure>
<p>Приклад з полем потоків Рейнольдса передбачає, що агент дивиться вперед на своє майбутнє положення і слідує вектору відповідної точки. Однак для простоти я натомість запропоную агенту слідувати за вектором з  комірки його поточного положення.</p>
<p>Перед тим, як написати додатковий код для класу <code>Vehicle</code>, щоб слідувати за полем потоків, мені спочатку потрібен клас, який описуватиме це поле. Оскільки поле потоків, по суті, є сіткою векторів, то 2D масив буде зручною структурою даних для його представлення, оскільки я зможу посилатися на кожен елемент комірки за допомогою двох індексів, стовпця і рядка сітки. Якщо ви не знайомі з 2D-масивами, пропоную переглянути <a href="https://thecodingtrain.com/2d-array" target="_blank" rel="noopener">мій відеоурок “2D Arrays in JavaScript”</a>.</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowField</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span> = ????;
</code></pre><div class="comment"><p>Роздільність сітки в пікселях відносно ширини і висоти полотна.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span> = ????;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span> = ????;
</code></pre><div class="comment"><p>Кількість стовпців і рядків у сітці.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span>);
    }
</code></pre><div class="comment"><p>Поле буде двовимірним масивом векторів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Як заповнити пропущені значення? Припустімо, у мене є полотно 200 пікселів у ширину і 200 пікселів у висоту. Теоретично я можу створити поле потоків, яке матиме вектор для кожного окремого пікселя, що означає загалом 40 000 векторів (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn><mo>×</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">200 \times 200</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">200</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">200</span></span></span></span></span>). Це не дуже необґрунтоване число, але у цій ситуації з вектором на піксель воно надмірне. Я можу легко обійтися, скажімо, одним вектором на кожні 10 пікселів (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mo>×</mo><mn>20</mn><mo>=</mo><mn>400</mn></mrow><annotation encoding="application/x-tex">20 \times 20 = 400</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">20</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">20</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">400</span></span></span></span></span>). Моя змінна <code>resolution</code> задаватиме розмір кожної комірки в пікселях. Потім я можу розрахувати кількість стовпців на основі розміру полотна, поділеного на роздільну здатність:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span> = <span class="hljs-number">10</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span> = <span class="hljs-title function_">floor</span>(width / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>);
</code></pre><div class="comment"><p>Загальна кількість стовпців дорівнює ширині, поділеній на роздільність.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span> = <span class="hljs-title function_">floor</span>(height / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>);
</code></pre><div class="comment"><p>Загальна кількість рядків дорівнює висоті, поділеній на роздільність.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span>);
    }
</code></pre><div class="comment"><p>Поле буде двовимірним масивом векторів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер, коли я налаштував структуру даних для поля потоків, настав час визначити вектори цього поля. Як мені це зробити? Як я захочу! Можливо, я хотів би, щоб кожен вектор у полі потоків вказував направо (малюнок 5.14).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;691&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/f31798d1fd1594244356f62e03330aac/740ee/05_steering_15.webp 576w,./static/f31798d1fd1594244356f62e03330aac/43531/05_steering_15.webp 1152w,./static/f31798d1fd1594244356f62e03330aac/d9449/05_steering_15.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/f31798d1fd1594244356f62e03330aac/80570/05_steering_15.png" data-srcset="./static/f31798d1fd1594244356f62e03330aac/cdeb2/05_steering_15.png 576w,./static/f31798d1fd1594244356f62e03330aac/00b9c/05_steering_15.png 1152w,./static/f31798d1fd1594244356f62e03330aac/80570/05_steering_15.png 2304w" alt="Малюнок 5.14: Поле потоків з усіма векторами, спрямованими вправо"/></picture><noscript><picture><source type="image/webp" srcSet="./static/f31798d1fd1594244356f62e03330aac/740ee/05_steering_15.webp 576w,./static/f31798d1fd1594244356f62e03330aac/43531/05_steering_15.webp 1152w,./static/f31798d1fd1594244356f62e03330aac/d9449/05_steering_15.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/f31798d1fd1594244356f62e03330aac/80570/05_steering_15.png" srcSet="./static/f31798d1fd1594244356f62e03330aac/cdeb2/05_steering_15.png 576w,./static/f31798d1fd1594244356f62e03330aac/00b9c/05_steering_15.png 1152w,./static/f31798d1fd1594244356f62e03330aac/80570/05_steering_15.png 2304w" alt="Малюнок 5.14: Поле потоків з усіма векторами, спрямованими вправо"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.14: Поле потоків з усіма векторами, спрямованими вправо</figcaption>
</figure>
<p>Для цього я можу просто встановити для кожного вектора значення <code>(1, 0)</code>.</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>; i++) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span>; j++) {
</code></pre><div class="comment"><p>Використання вкладеного циклу для перебору кожного стовпця
і кожного рядка поля потоків.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[i][j] = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p>Довільне рішення зробити кожен вектор спрямованим вправо.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Можливо я захочу надати перевагу векторам, що вказують у випадкових напрямках як показано на малюнку 5.15.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;691&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/0159c4139ee366ebe0139a9fa79bf1e1/740ee/05_steering_16.webp 576w,./static/0159c4139ee366ebe0139a9fa79bf1e1/43531/05_steering_16.webp 1152w,./static/0159c4139ee366ebe0139a9fa79bf1e1/d9449/05_steering_16.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/0159c4139ee366ebe0139a9fa79bf1e1/80570/05_steering_16.png" data-srcset="./static/0159c4139ee366ebe0139a9fa79bf1e1/cdeb2/05_steering_16.png 576w,./static/0159c4139ee366ebe0139a9fa79bf1e1/00b9c/05_steering_16.png 1152w,./static/0159c4139ee366ebe0139a9fa79bf1e1/80570/05_steering_16.png 2304w" alt="Малюнок 5.15: Поле потоків з векторами, спрямованими у випадкових напрямках"/></picture><noscript><picture><source type="image/webp" srcSet="./static/0159c4139ee366ebe0139a9fa79bf1e1/740ee/05_steering_16.webp 576w,./static/0159c4139ee366ebe0139a9fa79bf1e1/43531/05_steering_16.webp 1152w,./static/0159c4139ee366ebe0139a9fa79bf1e1/d9449/05_steering_16.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/0159c4139ee366ebe0139a9fa79bf1e1/80570/05_steering_16.png" srcSet="./static/0159c4139ee366ebe0139a9fa79bf1e1/cdeb2/05_steering_16.png 576w,./static/0159c4139ee366ebe0139a9fa79bf1e1/00b9c/05_steering_16.png 1152w,./static/0159c4139ee366ebe0139a9fa79bf1e1/80570/05_steering_16.png 2304w" alt="Малюнок 5.15: Поле потоків з векторами, спрямованими у випадкових напрямках"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.15: Поле потоків з векторами, спрямованими у випадкових напрямках</figcaption>
</figure>
<p>Легка справа. Просто використайте метод <code>random2D()</code> з класу <code>p5.Vector</code>, щоб призначити його результівний вектор кожній комірці:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span>; j++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[i][j] = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">random2D</span>();
</code></pre><div class="comment"><p>Призначення випадкового вектора.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<div class="avoid-break">
  <p>А як щодо використання 2D шуму Перліна (малюнок 5.16)?</p>
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;691&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/4c908188ed35ec6e612878e50ee8b796/740ee/05_steering_17.webp 576w,./static/4c908188ed35ec6e612878e50ee8b796/43531/05_steering_17.webp 1152w,./static/4c908188ed35ec6e612878e50ee8b796/d9449/05_steering_17.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/4c908188ed35ec6e612878e50ee8b796/80570/05_steering_17.png" data-srcset="./static/4c908188ed35ec6e612878e50ee8b796/cdeb2/05_steering_17.png 576w,./static/4c908188ed35ec6e612878e50ee8b796/00b9c/05_steering_17.png 1152w,./static/4c908188ed35ec6e612878e50ee8b796/80570/05_steering_17.png 2304w" alt="Малюнок 5.16: Поле потоків, розраховане за допомогою шуму Перліна"/></picture><noscript><picture><source type="image/webp" srcSet="./static/4c908188ed35ec6e612878e50ee8b796/740ee/05_steering_17.webp 576w,./static/4c908188ed35ec6e612878e50ee8b796/43531/05_steering_17.webp 1152w,./static/4c908188ed35ec6e612878e50ee8b796/d9449/05_steering_17.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/4c908188ed35ec6e612878e50ee8b796/80570/05_steering_17.png" srcSet="./static/4c908188ed35ec6e612878e50ee8b796/cdeb2/05_steering_17.png 576w,./static/4c908188ed35ec6e612878e50ee8b796/00b9c/05_steering_17.png 1152w,./static/4c908188ed35ec6e612878e50ee8b796/80570/05_steering_17.png 2304w" alt="Малюнок 5.16: Поле потоків, розраховане за допомогою шуму Перліна"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption>Малюнок 5.16: Поле потоків, розраховане за допомогою шуму Перліна</figcaption>
  </figure>
</div>
<p>Просто зіставте кожне значення шуму на значення кутів від <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span> до <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">2\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span> та створіть з отриманого результату вектор:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> xoff = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> yoff = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span>; j++) {
</code></pre><div class="comment"><p></p></div></div><div class="offset-top pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> angle = <span class="hljs-title function_">map</span>(<span class="hljs-title function_">noise</span>(xoff, yoff), <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-variable constant_">TWO_PI</span>);
</code></pre><div class="comment"><p>Кути на основі 2D шуму.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[i][j] = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">fromAngle</span>(angle);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    yoff += <span class="hljs-number">0.1</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  xoff += <span class="hljs-number">0.1</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Нарешті я до чогось наближаюсь. Розрахунок напрямку векторів за допомогою шуму Перліна є чудовим способом імітації різноманітних природних ефектів, таких як нерегулярні пориви вітру або звив исте русло річки. Варто відзначити, що це відображення шуму генерує поле, яке віддає перевагу кутам спрямованим вліво. Оскільки шум Перліна має розподіл схожий на гаусівський, то більше шансів бути обраними мають кути біля значення <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span>. Для протидії цій тенденції для створення малюнку 5.16 я використав діапазон від <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span> до <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">4\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span>, подібно до того, як я застосував <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">4\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span> у <a href="/particles#section-particles">Розділі 4</a>, щоб представити діапазон кутів для обертання частинок конфетті. Зрештою, звісно, не існує одного правильного способу підготовки векторів поля потоків — це вам вирішувати, що ви хочете симулювати і який ефект потрібно досягти.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-56"><a class="heading-link" href="#exercise-56">Вправа 5.6</a></h3>
  <p>Напишіть код для формування поля потоків де вектори обернені навколо центру полотна.</p>
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;691&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/84447267581c252de1a04c1828ee4737/740ee/05_steering_18.webp 576w,./static/84447267581c252de1a04c1828ee4737/43531/05_steering_18.webp 1152w,./static/84447267581c252de1a04c1828ee4737/d9449/05_steering_18.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/84447267581c252de1a04c1828ee4737/80570/05_steering_18.png" data-srcset="./static/84447267581c252de1a04c1828ee4737/cdeb2/05_steering_18.png 576w,./static/84447267581c252de1a04c1828ee4737/00b9c/05_steering_18.png 1152w,./static/84447267581c252de1a04c1828ee4737/80570/05_steering_18.png 2304w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="./static/84447267581c252de1a04c1828ee4737/740ee/05_steering_18.webp 576w,./static/84447267581c252de1a04c1828ee4737/43531/05_steering_18.webp 1152w,./static/84447267581c252de1a04c1828ee4737/d9449/05_steering_18.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/84447267581c252de1a04c1828ee4737/80570/05_steering_18.png" srcSet="./static/84447267581c252de1a04c1828ee4737/cdeb2/05_steering_18.png 576w,./static/84447267581c252de1a04c1828ee4737/00b9c/05_steering_18.png 1152w,./static/84447267581c252de1a04c1828ee4737/80570/05_steering_18.png 2304w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption></figcaption>
  </figure>
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> x = i * width / cols;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> y = j * height / rows;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">flowfield[i][j] = <span class="hljs-title function_">createVector</span>(width / <span class="hljs-number">2</span> - x, height / <span class="hljs-number">2</span> - y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">flowfield[i][j].<span class="hljs-title function_">rotate</span>(<span class="hljs-variable constant_">PI</span> / <span class="hljs-number">2</span>);
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Тепер, коли я маю 2D масив, у якому зберігаються вектори поля потоків, мені потрібен спосіб за допомогою якого агент зможе знайти бажану швидкість. Для цього я просто поділю <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">x</span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span> координати положення агента на роздільність сітки. Це дасть мені індекси потрібного вектора у 2D-масиві. Наприклад, якщо роздільність дорівнює 10, а агент знаходиться на координатах <code>(100, 50)</code>, тоді мені потрібно знайти стовпець 10 і рядок 5:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> column = <span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> row = <span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Оскільки агент теоретично може вийти за межі полотна p5.js, корисно використовувати функцію <code>constrain()</code>, щоб переконатися, що ми не робимо пошук за межами масиву поля потоків. Ось метод під назвою <code>lookup()</code>, який я додам до класу <code>FlowField</code>, що приймає вектор (положення агента) і повертає відповідний вектор поля потоків для цього положення:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">lookup</span>(<span class="hljs-params">position</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="offset-top pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> column = <span class="hljs-title function_">constrain</span>(<span class="hljs-title function_">floor</span>(position.<span class="hljs-property">x</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>), <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span> - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> row = <span class="hljs-title function_">constrain</span>(<span class="hljs-title function_">floor</span>(position.<span class="hljs-property">y</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>), <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span> - <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p>Використання функції constrain().</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[column][row].<span class="hljs-title function_">copy</span>();
</code></pre><div class="comment"><p>Використання функції copy(), щоб повертати копію вектора.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Перш ніж перейти до класу <code>Vehicle</code>, давайте розглянемо весь код класу <code>FlowField</code> з використанням шуму Перліна для формування векторних напрямків:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowField</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">r</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span> = r;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span> = width / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span> = height / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>;
</code></pre><div class="comment"><p>Визначення кількості стовпців і рядків.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span>);
    }
</code></pre><div class="comment"><p>Поле потоків — це 2D масив векторів. Для його наповнення використовується функція init.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p>Функція init заповнює двовимірний масив векторами.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">noiseSeed</span>(<span class="hljs-title function_">random</span>(<span class="hljs-number">10000</span>));
    <span class="hljs-keyword">let</span> xoff = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span>; i++) {
      <span class="hljs-keyword">let</span> yoff = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span>; j++) {
</code></pre><div class="comment"><p>Функція noiseSeed щоразу перезавантажує випадковість для формування шуму.</p></div></div><div class="code-wide pair split"><pre><code class="hljs code language-javascript">        <span class="hljs-keyword">let</span> angle = <span class="hljs-title function_">map</span>(<span class="hljs-title function_">noise</span>(xoff, yoff), <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-variable constant_">TWO_PI</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[i][j] = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">fromAngle</span>(angle);
        yoff += <span class="hljs-number">0.1</span>;
</code></pre><div class="comment"><p>У цьому прикладі для створення векторів використовується шум Перліна.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      xoff += <span class="hljs-number">0.1</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="code-wide pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">lookup</span>(<span class="hljs-params">position</span>) {
    <span class="hljs-keyword">let</span> column = <span class="hljs-title function_">constrain</span>(<span class="hljs-title function_">floor</span>(position.<span class="hljs-property">x</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>), <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">cols</span> - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> row = <span class="hljs-title function_">constrain</span>(<span class="hljs-title function_">floor</span>(position.<span class="hljs-property">y</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolution</span>), <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span> - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">field</span>[column][row].<span class="hljs-title function_">copy</span>();
  }
</code></pre><div class="comment"><p>Функція для повернення вектора на основі положення.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер припустимо, що існує агент типу <code>FlowField</code> під назвою <code>flow</code>. Користуючись методом <code>lookup()</code>, агент може отримати бажану швидкість із поля потоків і використати формулу керування Рейнольдса для розрахунку потрібної сили.</p>
<div data-type="example">
  <h3 id="example-54-flow-field-following"><a class="heading-link" href="#example-54-flow-field-following">Приклад 5.4: Слідування полем потоку</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_04_flow_field"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/egribz8WV" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">follow</span>(<span class="hljs-params">flow</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = flow.<span class="hljs-title function_">lookup</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
    desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p>Який вектор у цій точці поля потоків?</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
</code></pre><div class="comment"><p>Формула Рейнольдса: steering = desired - velocity.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зверніть увагу, що <code>lookup()</code> є методом класу <code>FlowField</code>, а не <code>Vehicle</code>. Хоча натомість ви можете розмістити метод <code>lookup()</code> і в класі <code>Vehicle</code>. З моєї точки зору, розміщення його у <code>FlowField</code> краще відповідає принципу інкапсуляції ООП. Адже завдання пошуку полягає в отриманні вектора на основі позиції з поля потоків, який за своєю суттю прив’язаний до даних самого об’єкта <code>FlowField</code>.</p>
<p>Ви також можете помітити деякі знайомі елементи з <a href="/particles#section-particles">Розділу 4</a> про системи частинок, такі як використання масиву об’єктів. Хоча об’єкти тут працюють незалежно, це чудовий перший крок до роздумів про групову поведінку, яку я покажу пізніше у цьому розділі.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-57"><a class="heading-link" href="#exercise-57">Вправа 5.7</a></h3>
  <p>Адаптуйте приклад поля потоків, щоб вектори змінювалися з часом. (Підказка: спробуйте використати третій вимір шуму Перліна!)</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-58"><a class="heading-link" href="#exercise-58">Вправа 5.8</a></h3>
  <p>Чи можете ви створити поле потоків із зображення? Наприклад, спробуйте створити вектори зі значеннями на основі яскравості від темних до світлих кольорів (або навпаки).</p>
</div>
<h2 id="path-following"><a class="heading-link" href="#path-following">Слідуванн я шляхом</a></h2>
<p>Наступна керувальна поведінка, сформульована Крейгом Рейнольдсом, яку я збираюсь розглянути — це слідування шляхом. Але спершу дозвольте мені швидко дещо прояснити. Тут поведінка — це <em>слідування</em> шляхом, а не <em>пошук</em> шляху. Пошук шляху — це алгоритм, який передбачає пошук найкоротшої відстані між двома точками, часто у лабіринті. У <strong>слідуванні шляхом</strong> уже існує попередньо визначений маршрут або шлях, а агент просто намагається слідувати ним.</p>
<p>У цій частині я продовжу працювати над алгоритмом, включаючи відповідну математику та код. Однак перед тим, як це робити, важливо розглянути ключове поняття векторної математики, яке я пропустив у <a href="/vectors#section-vectors">Розділі 1</a>: <strong>скалярний добуток</strong>. Досі він був мені не потрібний, але він вже необхідний тут і, ймовірно, виявиться дуже корисним для вас не лише в цьому прикладі.</p>
<h3 id="the-dot-product"><a class="heading-link" href="#the-dot-product">Скалярний добуток</a></h3>
<p>Пам’ятаєте векторну математику, описану в <a href="/vectors#section-vectors">Розділі 1</a>? Додавання, віднімання, множення і ділення? На малюнку 5.17 наведено деякі із цих операцій.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;807&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/e80c547b7e97e058871636c4b3e0de64/a1a0a/05_steering_19.webp 576w,./static/e80c547b7e97e058871636c4b3e0de64/2d911/05_steering_19.webp 1152w,./static/e80c547b7e97e058871636c4b3e0de64/72ae3/05_steering_19.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/e80c547b7e97e058871636c4b3e0de64/13f47/05_steering_19.png" data-srcset="./static/e80c547b7e97e058871636c4b3e0de64/0dcf4/05_steering_19.png 576w,./static/e80c547b7e97e058871636c4b3e0de64/332e0/05_steering_19.png 1152w,./static/e80c547b7e97e058871636c4b3e0de64/13f47/05_steering_19.png 2304w" alt="Малюнок 5.17: Додавання векторів і множення вектора на скаляр"/></picture><noscript><picture><source type="image/webp" srcSet="./static/e80c547b7e97e058871636c4b3e0de64/a1a0a/05_steering_19.webp 576w,./static/e80c547b7e97e058871636c4b3e0de64/2d911/05_steering_19.webp 1152w,./static/e80c547b7e97e058871636c4b3e0de64/72ae3/05_steering_19.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/e80c547b7e97e058871636c4b3e0de64/13f47/05_steering_19.png" srcSet="./static/e80c547b7e97e058871636c4b3e0de64/0dcf4/05_steering_19.png 576w,./static/e80c547b7e97e058871636c4b3e0de64/332e0/05_steering_19.png 1152w,./static/e80c547b7e97e058871636c4b3e0de64/13f47/05_steering_19.png 2304w" alt="Малюнок 5.17: Додавання векторів і множення вектора на скаляр"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.17: Додавання векторів і множення вектора на скаляр</figcaption>
</figure>
<p>Зверніть увагу, що множення представлене перемноженням вектора на скалярне значення. Це має сенс. Якщо ви хочете, щоб вектор був удвічі більшим (але мав той же напрям), помножте його на <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">2</span></span></span></span></span>. Якщо ви хочете, щоб він був удвічі меншим, помножте його на <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn></mrow><annotation encoding="application/x-tex">0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.5</span></span></span></span></span>. Однак існує кілька інших операцій, <em>подібних до множення</em> з використанням пари векторів, які корисні в певних сценаріях — скалярний добуток, перехресний добуток і так званий добуток Адамара. Наразі я збираюся зосередитися на скалярному добутку.</p>
<p>Припустимо наявність векторів <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>a</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}=(a_x,a_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>b</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{B}=(b_x,b_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<div class="avoid-break">
  <p>Формула скалярного добутку (представлена символом <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋅</mo></mrow><annotation encoding="application/x-tex">\cdot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em"></span><span class="mord">⋅</span></span></span></span></span>) виглядає наступним чином:</p>
  <div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>×</mo><msub><mi>b</mi><mi>x</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>y</mi></msub><mo>×</mo><msub><mi>b</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B}=(a_x\times b_x) + (a_y\times b_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
</div>
<p>Важливо, що результат скалярного добутку є скалярним значенням (одним числом), а не вектором, навіть якщо вхідні дані є двома векторами. Наприклад, ми маємо наступні значення векторів:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>3</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}=(-3,5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span></div>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mn>10</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{B}=(10,1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">10</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></div>
<p>Їх скалярний добуток це:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>3</mn><mo>×</mo><mn>10</mn><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>5</mn><mo>×</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mn>30</mn><mo>+</mo><mn>5</mn><mo>=</mo><mo>−</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B} = (-3 \times 10) + (5 \times 1) = -30 + 5 = -25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">−</span><span class="mord">30</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">−</span><span class="mord">25</span></span></span></span></span></div>
<p>У p5.js це записується наступним чином:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> a = <span class="hljs-title function_">createVector</span>(-<span class="hljs-number">3</span>, <span class="hljs-number">5</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> b = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">10</span>, <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> n = a.<span class="hljs-title function_">dot</span>(b);
</code></pre><div class="comment"><p>Клас p5.Vector включає функцію для обчислення скалярного добутку.</p></div></div></div>
<p>Якщо ви зазирнете у код реалізації класу <code>p5.Vector</code>, то побачите досить просту реалізацію цього методу <code>dot()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-title function_">dot</span>(<span class="hljs-params">v</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> * v.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> * v.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">z</span> * v.<span class="hljs-property">z</span>;
</code></pre><div class="comment"><p>Для 2D векторів компонент z дорівнює 0.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Ця формула досить проста, але чому скалярний добуток необхідний і коли він корисний в програмуванні? Одним з поширених використань с калярного добутку є визначення кута між двома векторами. Насправді скалярний добуток також може бути виражений як показано нижче:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B} = ||\vec{A}||\times||\vec{B}||\times\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></div>
<p>Іншими словами, скалярний добуток <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> дорівнює магнітуді <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> помноженій на магнітуду <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> і помноженій на косинус тети (де тета — це кут між двома векторами <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> та <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>).</p>
<p>Обидві формули скалярного добутку можна вивести одна з одної за допомогою <a href="https://mathworld.wolfram.com/DotProduct.html" target="_blank" rel="noopener">тригонометрії</a>, але я просто буду працювати з припущенням, що:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>×</mo><msub><mi>b</mi><mi>x</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>y</mi></msub><mo>×</mo><msub><mi>b</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">||\vec{A}||\times||\vec{B}||\times\cos(\theta)=(a_x\times b_x) + (a_y\times b_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<div class="avoid-break">
  <p>Це працює, оскільки обидві сторони рівняння дорівнюють <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A} \cdot \vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>. Що мені дає це припущення? Скажімо, я маю наступні значення для векторів <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>:</p>
  <div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mn>10</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}=(10,2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">10</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></div>
  <div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mn>4</mn><mo separator="true">,</mo><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{B}=(4,-3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">−</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span></div>
</div>
<div class="half-width-right">
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1152px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;691&#x27; width=&#x27;1152&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/5823afcadb2619af1711e80b54ed36cd/fd05d/05_steering_20.webp 288w,./static/5823afcadb2619af1711e80b54ed36cd/6b826/05_steering_20.webp 576w,./static/5823afcadb2619af1711e80b54ed36cd/d2ec4/05_steering_20.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" data-src="./static/5823afcadb2619af1711e80b54ed36cd/255ce/05_steering_20.png" data-srcset="./static/5823afcadb2619af1711e80b54ed36cd/f336c/05_steering_20.png 288w,./static/5823afcadb2619af1711e80b54ed36cd/20dea/05_steering_20.png 576w,./static/5823afcadb2619af1711e80b54ed36cd/255ce/05_steering_20.png 1152w" alt="Малюнок 5.18: Кут між двома векторами \vec{A} і \vec{B}"/></picture><noscript><picture><source type="image/webp" srcSet="./static/5823afcadb2619af1711e80b54ed36cd/fd05d/05_steering_20.webp 288w,./static/5823afcadb2619af1711e80b54ed36cd/6b826/05_steering_20.webp 576w,./static/5823afcadb2619af1711e80b54ed36cd/d2ec4/05_steering_20.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" src="./static/5823afcadb2619af1711e80b54ed36cd/255ce/05_steering_20.png" srcSet="./static/5823afcadb2619af1711e80b54ed36cd/f336c/05_steering_20.png 288w,./static/5823afcadb2619af1711e80b54ed36cd/20dea/05_steering_20.png 576w,./static/5823afcadb2619af1711e80b54ed36cd/255ce/05_steering_20.png 1152w" alt="Малюнок 5.18: Кут між двома векторами \vec{A} і \vec{B}"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption>Малюнок 5.18: Кут між двома векторами <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span></figcaption>
  </figure>
</div>
<p>У цьому сценарії я знаю компоненти векторів, але я не знаю кут <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span> між ними (див. малюнок 5.18). Використовуючи формулу скалярного добутку, я можу знайти косинус <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span>:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>×</mo><msub><mi>b</mi><mi>x</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>y</mi></msub><mo>×</mo><msub><mi>b</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\cos(\theta)=\frac{(a_x\times b_x) + (a_y\times b_y)}{||\vec{A}||\times||\vec{B}||}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.5333em;vertical-align:-1.1063em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.1437em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1063em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div>
<p>Щоб знайти <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span>, я можу взяти обернений косинус, або арккосинус (у p5.js це функція <code>acos</code>) правої частини рівняння:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>θ</mi><mo>=</mo><mi>arccos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>a</mi><mi>x</mi></msub><mo>×</mo><msub><mi>b</mi><mi>x</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>y</mi></msub><mo>×</mo><msub><mi>b</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta=\arccos\left(\frac{(a_x\times b_x) + (a_y\times b_y)}{||\vec{A}||\times||\vec{B}||}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em"></span><span class="mop">arccos</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.1437em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1063em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size4">)</span></span></span></span></span></span></span></div>
<p>Виконаємо розрахунки з реальними числами:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>=</mo><mn>10.2</mn></mrow><annotation encoding="application/x-tex">||\vec{A}||=10.2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10.2</span></span></span></span></span></div>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">||\vec{B}||=5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">5</span></span></span></span></span></div>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>θ</mi><mo>=</mo><mi>arccos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>10</mn><mo>×</mo><mn>4</mn><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>×</mo><mo>−</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><mrow><mn>10.2</mn><mo>×</mo><mn>5</mn></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta=\arccos\left(\frac{(10\times4)+(2\times-3)}{10.2\times5}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em"></span><span class="mop">arccos</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">10.2</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">5</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">−</span><span class="mord">3</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size3">)</span></span></span></span></span></span></span></div>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>θ</mi><mo>=</mo><mi>arccos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mn>34</mn><mn>51</mn></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta=\arccos\left(\frac{34}{51}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em"></span><span class="mop">arccos</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">51</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">34</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size3">)</span></span></span></span></span></span></span></div>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>θ</mi><mo>≈</mo><mn>4</mn><msup><mn>8</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">\theta \approx48^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">  ≈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7241em"></span><span class="mord">4</span><span class="mord"><span class="mord">8</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7241em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>У коді p5.js це виглядає так:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> a = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> b = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">4</span>, -<span class="hljs-number">3</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> angle = <span class="hljs-title function_">acos</span>(a.<span class="hljs-title function_">dot</span>(b) / (a.<span class="hljs-title function_">mag</span>() * b.<span class="hljs-title function_">mag</span>()));
</code></pre><div class="comment"><p></p></div></div></div>
<p>Якщо ви ще раз покопаєтеся в нутрощах вихідного коду p5.js, то знайдете метод, який реалізує саме цей алгоритм:</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">angleBetween</span>(<span class="hljs-params">v</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> dot = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dot</span>(v);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> angle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">acos</span>(dot / (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mag</span>() * v.<span class="hljs-title function_">mag</span>()));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">return</span> angle;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Звісно, я міг би одразу розповісти вам про цей метод <code>angleBetween()</code>, але докладне розуміння скалярного добутку краще підготує вас до прикладу слідування шляхом і допоможе вам побачити, як скалярний добуток вписується у концепцію під назвою <em>скалярна проєкція</em>.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-59"><a class="heading-link" href="#exercise-59">Вправа 5.9</a></h3>
  <p>Створіть програму, яка показує кут між двома векторами.</p>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/exercise_5_9_angle_between"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/G80pBHVOE" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<p>Є кілька речей, які варто зауважити про скалярний добуток:</p>
<ul>
  <li>Якщо два вектори (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>) ортогональні (тобто перпендикулярні), їх скалярний добуток (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>) дорівнює 0.</li>
  <li>Якщо два вектори є одиничними, то їх скалярний добуток дорівнює косинусу кута між ними. Іншими словами <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B}=\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span>, якщо <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> мають довжину 1.</li>
</ul>
<p>Тепер, після розгляду основи скалярного добутку, я можу повернутися до алгоритму слідування шляхом Рейнольдса.</p>
<h3 id="simple-path-following"><a class="heading-link" href="#simple-path-following">Просте слідування шляхом</a></h3>
<p>На малюнку 5.19 зображено всі компоненти поведінки слідування шляхом. Окрім агента і цілі тут залучено багато інших складових, тож відведіть деякий час для перегляду всієї схеми. Поступово крок за кроком я розгляну весь алгоритм.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1297&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/254aa5dce88c1c65e90e05b5c7612191/d7fa8/05_steering_21.webp 576w,./static/254aa5dce88c1c65e90e05b5c7612191/537de/05_steering_21.webp 1152w,./static/254aa5dce88c1c65e90e05b5c7612191/d8cf7/05_steering_21.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/254aa5dce88c1c65e90e05b5c7612191/dc69a/05_steering_21.png" data-srcset="./static/254aa5dce88c1c65e90e05b5c7612191/acb01/05_steering_21.png 576w,./static/254aa5dce88c1c65e90e05b5c7612191/33524/05_steering_21.png 1152w,./static/254aa5dce88c1c65e90e05b5c7612191/dc69a/05_steering_21.png 2304w" alt="Малюнок 5.19: Слідування шляхом включає в себе шлях, рухомий агент, майбутню позицію, “нормаль” до шляху та ціль"/></picture><noscript><picture><source type="image/webp" srcSet="./static/254aa5dce88c1c65e90e05b5c7612191/d7fa8/05_steering_21.webp 576w,./static/254aa5dce88c1c65e90e05b5c7612191/537de/05_steering_21.webp 1152w,./static/254aa5dce88c1c65e90e05b5c7612191/d8cf7/05_steering_21.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/254aa5dce88c1c65e90e05b5c7612191/dc69a/05_steering_21.png" srcSet="./static/254aa5dce88c1c65e90e05b5c7612191/acb01/05_steering_21.png 576w,./static/254aa5dce88c1c65e90e05b5c7612191/33524/05_steering_21.png 1152w,./static/254aa5dce88c1c65e90e05b5c7612191/dc69a/05_steering_21.png 2304w" alt="Малюнок 5.19: Слідування шляхом включає в себе шлях, рухомий а гент, майбутню позицію, “нормаль” до шляху та ціль"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.19: Слідування шляхом містить в собі шлях, рухомий агент, майбутню позицію, <em>нормаль</em> до шляху та ціль</figcaption>
</figure>
<p>По-перше, як представити <em>шлях</em>? Для визначення шляху можна використати багато способів, але одним з простих є визначення шляху як послідовності з’єднаних точок, як показано на малюнку 5.20.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;766&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/867acafe75a115df5bc7ac2376009433/96e59/05_steering_22.webp 576w,./static/867acafe75a115df5bc7ac2376009433/291f4/05_steering_22.webp 1152w,./static/867acafe75a115df5bc7ac2376009433/cc755/05_steering_22.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/867acafe75a115df5bc7ac2376009433/4293e/05_steering_22.png" data-srcset="./static/867acafe75a115df5bc7ac2376009433/547ed/05_steering_22.png 576w,./static/867acafe75a115df5bc7ac2376009433/44866/05_steering_22.png 1152w,./static/867acafe75a115df5bc7ac2376009433/4293e/05_steering_22.png 2304w" alt="Малюнок 5.20: Шлях — це послідовність з’єднаних точок"/></picture><noscript><picture><source type="image/webp" srcSet="./static/867acafe75a115df5bc7ac2376009433/96e59/05_steering_22.webp 576w,./static/867acafe75a115df5bc7ac2376009433/291f4/05_steering_22.webp 1152w,./static/867acafe75a115df5bc7ac2376009433/cc755/05_steering_22.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/867acafe75a115df5bc7ac2376009433/4293e/05_steering_22.png" srcSet="./static/867acafe75a115df5bc7ac2376009433/547ed/05_steering_22.png 576w,./static/867acafe75a115df5bc7ac2376009433/44866/05_steering_22.png 1152w,./static/867acafe75a115df5bc7ac2376009433/4293e/05_steering_22.png 2304w" alt="Малюнок 5.20: Шлях — це послідовність з’єднаних точок"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.20: Шлях — це послідовність з’єднаних точок</figcaption>
</figure>
<p>Найпростішою версією цього шляху буде просто лінія між двома точками (малюнок 5.21).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;594&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/3809d26b7b54c43a5097f5163820870c/d768e/05_steering_23.webp 576w,./static/3809d26b7b54c43a5097f5163820870c/dcbe7/05_steering_23.webp 1152w,./static/3809d26b7b54c43a5097f5163820870c/bdd46/05_steering_23.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/3809d26b7b54c43a5097f5163820870c/78d6d/05_steering_23.png" data-srcset="./static/3809d26b7b54c43a5097f5163820870c/0a615/05_steering_23.png 576w,./static/3809d26b7b54c43a5097f5163820870c/aa88d/05_steering_23.png 1152w,./static/3809d26b7b54c43a5097f5163820870c/78d6d/05_steering_23.png 2304w" alt="Малюнок 5.21: Шлях із початком, кінцем і радіусом"/></picture><noscript><picture><source type="image/webp" srcSet="./static/3809d26b7b54c43a5097f5163820870c/d768e/05_steering_23.webp 576w,./static/3809d26b7b54c43a5097f5163820870c/dcbe7/05_steering_23.webp 1152w,./static/3809d26b7b54c43a5097f5163820870c/bdd46/05_steering_23.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/3809d26b7b54c43a5097f5163820870c/78d6d/05_steering_23.png" srcSet="./static/3809d26b7b54c43a5097f5163820870c/0a615/05_steering_23.png 576w,./static/3809d26b7b54c43a5097f5163820870c/aa88d/05_steering_23.png 1152w,./static/3809d26b7b54c43a5097f5163820870c/78d6d/05_steering_23.png 2304w" alt="Малюнок 5.21: Шлях із початком, кінцем і радіусом"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.21: Шлях із початком, кінцем і радіусом</figcaption>
</figure>
<p>Я також збираюся розглянути шлях, що має <em>радіус</em>. Якщо шлях — це дорога, то радіус — це ширина дороги. З меншим радіусом агенти повинні слідувати шляхом більш центровано, ширший радіус дозволяє їм трохи відхилятися по обидві сторони шляху.</p>
<p>Тепер зберемо це у клас.</p>
<div data-type="example">
  <h3 id="example-55-creating-a-path-object"><a class="heading-link" href="#example-55-creating-a-path-object">Приклад 5.5: Створення об’єкта шляху</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/nature_of_code_example_5_5_path_only"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/8SALyBTym" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Path</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> = <span class="hljs-number">20</span>;
</code></pre><div class="comment"><p>Шлях має радіус, що визначає його ширину.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span> = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, height / <span class="hljs-number">3</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span> = <span class="hljs-title function_">createVector</span>(width, (<span class="hljs-number">2</span> * height) / <span class="hljs-number">3</span>);
</code></pre><div class="comment"><p>Шлях із двох точок: початку і кінцю.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">strokeWeight</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>);
    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>);
    <span class="hljs-title function_">line</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span>.<span class="hljs-property">y</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span>.<span class="hljs-property">y</span>);
    <span class="hljs-title function_">strokeWeight</span>(<span class="hljs-number">1</span>);
    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>);
    <span class="hljs-title function_">line</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span>.<span class="hljs-property">y</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span>.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span>.<span class="hljs-property">y</span>);
</code></pre><div class="comment"><p>Малювання шляху.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер припустімо, що рухомий агент знаходиться за межами радіуса шляху та переміщується з певною швидкістю, як на малюнку 5.22.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;772&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/2857513db61aea7d3c44af3df95ba39d/efc9d/05_steering_24.webp 576w,./static/2857513db61aea7d3c44af3df95ba39d/bbc86/05_steering_24.webp 1152w,./static/2857513db61aea7d3c44af3df95ba39d/8f000/05_steering_24.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/2857513db61aea7d3c44af3df95ba39d/8452f/05_steering_24.png" data-srcset="./static/2857513db61aea7d3c44af3df95ba39d/848a6/05_steering_24.png 576w,./static/2857513db61aea7d3c44af3df95ba39d/9431f/05_steering_24.png 1152w,./static/2857513db61aea7d3c44af3df95ba39d/8452f/05_steering_24.png 2304w" alt="Малюнок 5.22: Додавання агента, який рухається поодаль від шляху"/></picture><noscript><picture><source type="image/webp" srcSet="./static/2857513db61aea7d3c44af3df95ba39d/efc9d/05_steering_24.webp 576w,./static/2857513db61aea7d3c44af3df95ba39d/bbc86/05_steering_24.webp 1152w,./static/2857513db61aea7d3c44af3df95ba39d/8f000/05_steering_24.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/2857513db61aea7d3c44af3df95ba39d/8452f/05_steering_24.png" srcSet="./static/2857513db61aea7d3c44af3df95ba39d/848a6/05_steering_24.png 576w,./static/2857513db61aea7d3c44af3df95ba39d/9431f/05_steering_24.png 1152w,./static/2857513db61aea7d3c44af3df95ba39d/8452f/05_steering_24.png 2304w" alt="Малюнок 5.22: Додавання агента, який рухається поодаль від шляху"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.22: Рухомий агент, який переміщується осторонь від шляху</figcaption>
</figure>
<p>Першим кроком буде передбачення (за умови постійної швидкості), де цей агент буде в майбутньому:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> future = vel.<span class="hljs-title function_">copy</span>();
</code></pre><div class="comment"><p>Починаємо зі створення копії швидкості.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">future.<span class="hljs-title function_">setMag</span>(<span class="hljs-number">25</span>);
</code></pre><div class="comment"><p>Дивимося на 25 пікселів уперед, встановлюючи відповідну магнітуду.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">future.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p>Додаємо вектор до позиції, щоб знайти майбутнє положення.</p></div></div></div>
<p>Коли ми отримали спрогнозоване положення, потрібно визначити відстань від нього до шляху. Якщо положення дуже далеко, агент збився зі шляху і потрібно до нього повернутися. Якщо об’єкт знаходиться на шляху, то все гаразд і агент може продовжувати свій шлях.</p>
<p>По суті, мені потрібно обчислити відстань між точкою (майбутнім положенням) і лінією (шляхом). Ця відстань визначається як довжина <strong>нормалі</strong>, вектор, що простягається від точки до лінії і є перпендикулярним до лінії (малюнок 5.23).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;863&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/58d90d651615064924f1782983130f46/1c296/05_steering_25.webp 576w,./static/58d90d651615064924f1782983130f46/56688/05_steering_25.webp 1152w,./static/58d90d651615064924f1782983130f46/d06cf/05_steering_25.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/58d90d651615064924f1782983130f46/83492/05_steering_25.png" data-srcset="./static/58d90d651615064924f1782983130f46/59672/05_steering_25.png 576w,./static/58d90d651615064924f1782983130f46/22973/05_steering_25.png 1152w,./static/58d90d651615064924f1782983130f46/83492/05_steering_25.png 2304w" alt="Малюнок 5.23: Нормаль — це вектор, який простягається від майбутньої позиції агента до шляху і перпендикулярний шляху"/></picture><noscript><picture><source type="image/webp" srcSet="./static/58d90d651615064924f1782983130f46/1c296/05_steering_25.webp 576w,./static/58d90d651615064924f1782983130f46/56688/05_steering_25.webp 1152w,./static/58d90d651615064924f1782983130f46/d06cf/05_steering_25.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/58d90d651615064924f1782983130f46/83492/05_steering_25.png" srcSet="./static/58d90d651615064924f1782983130f46/59672/05_steering_25.png 576w,./static/58d90d651615064924f1782983130f46/22973/05_steering_25.png 1152w,./static/58d90d651615064924f1782983130f46/83492/05_steering_25.png 2304w" alt="Малюнок 5.23: Нормаль — це вектор, який простягаєт ься від майбутньої позиції агента до шляху і перпендикулярний шляху"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.23: Нормаль — це вектор, який простягається від майбутньої позиції агента до шляху і перпендикулярний шляху</figcaption>
</figure>
<p>Як знайти нормаль? Спочатку я можу визначити вектор (назвемо його <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>), який вказує від початкової точки шляху до майбутнього положення агента:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> a = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(future, path.<span class="hljs-property">start</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Далі я можу визначити вектор (назвемо його <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>), який вказує від початку шляху до його кінця:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> b = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(path.<span class="hljs-property">end</span>, path.<span class="hljs-property">start</span>);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер, залучивши трішки тригонометрії (<em>cah</em> із <em>sohcahtoa</em>), я можу обчислити відстань від початку шляху до точки нормалі. Як показано на малюнку 5.24, це <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">||\vec{A}|| \times \cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span>.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;872&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/fe7279d0156b264194d1cbab164760e2/c78cf/05_steering_26.webp 576w,./static/fe7279d0156b264194d1cbab164760e2/23a50/05_steering_26.webp 1152w,./static/fe7279d0156b264194d1cbab164760e2/5edf0/05_steering_26.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/fe7279d0156b264194d1cbab164760e2/5c082/05_steering_26.png" data-srcset="./static/fe7279d0156b264194d1cbab164760e2/7c9af/05_steering_26.png 576w,./static/fe7279d0156b264194d1cbab164760e2/c7e09/05_steering_26.png 1152w,./static/fe7279d0156b264194d1cbab164760e2/5c082/05_steering_26.png 2304w" alt="Малюнок 5.24: Відстань від початку шляху до нормалі дорівнює ||\vec{A}|| \times \cos(\theta)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/fe7279d0156b264194d1cbab164760e2/c78cf/05_steering_26.webp 576w,./static/fe7279d0156b264194d1cbab164760e2/23a50/05_steering_26.webp 1152w,./static/fe7279d0156b264194d1cbab164760e2/5edf0/05_steering_26.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/fe7279d0156b264194d1cbab164760e2/5c082/05_steering_26.png" srcSet="./static/fe7279d0156b264194d1cbab164760e2/7c9af/05_steering_26.png 576w,./static/fe7279d0156b264194d1cbab164760e2/c7e09/05_steering_26.png 1152w,./static/fe7279d0156b264194d1cbab164760e2/5c082/05_steering_26.png 2304w" alt="Малюнок 5.24: Відстань від початку шляху до нормалі дорівнює ||\vec{A}|| \times \cos(\theta)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.24: Відстань від початку шляху до нормалі дорівнює <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">||\vec{A}|| \times \cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></figcaption>
</figure>
<p>Якби я тільки знав значення кута <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span></span></span></span></span>, я міг знайти цю точку нормалі за допомогою наступного коду:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> d = a.<span class="hljs-title function_">mag</span>() * <span class="hljs-title function_">cos</span>(theta);
</code></pre><div class="comment"><p>Отримання відстані від початкової точки до нормалі.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">b.<span class="hljs-title function_">setMag</span>(d);
</code></pre><div class="comment"><p>Масштабування вектора b на знайдену відстань.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> normalPoint = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">add</span>(path.<span class="hljs-property">start</span>, b);
</code></pre><div class="comment"><p>Точку нормалі можна знайти, додавши масштабовану версію b до початкової точки шляху.</p></div></div></div>
<p>На щастя, якщо скалярний добуток чогось мене навчив, так це того, що за наявності двох векторів я можу обчислити кут між цими векторами!</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> theta = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">angleBetween</span>(a, b);
</code></pre><div class="comment"><p>Що таке theta? Кут між A і B!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> d = a.<span class="hljs-title function_">mag</span>() * <span class="hljs-title function_">cos</span>(theta);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">b.<span class="hljs-title function_">setMag</span>(d);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> normalPoint = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">add</span>(path.<span class="hljs-property">start</span>, b);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Хоча цей код працюватиме, я можу зробити ще одне спрощення. Подивившись ще раз, ви побачите, що магнітуда вектора <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> встановлена як <code>a.mag() * cos(theta)</code>, що являє собою:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">||\vec{A}||\times\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></div>
<p>Пригадайте наступне рівняння:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B}=||\vec{A}||\times||\vec{B}||\times\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></div>
<p>Тепер якщо <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> є одиничним вектором із довжиною 1, тоді:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mn>1</mn><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B}=||\vec{A}||\times1\times\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></div>
<p>Або простіше:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>B</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{A}\cdot\vec{B}=||\vec{A}||\times\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></div>
<p>Коли <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> є одиничним вектором, тоді <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">||\vec{A}|| \times \cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span> це те саме, що і скалярний добуток <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> та <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>. Перетворити <code>b</code> на одиничний вектор дуже просто — достатньо викликати метод <code>normalize()</code>. Таким чином, я можу обійти обчислення <code>theta</code> за допомогою методу <code>angleBetween()</code> і спростити код:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> theta = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">angleBetween</span>(a, b);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> d = a.<span class="hljs-title function_">mag</span>() * <span class="hljs-title function_">cos</span>(theta);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">b.<span class="hljs-title function_">setMag</span>(d);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">b.<span class="hljs-title function_">normalize</span>();
b.<span class="hljs-title function_">setMag</span>(a.<span class="hljs-title function_">dot</span>(b));
</code></pre><div class="comment"><p>Нормалізуємо b і використаємо скалярний добуток, щоб встановити довжину b.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> normalPoint = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">add</span>(path.<span class="hljs-property">start</span>, b);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Цей процес масштабування <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> відповідно до точки нормалі широко відомий як <strong>скалярна проєкція</strong>. Ми кажемо, що <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">||\vec{A}||\times\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span> <em>є скалярною проекцією</em> <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> <em>на</em> <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>, як на малюнку 5.25.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;905.0000000000001&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/9bfcdf256c3cf506c79b4b42a1fcaf73/69b14/05_steering_27.webp 576w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/5eedf/05_steering_27.webp 1152w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/7b51c/05_steering_27.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/9bfcdf256c3cf506c79b4b42a1fcaf73/1868a/05_steering_27.png" data-srcset="./static/9bfcdf256c3cf506c79b4b42a1fcaf73/ca6ab/05_steering_27.png 576w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/3b584/05_steering_27.png 1152w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/1868a/05_steering_27.png 2304w" alt="Малюнок 5.25: Скалярна проєкція \vec{A} на \vec{B} дорівнює ||\vec{A}||\times\cos(\theta)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/9bfcdf256c3cf506c79b4b42a1fcaf73/69b14/05_steering_27.webp 576w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/5eedf/05_steering_27.webp 1152w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/7b51c/05_steering_27.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/9bfcdf256c3cf506c79b4b42a1fcaf73/1868a/05_steering_27.png" srcSet="./static/9bfcdf256c3cf506c79b4b42a1fcaf73/ca6ab/05_steering_27.png 576w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/3b584/05_steering_27.png 1152w,./static/9bfcdf256c3cf506c79b4b42a1fcaf73/1868a/05_steering_27.png 2304w" alt="Малюнок 5.25: Скалярна проєкція \vec{A} на \vec{B} дорівнює ||\vec{A}||\times\cos(\theta)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.25: Скалярна проєкція <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> на <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> дорівнює <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>A</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">||\vec{A}||\times\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2163em;vertical-align:-0.25em"></span><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.0966em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">θ</span><span class="mclose">)</span></span></span></span></span></figcaption>
</figure>
<p>Коли я маю точку нормалі вздовж шляху, наступним кроком буде визначення того, чи має агент рухатися у напрямку до шляху і як це має бути. Алгоритм Рейнольдса стверджує, що агент має прямувати до шляху, лише якщо існує небезпека вийти за його межі, тобто якщо відстань між точкою нормалі й прогнозованим майбутнім положенням більше радіуса шляху. Це проілюстровано на малюнку 5.26.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;621&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/a82591e492f9e7ee91430ef5aa519f50/9291b/05_steering_28.webp 576w,./static/a82591e492f9e7ee91430ef5aa519f50/dbb91/05_steering_28.webp 1152w,./static/a82591e492f9e7ee91430ef5aa519f50/df0d2/05_steering_28.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/a82591e492f9e7ee91430ef5aa519f50/96b82/05_steering_28.png" data-srcset="./static/a82591e492f9e7ee91430ef5aa519f50/8ce1c/05_steering_28.png 576w,./static/a82591e492f9e7ee91430ef5aa519f50/e2d2c/05_steering_28.png 1152w,./static/a82591e492f9e7ee91430ef5aa519f50/96b82/05_steering_28.png 2304w" alt="Малюнок 5.26: Об’єкти із прогнозованими позиціями: одна на шляху (знизу), а друга знаходиться поза ним (зверху)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/a82591e492f9e7ee91430ef5aa519f50/9291b/05_steering_28.webp 576w,./static/a82591e492f9e7ee91430ef5aa519f50/dbb91/05_steering_28.webp 1152w,./static/a82591e492f9e7ee91430ef5aa519f50/df0d2/05_steering_28.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/a82591e492f9e7ee91430ef5aa519f50/96b82/05_steering_28.png" srcSet="./static/a82591e492f9e7ee91430ef5aa519f50/8ce1c/05_steering_28.png 576w,./static/a82591e492f9e7ee91430ef5aa519f50/e2d2c/05_steering_28.png 1152w,./static/a82591e492f9e7ee91430ef5aa519f50/96b82/05_steering_28.png 2304w" alt="Малюнок 5.26: Об’єкти із прогнозованими позиціями: одна на шляху (знизу), а друга знаходиться поза ним (зверху)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.26: Об’єкти із прогнозованими позиціями: одна на шляху (знизу), а друга знаходиться поза ним (зверху)</figcaption>
</figure>
<p>Я можу закодувати цю логіку за допомогою простого <code>if</code> оператора і використовувати свій попередній метод <code>seek()</code> для скерування агента, коли це необхідно:</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> distance = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(future, normalPoint);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">if</span> (distance &gt; path.<span class="hljs-property">radius</span>) {
</code></pre><div class="comment"><p>Якщо агент знаходиться поза шляхом, він шукайте ціль.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">seek</span>(target);
</code></pre><div class="comment"><p>Бажану швидкість і керувальну силу можна отримати за допомогою методу пошуку, створеного у прикладі 5.1.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Але де повинна бути ціль, якою має керуватись послідовник шляху? Алгоритм Рейнольдса передбачає вибір точки на шляху попереду нормалі. Оскільки я знаю вектор, який визначає шлях (це <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span>), я можу вичислити потрібну точку попереду додавши вектор, який вказує у напрямку <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>B</mi><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{B}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span><span style="top:-3.2523em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-0.1522em"><span class="overlay" style="height:0.714em;width:0.471em"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path></svg></span></span></span></span></span></span></span></span></span></span></span> до вектора, що представляє точку нормалі, як на малюнку 5.27.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;972&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/148136a2dd99740499a1a2651c45e6e3/97225/05_steering_29.webp 576w,./static/148136a2dd99740499a1a2651c45e6e3/6a989/05_steering_29.webp 1152w,./static/148136a2dd99740499a1a2651c45e6e3/c6d73/05_steering_29.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/148136a2dd99740499a1a2651c45e6e3/8b167/05_steering_29.png" data-srcset="./static/148136a2dd99740499a1a2651c45e6e3/704ba/05_steering_29.png 576w,./static/148136a2dd99740499a1a2651c45e6e3/ed20c/05_steering_29.png 1152w,./static/148136a2dd99740499a1a2651c45e6e3/8b167/05_steering_29.png 2304w" alt="Малюнок 5.27: Ціль знаходиться на шляху на 25 пікселів (довільний вибір) попереду точки нормалі"/></picture><noscript><picture><source type="image/webp" srcSet="./static/148136a2dd99740499a1a2651c45e6e3/97225/05_steering_29.webp 576w,./static/148136a2dd99740499a1a2651c45e6e3/6a989/05_steering_29.webp 1152w,./static/148136a2dd99740499a1a2651c45e6e3/c6d73/05_steering_29.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/148136a2dd99740499a1a2651c45e6e3/8b167/05_steering_29.png" srcSet="./static/148136a2dd99740499a1a2651c45e6e3/704ba/05_steering_29.png 576w,./static/148136a2dd99740499a1a2651c45e6e3/ed20c/05_steering_29.png 1152w,./static/148136a2dd99740499a1a2651c45e6e3/8b167/05_steering_29.png 2304w" alt="Малюнок 5.27: Ціль знаходиться на шляху на 25 пікселів (довільний вибір) попереду точки нормалі"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.27: Ціль знаходиться на шляху на 25 пікселів (довільний вибір) попереду точки нормалі</figcaption>
</figure>
<p>Я скажу, що ціль має бути, наприклад, на 25 пікселів попереду нормалі:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> distance = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(future, normalPoint);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">if</span> (distance &gt; path.<span class="hljs-property">radius</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  b.<span class="hljs-title function_">setMag</span>(<span class="hljs-number">25</span>);
</code></pre><div class="comment"><p>Встановимо довжину у 25 пікселів (вибрано довільно).</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> target = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">add</span>(normalPoint, b);
</code></pre><div class="comment"><p>Додамо b до normalPoint, щоб знайти ціль на шляху на 25 пікселів попереду.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">seek</span>(target);
</code></pre><div class="comment"><p>Направлення агента на ціль методом пошуку.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зібра вши все це разом, отримаємо у класі <code>Vehicle</code> метод слідування шляхом.</p>
<div data-type="example">
  <h3 id="example-56-simple-path-following"><a class="heading-link" href="#example-56-simple-path-following">Приклад 5.6: Просте слідування шляхом</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_05_path_following_simple"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/zcH21K3T3" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">follow</span>(<span class="hljs-params">path</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> future = <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>.<span class="hljs-title function_">copy</span>();
    future.<span class="hljs-title function_">setMag</span>(<span class="hljs-number">25</span>);
    future.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p>Крок 1: Прогнозуємо майбутнє положення агента.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> normalPoint = <span class="hljs-title function_">getNormalPoint</span>(future, path.<span class="hljs-property">start</span>, path.<span class="hljs-property">end</span>);
</code></pre><div class="comment"><p>Крок 2: Знаходимо на шляху точку нормалі.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> b = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(path.<span class="hljs-property">end</span>, path.<span class="hljs-property">start</span>);
    b.<span class="hljs-title function_">setMag</span>(<span class="hljs-number">25</span>);
    <span class="hljs-keyword">let</span> target = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">add</span>(normalPoint, b);
</code></pre><div class="comment"><p>Крок 3: Дивимося трохи далі вздовж шляху і встановлюємо ціль.
(Для оптимізації це можна перемістити в оператор if, щоб знаходити ціль, лише якщо вона не на шляху.)</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> distance = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(normalPoint, future);
    <span class="hljs-keyword">if</span> (distance &gt; path.<span class="hljs-property">radius</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">seek</span>(target);
    }
</code></pre><div class="comment"><p>Крок 4: Якщо агент зійшов зі шляху,
направляємо його до цілі, щоб він повернутися на шлях.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<div class="half-width-right">
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1152px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;864&#x27; width=&#x27;1152&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/9003809896792d38a3cd518a78f16e25/c96b4/05_steering_30.webp 288w,./static/9003809896792d38a3cd518a78f16e25/94165/05_steering_30.webp 576w,./static/9003809896792d38a3cd518a78f16e25/2624c/05_steering_30.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" data-src="./static/9003809896792d38a3cd518a78f16e25/6ea41/05_steering_30.png" data-srcset="./static/9003809896792d38a3cd518a78f16e25/87bbf/05_steering_30.png 288w,./static/9003809896792d38a3cd518a78f16e25/875b6/05_steering_30.png 576w,./static/9003809896792d38a3cd518a78f16e25/6ea41/05_steering_30.png 1152w" alt="Малюнок 5.28: Елементи методу getNormalPoint() function: position, a і b"/></picture><noscript><picture><source type="image/webp" srcSet="./static/9003809896792d38a3cd518a78f16e25/c96b4/05_steering_30.webp 288w,./static/9003809896792d38a3cd518a78f16e25/94165/05_steering_30.webp 576w,./static/9003809896792d38a3cd518a78f16e25/2624c/05_steering_30.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" src="./static/9003809896792d38a3cd518a78f16e25/6ea41/05_steering_30.png" srcSet="./static/9003809896792d38a3cd518a78f16e25/87bbf/05_steering_30.png 288w,./static/9003809896792d38a3cd518a78f16e25/875b6/05_steering_30.png 576w,./static/9003809896792d38a3cd518a78f16e25/6ea41/05_steering_30.png 1152w" alt="Малюнок 5.28: Елементи методу getNormalPoint() function: position, a і b"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption>Малюнок 5.28: Елементи методу <code>getNormalPoint()</code>: <code>position</code>, <code>a</code> і <code>b</code></figcaption>
  </figure>
</div>
<p></p>
<p>Зауважте, що замість використання коду скалярного добутку та скалярної проєкції для пошуку точки нормалі я викликаю метод <code>getNormalPoint()</code>. У таких випадках корисно розділити код, який виконує конкретне завдання (знаходження точки нормалі) на окремий метод, який можна викликати за потреби. Метод приймає три векторні аргументи (див. малюнок 5.28): перший визначає точку <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span></span></span></span></span> у декартовому просторі (майбутнє положення агента), а другий і третій визначають відрізок між двома точками <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">a</span></span></span></span></span> і <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">b</span></span></span></span></span> (шлях).</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">getNormalPoint</span>(<span class="hljs-params">position, a, b</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> vectorA = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(position, a);
</code></pre><div class="comment"><p>Вектор, що вказує від a до position.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> vectorB = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(b, a);
</code></pre><div class="comment"><p>Вектор, який вказує від a до b.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    vectorB.<span class="hljs-title function_">normalize</span>();
    vectorB.<span class="hljs-title function_">mult</span>(vectorA.<span class="hljs-title function_">dot</span>(vectorB));
</code></pre><div class="comment"><p>Використання скалярного добутку для  скалярної проєкції.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> normalPoint = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">add</span>(a, vectorB);
</code></pre><div class="comment"><p>Знаходження на відрізку точки нормалі.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">return</span> normalPoint;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Що я вже маю? У мене є клас <code>Path</code>, який визначає шлях як лінію між двома точками. У мене є клас <code>Vehicle</code> з методом слідування шляхом (за допомогою керування для пошуку цілі вздовж шляху). Загалом, це вже гідний приклад, але все ще до біса обмежений. Чого ще не вистачає?</p>
<p>Зробіть глибокий подих. Ми майже на місці.</p>
<h3 id="path-following-with-multiple-segments"><a class="heading-link" href="#path-following-with-multiple-segments">Слідування шляхом з кількома сегментами</a></h3>
<p>Що, якщо мені потрібно, щоб агент слідував складнішим шляхом, ніж просто одна пряма лінія? Можливо це, криволінійний шлях, який вигинається у різних напрямках, як на малюнку 5.29?</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;515&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/f320b7d9a9bfa29d5cfc75c531879dbe/f9bd3/05_steering_31.webp 576w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/b63da/05_steering_31.webp 1152w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/43be0/05_steering_31.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/f320b7d9a9bfa29d5cfc75c531879dbe/12264/05_steering_31.png" data-srcset="./static/f320b7d9a9bfa29d5cfc75c531879dbe/4895e/05_steering_31.png 576w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/b887d/05_steering_31.png 1152w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/12264/05_steering_31.png 2304w" alt="Малюнок 5.29: Складніший шлях"/></picture><noscript><picture><source type="image/webp" srcSet="./static/f320b7d9a9bfa29d5cfc75c531879dbe/f9bd3/05_steering_31.webp 576w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/b63da/05_steering_31.webp 1152w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/43be0/05_steering_31.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/f320b7d9a9bfa29d5cfc75c531879dbe/12264/05_steering_31.png" srcSet="./static/f320b7d9a9bfa29d5cfc75c531879dbe/4895e/05_steering_31.png 576w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/b887d/05_steering_31.png 1152w,./static/f320b7d9a9bfa29d5cfc75c531879dbe/12264/05_steering_31.png 2304w" alt="Малюнок 5.29: Складніший шлях"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.29: Складніший шлях</figcaption>
</figure>
<p>Можливо, я дещо амбітний. Я <em>міг би</em> дослідити алгоритми проходження криволінійного шляху, але це збільшує вірогідність того, що тоді мені в кінці знадобиться на лобі прохолодний компрес. Тож для зменшення цього шансу я все-таки дотримаюсь підходу з прямими сегментами, як на малюнку 5.30. Я все ще можу <em>намалювати</em> шлях у вигляді кривої, але найкраще апроксимувати його за допомогою спрощених геометричних форм для необхідних обчислень.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;545&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/970e014fb13e0f8c157970835869f16a/3125d/05_steering_32.webp 576w,./static/970e014fb13e0f8c157970835869f16a/0b2df/05_steering_32.webp 1152w,./static/970e014fb13e0f8c157970835869f16a/daeeb/05_steering_32.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/970e014fb13e0f8c157970835869f16a/e8143/05_steering_32.png" data-srcset="./static/970e014fb13e0f8c157970835869f16a/32f11/05_steering_32.png 576w,./static/970e014fb13e0f8c157970835869f16a/d15e5/05_steering_32.png 1152w,./static/970e014fb13e0f8c157970835869f16a/e8143/05_steering_32.png 2304w" alt="Малюнок 5.30: Той самий криволінійний шлях, але апроксимований у вигляді сполучених прямих відрізків"/></picture><noscript><picture><source type="image/webp" srcSet="./static/970e014fb13e0f8c157970835869f16a/3125d/05_steering_32.webp 576w,./static/970e014fb13e0f8c157970835869f16a/0b2df/05_steering_32.webp 1152w,./static/970e014fb13e0f8c157970835869f16a/daeeb/05_steering_32.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/970e014fb13e0f8c157970835869f16a/e8143/05_steering_32.png" srcSet="./static/970e014fb13e0f8c157970835869f16a/32f11/05_steering_32.png 576w,./static/970e014fb13e0f8c157970835869f16a/d15e5/05_steering_32.png 1152w,./static/970e014fb13e0f8c157970835869f16a/e8143/05_steering_32.png 2304w" alt="Малюнок 5.30: Той самий криволінійний шлях, але апроксимований у вигляді сполучених прямих відрізків"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.30: Той самий криволінійний шлях, але апроксимований у вигляді сполучених прямих відрізків</figcaption>
</figure>
<p>Якщо мені вдалося зробити слідування шляхом з одним лінійним сегментом, то як зробити це з серією з’єднаних сегментів? Ключ у тому, як я знаходжу цільову точку вздовж шляху.</p>
<p>Для знаходження цільової точки з одним відрізком мені довелося обчислити нормаль до цього відрізка. Тепер, коли є серія лінійних відрізків, є також і серія точок нормалей, які потрібно обчислити — по одній для кожного сегмента (див. малюнок 5.31). Яку з них вибере агент? Рішення, запропоноване Рейнольдсом, полягає в тому, щоб вибрати точку нормалі, яка є найближчою і знаходиться на шляху.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1208&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/3ce53dc038720ae12bc1556fb7439c9d/6966f/05_steering_33.webp 576w,./static/3ce53dc038720ae12bc1556fb7439c9d/aff2e/05_steering_33.webp 1152w,./static/3ce53dc038720ae12bc1556fb7439c9d/7d124/05_steering_33.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="./static/3ce53dc038720ae12bc1556fb7439c9d/ec933/05_steering_33.png" data-srcset="./static/3ce53dc038720ae12bc1556fb7439c9d/b8a7d/05_steering_33.png 576w,./static/3ce53dc038720ae12bc1556fb7439c9d/b54d0/05_steering_33.png 1152w,./static/3ce53dc038720ae12bc1556fb7439c9d/ec933/05_steering_33.png 2304w" alt="Малюнок 5.31: Знаходження найближчої точки нормалі вздовж серії з’єднаних відрізків"/></picture><noscript><picture><source type="image/webp" srcSet="./static/3ce53dc038720ae12bc1556fb7439c9d/6966f/05_steering_33.webp 576w,./static/3ce53dc038720ae12bc1556fb7439c9d/aff2e/05_steering_33.webp 1152w,./static/3ce53dc038720ae12bc1556fb7439c9d/7d124/05_steering_33.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="./static/3ce53dc038720ae12bc1556fb7439c9d/ec933/05_steering_33.png" srcSet="./static/3ce53dc038720ae12bc1556fb7439c9d/b8a7d/05_steering_33.png 576w,./static/3ce53dc038720ae12bc1556fb7439c9d/b54d0/05_steering_33.png 1152w,./static/3ce53dc038720ae12bc1556fb7439c9d/ec933/05_steering_33.png 2304w" alt="Малюнок 5.31: Знаходження найближчої точки нормалі вздовж серії з’єднаних відрізків"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.31: Знаходження найближчої точки нормалі вздовж серії з’єднаних відрізків</figcaption>
</figure>
<p>Якщо у вас є точка і нескінченно довга лінія, у вас завжди буде точка нормалі, яка торкається до лінії. Але якщо у вас є точка і скінченний відрізок, ви не обов’язково знайдете нормаль, що лежить на цьому відрізку. Якщо це станеться для будь-якого із сегментів, я можу виключити ці нормалі. Після того, як у мене залишаться лише ті нормалі, які знаходяться на шляху (лише дві на малюнку 5.31), я оберу найкоротшу з них.</p>
<p>Для переведення цього плану у код, я розширю клас <code>Path</code>, щоб у ньому був масив точок (а н е лише початкова і кінцева).</p>
<div data-type="example">
  <h3 id="example-57-path-made-of-multiple-line-segments"><a class="heading-link" href="#example-57-path-made-of-multiple-line-segments">Приклад 5.7: Шлях, що складається з кількох відрізків</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/5_6_path_segments_only"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/ntGaosFQ7" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Path</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> = <span class="hljs-number">20</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span> = [];
</code></pre><div class="comment"><p>Тепер шлях — це масив точок (об’єкти p5.Vector).</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">addPoint</span>(<span class="hljs-params">x, y</span>) {
    <span class="hljs-keyword">let</span> pathPoint = <span class="hljs-title function_">createVector</span>(x, y);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>.<span class="hljs-title function_">push</span>(pathPoint);
  }
</code></pre><div class="comment"><p>Цей метод дозволяє додавати точки до шляху.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">200</span>);
    <span class="hljs-title function_">strokeWeight</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>);
    <span class="hljs-title function_">noFill</span>();
    <span class="hljs-title function_">beginShape</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> pathPoint <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>) {
      <span class="hljs-title function_">vertex</span>(pathPoint.<span class="hljs-property">x</span>, pathPoint.<span class="hljs-property">y</span>);
    }
    <span class="hljs-title function_">endShape</span>();
</code></pre><div class="comment"><p>Малювання товстішої сірої лінії для позначення радіуса шляху.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">stroke</span>(<span class="hljs-number">0</span>);
    <span class="hljs-title function_">strokeWeight</span>(<span class="hljs-number">1</span>);
    <span class="hljs-title function_">beginShape</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> pathPoint <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">points</span>) {
      <span class="hljs-title function_">vertex</span>(pathPoint.<span class="hljs-property">x</span>, pathPoint.<span class="hljs-property">y</span>);
    }
    <span class="hljs-title function_">endShape</span>();
</code></pre><div class="comment"><p>Малювання тонкої лінії для позначення центру шляху.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер, коли клас <code>Path</code> оновлено, настала черга агента навчитися пристосовуватися до кількох лінійних сегментів. До цього він просто знаходив нормаль для одного сегмента. За допомогою циклу він може знайти нормалі для всіх сегментів:</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; path.<span class="hljs-property">points</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> a = path.<span class="hljs-property">points</span>[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> b = path.<span class="hljs-property">points</span>[i + <span class="hljs-number">1</span>];
</code></pre><div class="comment"><p></p></div></div><div class="offset-top pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> normalPoint = <span class="hljs-title function_">getNormalPoint</span>(future, a, b);
</code></pre><div class="comment"><p>Знайдемо нормаль для кожного відрізка.</p></div></div></div>
</div>
<p>Наступним кроком буде перевірка, чи точка нормалі дійсно знаходиться між точкам <code>a</code> і <code>b</code>. Оскільки я знаю, що в цьому прикладі шлях йде зліва направо, то можу перевірити чи <code>x</code>-компонента нормалі <code>normalPoint</code> знаходиться поза <code>x</code>-компонентами <code>a</code> і <code>b</code>:</p>
<div class="snip-below snip-above avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">   <span class="hljs-keyword">if</span> (normalPoint.<span class="hljs-property">x</span> &lt; a.<span class="hljs-property">x</span> || normalPoint.<span class="hljs-property">x</span> &gt; b.<span class="hljs-property">x</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">     normalPoint = b.<span class="hljs-title function_">copy</span>();
</code></pre><div class="comment"><p>Якщо ми не можемо знайти нормаль,
використаємо замість неї кінцеву точку сегмента.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">   }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Якщо нормаль не знаходиться в межах відрізка, я просто вважатиму, що кінцева точка цього відрізка і є нор маллю. (Ви також можете спробувати початкову точку, залежно від особливостей вашого шляху.) Це гарантує, що агент завжди залишатиметься на шляху, навіть якщо він виходить за межі відрізків.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-510"><a class="heading-link" href="#exercise-510">Вправа 5.10</a></h3>
  <p>Більш загальний спосіб перевірки того, чи точка нормалі лежить на сегменті, полягає в підсумовуванні відстаней між <code>normalPoint</code> та <code>a</code> і <code>b</code>. Якщо сума результату більша за довжину відрізка, то нормаль знаходиться за межами відрізка. Чи можете ви написати цей алгоритм за допомогою p5.js?</p>
</div>
<p>Нарешті, мені потрібно знайти найближчу точку нормалі до агента. Для цього можна взяти дуже велике число — “світовий рекорд” — для початкового значення відстані й перебирати кожну точку нормалі, щоб перевірити, чи вона менша за це значення. Кожного разу, коли точка нормалі менша від поточного “світового рекорду”, тоді значення рекорду оновлюється цим новим значенням, а переможна точка зберігається у змінній під назвою <code>target</code>. У кінці циклу змінна <code>target</code> буде містити найближчу точку нормалі.</p>
<div data-type="example">
  <h3 id="example-58-path-following"><a class="heading-link" href="#example-58-path-following">Приклад 5.8: Слідування шляхом</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_08_path_following"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/1T-6LupvJ" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> target = <span class="hljs-literal">null</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> worldRecord = <span class="hljs-title class_">Infinity</span>;
</code></pre><div class="comment"><p>Почнемо з дуже високого значення, наприклад, нескінченності!</p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; path.<span class="hljs-property">points</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> a = path.<span class="hljs-property">points</span>[i];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> b = path.<span class="hljs-property">points</span>[i + <span class="hljs-number">1</span>];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> normalPoint = <span class="hljs-title function_">getNormalPoint</span>(future, a, b);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">if</span> (normalPoint.<span class="hljs-property">x</span> &lt; a.<span class="hljs-property">x</span> || normalPoint.<span class="hljs-property">x</span> &gt; b.<span class="hljs-property">x</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    normalPoint = b.<span class="hljs-title function_">copy</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> distance = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(future, normalPoint);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">if</span> (distance &lt; worldRecord) {
    worldRecord = distance;
    target = normalPoint.<span class="hljs-title function_">copy</span>();
  }
</code></pre><div class="comment"><p>Якщо ми побили рекорд, тоді нашою ціллю має стати відповідна нормаль.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> dir = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(b, a);
  dir.<span class="hljs-title function_">setMag</span>(<span class="hljs-number">25</span>);
  target.<span class="hljs-title function_">add</span>(dir);
</code></pre><div class="comment"><p>Подивимося на напрямок відрізка для пошуку трохи попереду нормалі.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Можливо, ви помітили використання <code>Infinity</code> для ініціалізації змінної <code>worldRecord</code>. У JavaScript <code>Infinity</code> є спеціальним числовим значенням, яке представляє нескінченність. У цьому випадку воно підходить, оскільки мені потрібне початкове значення, яке завжди буде вищим за будь-яку правдоподібну відстань, обчислену в коді. Перша ж обчислена відстань з нашою перевіркою завжди замінить нескінченність і запише нове значення з яким порівнюватимуться всі інші.</p>
<p>Я також хочу підсвітити жорстко закодоване значення <code>25</code>, яке встановлює відстань попереду нормалі для цільової точки. Рейнольдс вказує, що це значення має бути динамічним і розраховуватися на основі відстані об’єкта до шляху та його швидкості. Спробуйте і подивіться, як це покращує точність або чутливість поведінки слідування шляхом!</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-511"><a class="heading-link" href="#exercise-511">Вправа 5.11</a></h3>
  <p>Створіть шлях, який змінюється з часом. Чи можуть точки, які визначають шлях, мати власну керувальну поведінку?</p>
</div>
<h2 id="complex-systems"><a class="heading-link" href="#complex-systems">Складні системи</a></h2>
<p>Я сказав, що метою цього розділу було вдихнути життя в об’єкти, які рухаються на полотн і p5.js. Ви пройшли довгий шлях, навчившись писати код для автономного агента і погравшись із прикладами його індивідуальної поведінки. Але це ще не місце для зупинки. Так, наш рухомий агент — це симульована істота, яка приймає рішення про те, як шукати, рухатися і слідувати. Але що то за життя, проведене в самотності, без любові й підтримки інших?</p>
<p>Тому як логічний наступний крок я візьму роботу, яку я зробив при розробці попередніх поведінок для окремих автономних агентів, і застосую її до симуляцій, які включатимуть <em>багато</em> автономних агентів, що працюють паралельно — агентів, які мають здатність сприймати не лише своє фізичне середовище, але й дії своїх товаришів-агентів та діяти відповідним чином. Іншими словами, я хочу створювати складні системи.</p>
<p><strong>Складна система</strong>, як правило, являється системою, яка є чимось більшим ніж сума її складових частин. Хоча окремі елементи системи можуть бути неймовірно простими й легко зрозумілими, поведінка системи в цілому може бути дуже складною, інтелектуальною та важко передбачуваною.</p>
<p>Подумайте, наприклад, про крихітну мураху — одну єдину мурашку. Мураха є автономним агентом, вона може сприймати своє оточення (використовуючи вусики для збору інформації про напрям і силу хімічних сигналів) та приймати рішення про свій рух на основі цих сигналів. Але чи може окрема мурашка, діючи самостійно, побудувати гніздо, зібрати їжу або захистити свою королеву? Мураха — це проста одиниця, яка може сприймати лише своє найближче оточення. Проте <em>колонія</em> мурашок — це витончена, складна система, суперорганізм, у якому компоненти працюють разом для досягнення важких і складних цілей.</p>
<p>Ось три ключові принципи, якими я буду керуватися у своїй роботі зі складними системами:</p>
<ul>
  <li><strong>Прості одиниці мають взаємодію обмеженого діапазону.</strong> Це те, що я весь час створював: агенти, які мають обмежене сприйняття свого середовища.</li>
  <li><strong>Прості одиниці працюють паралельно.</strong> Для кожного кадру анімації, кожна одиниця розраховує свою власну керувальну силу. Це створить враження, що всі одиниці працюють паралельно.</li>
  <li><strong>Системи в цілому проявляють емерджентні явища.</strong> Складна поведінка, певні шаблони й прояви розумності можуть виникати у результаті взаємодії між простими одиницями. Це явище спостерігається в природі, наприклад, у мурашиних колоніях, мурмураціях, землетрусах і сніжинках. Питання полягає в тому, чи можна досягти тих самих результатів у програмі p5.js.</li>
</ul>
<p>Крім цих основних принципів, ось ще три додаткові якості складних систем, які допоможуть сформулювати обговорення, а також нададуть вказівки щодо функцій, які слід включити у програму симуляції. Важливо визнати, що це нечіткий набір характеристик, і не кожна складна система матиме їх усі:</p>
<ul>
  <li>
    <strong>Нелінійність:</strong> цей аспект складних систем часто називають <em>ефектом метелика</em> — виразом придуманим математиком і метеорологом Едвардом Нортоном Лоренцом, піонером у дослідженні теорії хаосу. У 1961 році Лоренц вдруге запустив комп’ютерну симуляцію погоди й, можливо, щоб заощадити трохи часу, ввів вхідне початкове значення 0.506 замість 0.506127. Кінцевий результат повністю відрізнявся від результату першої симуляції.
    Говорячи більш виразно, теорія полягає в тому, що змах крила метелика на одному кінці світу, може спричинити значущі погодні зміни на іншому та зіпсувати ваш і вихідні на пляжі. Його називають <em>нелінійним</em>, оскільки між зміною початкових умов і зміною результату немає лінійного відношення. Невелика зміна початкових умов може мати величезний вплив на результат. Нелінійні системи є надмножиною хаотичних систем. У <a href="/cellular-automata#section-cellular-automata">Розділі 7</a> ви побачите, що навіть якщо у системі з багатьох нулів і одиниць ви зміните лише один біт, результат буде зовсім іншим.
  </li>
  <li><strong>Конкуренція і співпраця:</strong> одним з інгредієнтів, який часто робить складну систему працездатною, є одночасна наявність конкуренції та співпраці між її елементами. У майбутній системі зграї буде три правила: вирівнювання, згуртованість і відокремлення. Вирівнювання і згуртованість вимагатимуть від елементів “співпраці”, щоб вони намагалися залишатися разом та рухатися разом. Однак правило відокремлення вимагатиме від елементів “конкурувати” за простір. Коли прийде час, спробуйте у симуляції відмовитися від співпраці чи конкуренції й ви побачите, як система втратить свою складність. Конкуренція і співпраця зустрічаються разом у живих складних системах, на відміну від неживих складних систем, таких як погода.</li>
  <li>
    <strong>Зворотний зв’язок:</strong> складні системи часто включають певний цикл, де вихідні дані системи повертаються у систему, щоб впливати на її поведінку в позитивному або негативному напрямку. Припустимо, ви вирішили їздити на роботу громадським транспортом щодня, оскільки це найнадійніше та найвигідніше рішення і ви невдоволені заторами та впливом автомобілів на навколишнє середовище. Ви не самотні: інші також переходять на громадський транспорт. Система стає більш ефективною і привабливою, обслуговуючи більше людей за ті ж ресурси, а тим часом рух автотранспорту зменшується.
    Однак з часом системі може бути важко задовольнити зростання попиту, що призведе до перевантаженості, затримок і підвищення тарифів для фінансування інфраструктурних поліпшень. У результаті ви й інші починаєте повертатися на автівки, збільшуючи транспортні затори та знову знижуючи ефективність громадського транспорту. З погіршенням трафіку, кошти від підвищення тарифів використовуються для покращення інфраструктури громадського транспорту (сподіваємось), що знову робить його привабливішим.
    Таким чином, вартість і ефективність громадського транспорту є одночасно вхідними даними системи (що визначають, чи вирішите ви ним користуватися, чи ні) і вихідними (ступінь завантаженості транспорту і подальші витрати та ефективність). Економічні моделі є лише одним із прикладів людської складної системи. Інші включають моду і тенденції, вибори, натовпи та транспортні потоки.
  </li>
</ul>
<p>Складність слугуватиме ключовою темою для більшої частини решти книги. У цьому розділі я розпочну із введення додаткової функціональності класу <code>Vehicle</code>: здатності сприймати сусідні об’єкти. Це покращення прокладе шлях до кульмінаційного прикладу складної системи, де взаємодія простих індивідуальних поведінок призводить до появи емерджентної поведінки: руху у зграї.</p>
<h3 id="implementing-group-behaviors-or-lets-not-run-into-each-other"><a class="heading-link" href="#implementing-group-behaviors-or-lets-not-run-into-each-other">Імплементація групової поведінки (або давайте не будемо врізатися один в одного)</a></h3>
<p>Управління групою об’єктів, звичайно, не нова концепція. Ви вже бачили це раніше — у <a href="/particles#section-particles">Розділі 4</a>, де я розробив клас <code>Emitter</code> для представлення загальної системи частинок. Там я використовував масив для збереження списку окремих частинок. Я почну з того з підходу тут і зберігатиму об’єкти <code>Vehicle</code> в масиві:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> vehicles;
</code></pre><div class="comment"><p>Оголошення масиву об’єктів Vehicle.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  vehicles = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    vehicles.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle</span>(<span class="hljs-title function_">random</span>(width), <span class="hljs-title function_">random</span>(height)));
</code></pre><div class="comment"><p>Ініціалізація і заповнення масиву
купою агентів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер, коли настав час маніпулювати всіма агентами у функції <code>draw()</code>, я можу перебирати масив і викликати необхідні методи:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> vehicle <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">update</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">show</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Можливо, варто додати якусь поведінку, силу для застосування до всіх агентів. Це може бути слідування за курсором:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">seek</span>(mouseX, mouseY);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Але це <em>індивідуальна</em> поведінка і я вже провів більшу частину цього розділу у клопотах стосовно індивідуальних поведінок. Ви ж тут, тому що хочете застосувати <em>групову</em> поведінку. Я почну із поведінки <em>відокремлення</em>, яка наказує: “Уникайте зіткнень зі своїми сусідами!”</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">separate</span>();
</code></pre><div class="comment"><p></p></div></div></div>
<p>Це виглядає добре, але не зовсім правильно. Чогось не вистачає? У випадку з методом <code>seek()</code>, я ка зав: “Шукайте <code>mouseX</code> і <code>mouseY</code>”. У випадку з методом <code>separate()</code>, я кажу: “Відокремтеся від <em>усіх інших</em>”. Хто такі усі інші? Це список усіх інших агентів або об’єктів:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">separate</span>(vehicles);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Це великий стрибок за рамки того, що ви бачили раніше із системами частинок. Замість того, щоб кожний елемент (частинка або об’єкт) працював сам по собі, я зараз кажу: “Агов, ти, такий-то агент отам! Коли настане час твоєї роботи, тобі потрібно діяти з урахуванням усіх інших об’єктів. Тому я передаю тобі список усіх інших”.</p>
<div class="avoid-break">
  <p>Збираючи докупи, все що я зробив до цього моменту, ось приклад функцій <code>setup()</code> і <code>draw()</code> для програми, яка демонструє групову поведінку:</p>
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> vehicles;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  vehicles = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    vehicles.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle</span>(<span class="hljs-title function_">random</span>(width), <span class="hljs-title function_">random</span>(height)));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> vehicle <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">separate</span>(vehicles);
</code></pre><div class="comment"><p>Це насправді єдина нова річ, яку ми робимо в цій частині розділу.
Ми просимо об’єкт Vehicle оглянути всі інші об’єкти під час обчислення
сили відокремлення.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">update</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    vehicle.<span class="hljs-title function_">show</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<div class="half-width-right">
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1152px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;117&#x27; width=&#x27;1152&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/5a1907dd8ede29260f348eec4c99145c/c91c1/05_steering_34.webp 288w,./static/5a1907dd8ede29260f348eec4c99145c/5a9cd/05_steering_34.webp 576w,./static/5a1907dd8ede29260f348eec4c99145c/49908/05_steering_34.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" data-src="./static/5a1907dd8ede29260f348eec4c99145c/c9c2d/05_steering_34.png" data-srcset="./static/5a1907dd8ede29260f348eec4c99145c/185e7/05_steering_34.png 288w,./static/5a1907dd8ede29260f348eec4c99145c/f088b/05_steering_34.png 576w,./static/5a1907dd8ede29260f348eec4c99145c/c9c2d/05_steering_34.png 1152w" alt="Малюнок 5.32: Бажана швидкість для відокремлення (еквівалент втечі) є вектором, який вказує в протилежному напрямку від цілі"/></picture><noscript><picture><source type="image/webp" srcSet="./static/5a1907dd8ede29260f348eec4c99145c/c91c1/05_steering_34.webp 288w,./static/5a1907dd8ede29260f348eec4c99145c/5a9cd/05_steering_34.webp 576w,./static/5a1907dd8ede29260f348eec4c99145c/49908/05_steering_34.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" src="./static/5a1907dd8ede29260f348eec4c99145c/c9c2d/05_steering_34.png" srcSet="./static/5a1907dd8ede29260f348eec4c99145c/185e7/05_steering_34.png 288w,./static/5a1907dd8ede29260f348eec4c99145c/f088b/05_steering_34.png 576w,./static/5a1907dd8ede29260f348eec4c99145c/c9c2d/05_steering_34.png 1152w" alt="Малюнок 5.32: Бажана швидкість для відокремлення (еквівалент втечі) є вектором, який вказує в протилежному напрямку від цілі"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption>Малюнок 5.32: Бажана швидкість для відокремлення (еквівалент втечі) є вектором, який вказує в протилежному напрямку від цілі</figcaption>
  </figure>
</div>
<p>Звісно, це тільки початок. Справжня робота відбувається всередині самого методу <code>separate()</code>. Рейнольдс визначає поведінку відокремлення як “Керування для уникнення скупчення”. Іншими словами, якщо певний об’єкт занадто близько до вас, відхиляйтеся від нього. Звучить знайомо? Пам’ятаєте поведінку пошуку, коли агент спрямовується до цілі? Змініть цю силу на протилежну й отримаєте поведінку втечі, яку слід застосувати тут, щоб досягти відокремлення (див. малюнок 5.32).</p>
<div class="half-width-right">
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1152px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;587&#x27; width=&#x27;1152&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/279fd810aa62a6fc7eff0df9662628f9/8047a/05_steering_35.webp 288w,./static/279fd810aa62a6fc7eff0df9662628f9/58005/05_steering_35.webp 576w,./static/279fd810aa62a6fc7eff0df9662628f9/707d5/05_steering_35.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" data-src="./static/279fd810aa62a6fc7eff0df9662628f9/4800b/05_steering_35.png" data-srcset="./static/279fd810aa62a6fc7eff0df9662628f9/272c8/05_steering_35.png 288w,./static/279fd810aa62a6fc7eff0df9662628f9/024cd/05_steering_35.png 576w,./static/279fd810aa62a6fc7eff0df9662628f9/4800b/05_steering_35.png 1152w" alt="Малюнок 5.33: Бажана швидкість відхилення є середнім значенням усіх швидкостей бажаних уникнень"/></picture><noscript><picture><source type="image/webp" srcSet="./static/279fd810aa62a6fc7eff0df9662628f9/8047a/05_steering_35.webp 288w,./static/279fd810aa62a6fc7eff0df9662628f9/58005/05_steering_35.webp 576w,./static/279fd810aa62a6fc7eff0df9662628f9/707d5/05_steering_35.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" src="./static/279fd810aa62a6fc7eff0df9662628f9/4800b/05_steering_35.png" srcSet="./static/279fd810aa62a6fc7eff0df9662628f9/272c8/05_steering_35.png 288w,./static/279fd810aa62a6fc7eff0df9662628f9/024cd/05_steering_35.png 576w,./static/279fd810aa62a6fc7eff0df9662628f9/4800b/05_steering_35.png 1152w" alt="Ма люнок 5.33: Бажана швидкість відхилення є середнім значенням усіх швидкостей бажаних уникнень"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption>Малюнок 5.33: Бажана швидкість відхилення є середнім значенням усіх швидкостей бажаних уникнень</figcaption>
  </figure>
</div>
<p>Але що, якщо занадто близько знаходиться більше одного об’єкта? У цьому випадку я визначу відокремлення як середнє значення всіх векторів, спрямованих від будь-яких близьких об’єктів (малюнок 5.33).</p>
<p>Як перетворити це на код? Повернемося до методу під назвою <code>separate()</code>, який приймає як аргумент масив об’єктів типу <code>Vehicle</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-title function_">separate</span>(<span class="hljs-params">vehicles</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>У цьому методі я переберу всі передані об’єкти та перевірю, чи є серед них такі, що розташовані занадто близько:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> desiredSeparation = <span class="hljs-number">20</span>;
</code></pre><div class="comment"><p>Ця змінна вказує бажану мінімальну дистанцію між елементами.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> other <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="offset pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> d = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p>Розрахунок відстані між поточним елементом та іншим елементом.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> !== other &amp;&amp; d &lt; desiredSeparation) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p>Виконання будь-якого коду, коли якийсь елемент знаход иться в межах 20 пікселів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Зверніть увагу, що я перевіряю не лише чи відстань менша за бажану, але і що <code>this</code> не дорівнює <code>other</code>. Це ключовий момент. Пам’ятайте, що у масиві знаходяться всі об’єкти, тож без цієї додаткової перевірки агент спробує втекти й сам від себе!</p>
<p>Якщо об’єкти знаходяться надто близько, я обчислюю вектор, що спрямований від об’єкта, який порушує правило відстані:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> !== other &amp;&amp; d &lt; desiredseparation) {
</code></pre><div class="comment"><p></p></div></div><div class="offset pair split"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> diff = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
      diff.<span class="hljs-title function_">normalize</span>();
</code></pre><div class="comment"><p>Вектор, спрямований убік від позиції іншого об’єкта.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div></div>
<div class="avoid-break">
  <p>Цього недостатньо. Зараз у мене є вектор ухилення, але мені насправді потрібно середнє значення векторів ухилення для всіх об’єктів, які знаходяться занадто близько. Як обчислити середнє значення? Додайте усі вектори та поділіть отриману суму на їх кількість:</p>
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="bold pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p>Почнемо з пустого вектора.</p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p>Лічильник для відстеження кількості елементів, які знаходяться надто близько.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> other <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> d = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> !== other &amp;&amp; d &lt; desiredseparation) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> diff = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      diff.<span class="hljs-title function_">normalize</span>();
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">      sum.<span class="hljs-title function_">add</span>(diff);
      count++;
</code></pre><div class="comment"><p>Додаємо вектори разом і збільшуємо лічильник.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) {
</code></pre><div class="comment"><p>Потрібно переконатися, що поруч є принаймні один
занадто наближений об’єкт. Нам нічого не потрібно робити,
якщо поруч нічого немає, не кажучи вже про те, що
не можна ділити на нуль!</p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">    sum.<span class="hljs-title function_">div</span>(count);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Отриманий середній вектор (збережений у змінній <code>sum</code>), можна масштабувати до максимальної швидкості та зробити бажаною швидкістю — агент <em>бажає</em> рухатися в цьому напрямку з максимальною швидкістю! (Насправді мені більше не потрібно ділити на <code>count</code>, оскільки магнітуду задано вручну.) І як тільки у мене буде бажана швидкість, матимемо ту саму стару історію Рейнольдса — <code>steering = desired - velocity</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    sum.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p>Масштабування середнього значення на максимальну швидкість
(стає бажаною швидкістю).</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(sum, vel);
</code></pre><div class="comment"><p>Формула керування Рейнольдса.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
</code></pre><div class="comment"><p>Застосування сили до об’єкта.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>У наступному прикладі цей метод показано у повному обсязі.</p>
<div data-type="example">
  <h3 id="example-59-separation"><a class="heading-link" href="#example-59-separation">Приклад 5.9: Відокремлення</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_07_separation"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/S7YOOYs7T" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">separate</span>(<span class="hljs-params">vehicles</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desiredSeparation = <span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span> * <span class="hljs-number">2</span>;
</code></pre><div class="comment"><p>Зверніть увагу, як відстань бажаного відокремлення
залежить від розміру об’єкта.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> other <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> d = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> !== other &amp;&amp; d &lt; desiredSeparation) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">        <span class="hljs-keyword">let</span> diff = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">        diff.<span class="hljs-title function_">setMag</span>(<span class="hljs-number">1</span> / d);
</code></pre><div class="comment"><p>Яка магнітуда p5.Vector,
спрямованого від іншого об’єкта?
Чим вона менше, тим сильніше об’єкт має тікати.
Чим вона більше, тим слабше відхилення. Отже, магнітуда встановлюється
обернено пропорційною до відстані.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">        sum.<span class="hljs-title function_">add</span>(diff);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">        count++;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      sum.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(sum, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Метод <code>separate()</code> включає два додаткових покращення. По-перше, бажане відокремлення тепер залежить від розміру об’єкта, на відміну від довільної константи. Таким чином, поведінка відокремлення динамічно адаптується до індивідуальних характеристик об’єктів. По-друге, величина вектора, спрямованого від сусіднього об’єкта, встановлюється обернено пропорційно до відстані. Це означає, що чим ближче сусід, тим сильніше об’єкт прагне втекти, і навпаки.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-512"><a class="heading-link" href="#exercise-512">Вправа 5.12</a></h3>
  <p>Створіть метод <code>cohere()</code>, який слідує протилежній логіці відносно методу <code>separate()</code>: якщо об’єкт знаходиться за межами певної відстані, направляйтесь до нього. Це дозволить утримати групу разом. (Зовсім скоро я розгляну, що відбувається, коли в одній симуляції одночасно діють згуртованість і відокремлення.)</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-513"><a class="heading-link" href="#exercise-513">Вправа 5.13</a></h3>
  <p>До прикладу слідування шляхом додайте силу відокремлення, щоб створити симуляцію Рейнольдса слідування шляхом натовпу.</p>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/exercise_5_13_crowd_path_following"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/3KSPCN0x-z" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<h3 id="combining-behaviors"><a class="heading-link" href="#combining-behaviors">Поєднання поведінок</a></h3>
<p>Найцікавіші й захопливі групові поведінки виникають у результаті змішування та поєднання кількох керувальних сил. Зрештою, як я можу навіть почати моделювання емерджентності у програмі зі складною системою, яка матиме лише одне правило?</p>
<p>Коли у програмі залучено кілька керувальних сил, потрібен механізм для їх управління. Ви можете подумати: “Тут нічого нового. Ми весь час жонглюємо кількома силами”. І матимете рацію. Фактично, цей підхід з’явився ще у <a href="/forces#section-forces">Розділі 2</a>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> wind = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0.001</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> gravity = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  mover.<span class="hljs-title function_">applyForce</span>(wind);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  mover.<span class="hljs-title function_">applyForce</span>(gravity);
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тут є об’єкт типу <code>Mover</code>, який реагує на дві сили. Все це добре працює завдяки тому, що клас <code>Mover</code> був розроблений для акумулювання векторних сил у його вектор прискорення. Однак у цьому розділі сили випливають із внутрішніх бажань рухомих об’єктів (які тепер називаються <em>vehicles</em>). І ці бажання можуть мати вагу, щоб одні з них мали більший вплив, ніж інші. Наприклад, розглянемо програму, де всі агенти мають два бажання:</p>
<ul>
  <li>Пошук позиції курсора.</li>
  <li>Відокремлення від об’єктів, які знаходяться занадто близько.</li>
</ul>
<p>Уявіть, що рухомі агенти представляють зграю риб. Хоча вони хочуть уникнути зіткнень один з одним, їхня головна турбота полягає в пошуку джерела їжі (курсор). Можливість налаштувати вагу двох керувальних сил має вирішальне значення для досягнення цього ефекту.</p>
<p>Для початку я додам метод з назвою <code>applyBehaviors()</code> до класу <code>Vehicle</code> для управління всіма поведінками:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-title function_">applyBehaviors</span>(<span class="hljs-params">vehicles</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">separate</span>(vehicles);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">seek</span>(<span class="hljs-title function_">createVector</span>(mouseX, mouseY));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тут один метод відповідає за виклик інших методів, які застосовують сили — <code>separate()</code> і <code>seek()</code>. Я міг би почати порпатися всередині цих методів, щоб налаштувати вагу сили, яку вони обчислюють, але простіше було б попросити ці методи просто обчислити й повернути обраховану силу. Тоді я зможу налаштувати величину сил і застосувати їх до прискорення об’єкта в межах методу <code>applyBehaviors()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">applyBehaviors</span>(<span class="hljs-params">vehicles</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> separate = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">separate</span>(vehicles);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> seek = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">seek</span>(<span class="hljs-title function_">createVector</span>(mouseX, mouseY));
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(separate);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(seek);
</code></pre><div class="comment"><p>Застосовуємо сили тут, оскільки методі seek() і separate() більше цього не роблять.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Ось як цей новий підхід змінює метод <code>seek()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">seek</span>(<span class="hljs-params">target</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    desired.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="line-through pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(steer);
</code></pre><div class="comment"><p>Прибираємо цей рядок.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">return</span> steer;
</code></pre><div class="comment"><p>Замість застосування сили, просто повертаємо її.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Це незначна зміна, але надзвичайно важлива: вона дозволяє налаштувати величину цих сил в одному місці.</p>
<div data-type="example">
  <h3 id="example-510-combining-steering-behaviors-seek-and-separate"><a class="heading-link" href="#example-510-combining-steering-behaviors-seek-and-separate">Приклад 5.10: Поєднання керувальних поведінок (пошук і відокремлення)</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/noc_5_08_separation_and_seek"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/UJEwENSN3" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-title function_">applyBehaviors</span>(<span class="hljs-params">vehicles</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> separate = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">separate</span>(vehicles);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> seek = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">seek</span>(<span class="hljs-title function_">createVector</span>(mouseX, mouseY));
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">  separate.<span class="hljs-title function_">mult</span>(<span class="hljs-number">1.5</span>);
  seek.<span class="hljs-title function_">mult</span>(<span class="hljs-number">0.5</span>);
</code></pre><div class="comment"><p>Ці значення можуть бути будь-якими, які ви тільки захочете!
Це можуть бути змінні, налаштовані для кожного агента,
або вони можуть змінюватися з часом.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(separate);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(seek);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>У цьому коді для налаштування сил я використовую функцію <code>mult()</code>. Помноживши кожен вектор сили на певний коефіцієнт, ми відповідним чином масштабуємо його величину. Ці коефіцієнти (у цьому випадку 1.5 для <code>separate</code> і 0.5 для <code>seek</code>) представляють вагу, призначену кожній силі. Однак вага не повинна бути завжди постійною. Подумайте про те, як вона може змінюватися динамічно в залежності від умов середовища або властивостей агента. Наприклад, вага <code>seek</code> може збільшуватися, коли агент виявляє поблизу їжу (уявіть агент з властивістю голоду) або вага <code>separate</code> стає більшою, якщо агент потрапляє у переповнену область. Ця гнучкість у налаштуванні ваги дозволяє проявляти складніші й різноманітніші поведінки.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-514"><a class="heading-link" href="#exercise-514">Вправа 5.14</a></h3>
  <p>Змініть приклад 5.10 так, щоб ваги поведінки змінювалися з часом. Наприклад, щоб ваги обчислювалися відповідно до синусоїди або шуму Перліна. Або, щоб одні об’єкти були більш стурбованими пошуком, а інші — відокремленням. Чи можете ви додати інші керувальні поведінки?</p>
</div>
<h3 id="flocking"><a class="heading-link" href="#flocking">Флокування</a></h3>
<p><strong>Флокування (флокінг)</strong> або поведінка зграї — це групова поведінка тварин, характерна для багатьох живих істот, таких як птахи, риби й комахи. У 1986 році Рейнольдс створив комп’ютерну симуляцію поведінки зграї й задокументував алгоритм у своїй статті “Flocks, Herds, and Schools: A Distributed Behavioral Model”. Відтворення цієї симуляції в p5.js дозволить об’єднати всі концепції цього розділу:</p>
<ol>
  <li>Для реалізації правил флокування, я буду використовувати формулу керівної сили (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>e</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>=</mo><mi>d</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>d</mi><mo>−</mo><mi>v</mi><mi>e</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">steering = desired - velocity</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em">eer</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">es</span><span class="mord mathnormal">i</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">oc</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>).</li>
  <li>Ці керувальні сили будуть груповою поведінкою і вимагатимуть, щоб кожен агент сприймав усі інші об’єкти.</li>
  <li>Я поєднаю і надам вагу декільком силам.</li>
  <li>Результатом буде складна система — розумна групова поведінка виникне з простих правил флокування без наявності централізованої системи чи лідера.</li>
</ol>
<p>Хороша новина полягає в тому, що я у цьому розділі вже продемонстрував усі три пункти, тому ця секція буде присвячена об’єднанню всього цього разом і перегляду результату.</p>
<p>Перш ніж почати, я повинен зауважити, що збираюся змінити назву класу <code>Vehicle</code> (знову). Щоб описат и елементи системи зграї Рейнольдс використовує термін <em>boid</em> (боід або боїд — вигадане слово, що означає птахоподібний об’єкт). Я зроблю так само.</p>
<p>Є три правила, які регулюють зграю:</p>
<ul>
  <li><strong>Відокремлення</strong> (також відоме як уникнення або розділення): направлений рух для уникнення зіткнення з сусідами.</li>
  <li><strong>Вирівнювання</strong> (також відоме як копіювання або узгодженість): направлений рух у тому ж напрямку, що й у сусідів.</li>
  <li><strong>Когезія</strong> (також відоме як центрування або згуртованість): направлений рух у сторону центральної області своїх сусідів для того, щоб залишатися з групою.</li>
</ul>
<p>Ці правила проілюстровано на малюнку 5.34.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2305px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;681&#x27; width=&#x27;2305&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/8ae3ebaa63c1251f94d0c761e3979ada/c2585/05_steering_36.webp 576w,./static/8ae3ebaa63c1251f94d0c761e3979ada/dff2a/05_steering_36.webp 1153w,./static/8ae3ebaa63c1251f94d0c761e3979ada/e1a67/05_steering_36.webp 2305w" sizes="(min-width: 2305px) 2305px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2305px) 2305px, 100vw" decoding="async" loading="lazy" data-src="./static/8ae3ebaa63c1251f94d0c761e3979ada/f193e/05_steering_36.png" data-srcset="./static/8ae3ebaa63c1251f94d0c761e3979ada/a552e/05_steering_36.png 576w,./static/8ae3ebaa63c1251f94d0c761e3979ada/d5ee2/05_steering_36.png 1153w,./static/8ae3ebaa63c1251f94d0c761e3979ada/f193e/05_steering_36.png 2305w" alt="Малюнок 5.34: Три правила флокінгу: відокремлення, вирівнювання і згуртованість. Приклад агента і бажана швидкість виділені жирним шрифтом"/></picture><noscript><picture><source type="image/webp" srcSet="./static/8ae3ebaa63c1251f94d0c761e3979ada/c2585/05_steering_36.webp 576w,./static/8ae3ebaa63c1251f94d0c761e3979ada/dff2a/05_steering_36.webp 1153w,./static/8ae3ebaa63c1251f94d0c761e3979ada/e1a67/05_steering_36.webp 2305w" sizes="(min-width: 2305px) 2305px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2305px) 2305px, 100vw" decoding="async" loading="lazy" src="./static/8ae3ebaa63c1251f94d0c761e3979ada/f193e/05_steering_36.png" srcSet="./static/8ae3ebaa63c1251f94d0c761e3979ada/a552e/05_steering_36.png 576w,./static/8ae3ebaa63c1251f94d0c761e3979ada/d5ee2/05_steering_36.png 1153w,./static/8ae3ebaa63c1251f94d0c761e3979ada/f193e/05_steering_36.png 2305w" alt="Малюнок 5.34: Три правила флокінгу: відокремлення, вирівнювання і згуртованість. Приклад агента і бажана швидкість виділені жирним шрифтом"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.34: Три правила флокінгу: відокремлення, вирівнювання і згуртованість. Приклад агента і бажана швидкість виділені темнішим кольором</figcaption>
</figure>
<p>Так само як у прикладі 5.8, де я поєднав відокремлення і пошук, я хочу, щоб клас <code>Boid</code> мав єдиний метод керування всіма трьома поведінками. Я назву його <code>flock()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">flock</span>(<span class="hljs-params">boids</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> separation = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">separate</span>(boids);
    <span class="hljs-keyword">let</span> alignment = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">align</span>(boids);
    <span class="hljs-keyword">let</span> cohesion = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cohere</span>(boids);
</code></pre><div class="comment"><p>Три правила зграї.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    separation.<span class="hljs-title function_">mult</span>(<span class="hljs-number">1.5</span>);
    alignment.<span class="hljs-title function_">mult</span>(<span class="hljs-number">1.0</span>);
    cohesion.<span class="hljs-title function_">mult</span>(<span class="hljs-number">1.0</span>);
</code></pre><div class="comment"><p>Довільні ваги для відповідних сил (спробуйте інші).</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(separation);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(alignment);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyForce</span>(cohesion);
</code></pre><div class="comment"><p>Застосування всіх сил.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер залишається лише реалізувати три правила. Я вже застосовував відокремлення, воно буде ідентичне попередньому прикладу. Замість цього я зосереджуся на вирівнюванні або спрямуванні у тому ж напрямку, що й сусідні боїди. Як і з усіма іншими способами керування, мені потрібно звести цю концепцію до бажання: бажана швидкість боїда є середньою швидкістю його сусідів. Отже, алгоритм полягає в обчисленні середньої швидкості всіх інших боїдів і встановленні бажаної швидкості:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">align</span>(<span class="hljs-params">boids</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> other <span class="hljs-keyword">of</span> boids) {
      sum.<span class="hljs-title function_">add</span>(other.<span class="hljs-property">velocity</span>);
    }
    sum.<span class="hljs-title function_">div</span>(boids.<span class="hljs-property">length</span>);
</code></pre><div class="comment"><p>Додамо усі швидкості та розділімо результат на їх кількість,
щоб обчислити середню швидкість.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    sum.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p>Боїд бажає рухатися у визначеному напрямку з максимальною швидкістю.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(sum, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
    <span class="hljs-keyword">return</span> steer;
</code></pre><div class="comment"><p>Формула керувальної сили  Рейнольдса.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Досить добре, але не вистачає однієї дуже важливої деталі. Одним із ключових принципів складних систем, таких як флокування, є те, що елементи (у цьому випадку боїди) мають зв’язки у межах <em>обмеженого діапазону</em>. Знову згадуючи про мурах, досить легко уявити мурашку здатну відчувати своє безпосереднє оточення, але складніше уявити мураху, яка усвідомлює, що робить інша мураха за десятки метрів від неї. Насправді той факт, що мурахи здатні демонструвати таку складну колективну поведінку лише через ці сусідні відносини, в першу чергу і робить їх настільки захопливими.</p>
<p>У методі <code>align()</code>, я наразі розраховую середню швидкість <em>усіх</em> боїдів, хоча насправді маю враховувати лише боїди на певній відстані (див. малюнок 5.35). Цей поріг відстані, звісно, може бути змінним. Ви можете розробити боїди, які будуть бачити лише на відстань у 20 пікселів, або на відстань у 100 пікселів.</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2305px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1071&#x27; width=&#x27;2305&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/f79665d223651c5331f14cb26ae0f136/9b8e9/05_steering_37.webp 576w,./static/f79665d223651c5331f14cb26ae0f136/82cfa/05_steering_37.webp 1153w,./static/f79665d223651c5331f14cb26ae0f136/86e97/05_steering_37.webp 2305w" sizes="(min-width: 2305px) 2305px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2305px) 2305px, 100vw" decoding="async" loading="lazy" data-src="./static/f79665d223651c5331f14cb26ae0f136/fcd3c/05_steering_37.png" data-srcset="./static/f79665d223651c5331f14cb26ae0f136/2b454/05_steering_37.png 576w,./static/f79665d223651c5331f14cb26ae0f136/b813d/05_steering_37.png 1153w,./static/f79665d223651c5331f14cb26ae0f136/fcd3c/05_steering_37.png 2305w" alt="Малюнок 5.35: Приклад об’єкта (намальовано темним), який взаємодіє лише з сусідніми об’єктами в межах свого діапазону сприйняття (зображено колом)"/></picture><noscript><picture><source type="image/webp" srcSet="./static/f79665d223651c5331f14cb26ae0f136/9b8e9/05_steering_37.webp 576w,./static/f79665d223651c5331f14cb26ae0f136/82cfa/05_steering_37.webp 1153w,./static/f79665d223651c5331f14cb26ae0f136/86e97/05_steering_37.webp 2305w" sizes="(min-width: 2305px) 2305px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2305px) 2305px, 100vw" decoding="async" loading="lazy" src="./static/f79665d223651c5331f14cb26ae0f136/fcd3c/05_steering_37.png" srcSet="./static/f79665d223651c5331f14cb26ae0f136/2b454/05_steering_37.png 576w,./static/f79665d223651c5331f14cb26ae0f136/b813d/05_steering_37.png 1153w,./static/f79665d223651c5331f14cb26ae0f136/fcd3c/05_steering_37.png 2305w" alt="Малюнок 5.35: Приклад об’єкта (намальовано темним), який взаємодіє лише з сусідніми об’єктами в межах свого діапазону сприйняття (зображено колом)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.35: Приклад боїда (намальовано темним), який взаємодіє лише з сусідніми об’єктами в межах свого діапазону сприйняття (зображено колом)</figcaption>
</figure>
<p>Я вже застосовував подібну логіку, коли впроваджував відокремлення, обчислюючи силу лише на основі інших об’єктів на певній відстані. Тепер я хочу зробити те саме для вирівнювання (і, зрештою, згуртованості):</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">align</span>(<span class="hljs-params">boids</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> neighborDistance = <span class="hljs-number">50</span>;
</code></pre><div class="comment"><p>Це довільне значення і може відрізнятися від боїда до боїда.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> other <span class="hljs-keyword">of</span> boids) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> d = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">if</span> ((<span class="hljs-variable language_">this</span> !== other) &amp;&amp; (d &lt; neighborDistance)) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">        sum.<span class="hljs-title function_">add</span>(other.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">        count++;
</code></pre><div class="comment"><p>Для розрахунку середнього значення ведеться облік
кількості боїдів у межах відстежуваного осередку.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      sum.<span class="hljs-title function_">setMag</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(sum, <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">return</span> steer;
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    }
</code></pre><div class="comment"><p>Якщо близьких боїдів не знайдено, керувальна сила дорівнюватиме нулю.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Як і у методі <code>separate()</code>, я додав умову <code>this !== other</code>, яка гарантує, що боїд не враховуватиме сам себе під час обчислення середньої швидкості. Ймовірно, це все одно працювало б, але постійне впливання кожного боїда на його власну швидкість може призвести до зворотного зв’язку, який порушить загальну поведінку.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-515"><a class="heading-link" href="#exercise-515">Вправа 5.15</a></h3>
  <div class="half-width-right">
    <figure>
      <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1152px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;671&#x27; width=&#x27;1152&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/95db25d5d35a652cdd7212e0365bd8a4/3136c/05_steering_38.webp 288w,./static/95db25d5d35a652cdd7212e0365bd8a4/38f8b/05_steering_38.webp 576w,./static/95db25d5d35a652cdd7212e0365bd8a4/0b8c9/05_steering_38.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" data-src="./static/95db25d5d35a652cdd7212e0365bd8a4/81a09/05_steering_38.png" data-srcset="./static/95db25d5d35a652cdd7212e0365bd8a4/fbf51/05_steering_38.png 288w,./static/95db25d5d35a652cdd7212e0365bd8a4/a0bfc/05_steering_38.png 576w,./static/95db25d5d35a652cdd7212e0365bd8a4/81a09/05_steering_38.png 1152w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="./static/95db25d5d35a652cdd7212e0365bd8a4/3136c/05_steering_38.webp 288w,./static/95db25d5d35a652cdd7212e0365bd8a4/38f8b/05_steering_38.webp 576w,./static/95db25d5d35a652cdd7212e0365bd8a4/0b8c9/05_steering_38.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" src="./static/95db25d5d35a652cdd7212e0365bd8a4/81a09/05_steering_38.png" srcSet="./static/95db25d5d35a652cdd7212e0365bd8a4/fbf51/05_steering_38.png 288w,./static/95db25d5d35a652cdd7212e0365bd8a4/a0bfc/05_steering_38.png 576w,./static/95db25d5d35a652cdd7212e0365bd8a4/81a09/05_steering_38.png 1152w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
      <figcaption></figcaption>
    </figure>
  </div>
  <p>Чи можете ви переписати метод <code>align()</code>, щоб боїди бачили лише ті об’єкти, які потрапляють у зону їх прямої видимості?</p>
</div>
<p>Код для згуртованості досить схожий на код для вирівнювання. Єдина відмінність полягає в тому, що замість обчислення середньої <em>швидкості</em> сусідів боїда я хочу обчислити середнє <em>положення</em> сусідніх боїдів (і використовувати його як ціль для пошуку):</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">cohesion</span>(<span class="hljs-params">boids</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> neighborDistance = <span class="hljs-number">50</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> other <span class="hljs-keyword">of</span> boids) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">let</span> d = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">dist</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>, other.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">if</span> ((<span class="hljs-variable language_">this</span> !== other) &amp;&amp; (d &lt; neighborDistance)) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">        sum.<span class="hljs-title function_">add</span>(other.<span class="hljs-property">position</span>);
        count++;
</code></pre><div class="comment"><p>Додавання положень усіх інших боїдів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      sum.<span class="hljs-title function_">div</span>(count);
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">seek</span>(sum);
</code></pre><div class="comment"><p>Використання методу seek(),
написаного в прикладі 5.8.
Ціль, яку ми шукаємо —
це середнє положення сусідів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    } <span class="hljs-keyword">else</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">      <span class="hljs-keyword">return</span> <span class="hljs-title function_">createVector</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Також варто витратити час на написання класу <code>Flock</code>, який управлятиме всією групою боїдів. Він буде практично ідентичним класу <code>ParticleSystem</code> з <a href="/particles#section-particles">Розділу 4</a>, лише з однією невеликою зміною: коли я викликатиму метод <code>run()</code> на кожному об’єкті <code>Boid</code> (як я це робив для кожного об’єкта <code>Particle</code>), я передаватиму посилання на весь масив боїдів:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Flock</span> {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">boids</span> = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> boid <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">boids</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">      boid.<span class="hljs-title function_">run</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">boids</span>);
</code></pre><div class="comment"><p>Кожен боїд повинен знати
про всі інші боїди.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">addBoid</span>(<span class="hljs-params">boid</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">boids</span>.<span class="hljs-title function_">push</span>(boid);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Залишається лише ініціалізувати зграю у функції <code>setup()</code> і запустити її у функції <code>draw()</code>.</p>
<div data-type="example">
  <h3 id="example-511-flocking"><a class="heading-link" href="#example-511-flocking">Приклад 5.11: Флокування</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/example_5_9_flocking"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/IkpBw96Sd" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> flock;
</code></pre><div class="comment"><p>Об’єкт типу Flock управляє
всією групою.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">createCanvas</span>(<span class="hljs-number">640</span>, <span class="hljs-number">240</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  flock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flock</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">120</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> boid = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Boid</span>(width / <span class="hljs-number">2</span>, height / <span class="hljs-number">2</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    flock.<span class="hljs-title function_">addBoid</span>(boid);
</code></pre><div class="comment"><p>Зграя цього прикладу починається зі 120 боїдів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">background</span>(<span class="hljs-number">255</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  flock.<span class="hljs-title function_">run</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Як і у випадку з системами частинок із <a href="/particles#section-particles">Розділу 4</a>, ви можете побачити елегантність ООП в тому, як воно спрощує функції <code>setup()</code> і <code>draw()</code>.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-516"><a class="heading-link" href="#exercise-516">Вправа 5.16</a></h3>
  <p>Поєднайте флокінг з іншими керувальними поведінками.</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-517"><a class="heading-link" href="#exercise-517">Вправа 5.17</a></h3>
  <div class="half-width-right">
    <figure>
      <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:1152px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;807&#x27; width=&#x27;1152&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/81828afa0c2822becfbc7f9fef2c20f4/a4b5f/05_steering_39.webp 288w,./static/81828afa0c2822becfbc7f9fef2c20f4/24a1d/05_steering_39.webp 576w,./static/81828afa0c2822becfbc7f9fef2c20f4/f3fbe/05_steering_39.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" data-src="./static/81828afa0c2822becfbc7f9fef2c20f4/b09af/05_steering_39.png" data-srcset="./static/81828afa0c2822becfbc7f9fef2c20f4/6fdb4/05_steering_39.png 288w,./static/81828afa0c2822becfbc7f9fef2c20f4/e9817/05_steering_39.png 576w,./static/81828afa0c2822becfbc7f9fef2c20f4/b09af/05_steering_39.png 1152w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="./static/81828afa0c2822becfbc7f9fef2c20f4/a4b5f/05_steering_39.webp 288w,./static/81828afa0c2822becfbc7f9fef2c20f4/24a1d/05_steering_39.webp 576w,./static/81828afa0c2822becfbc7f9fef2c20f4/f3fbe/05_steering_39.webp 1152w" sizes="(min-width: 1152px) 1152px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1152px) 1152px, 100vw" decoding="async" loading="lazy" src="./static/81828afa0c2822becfbc7f9fef2c20f4/b09af/05_steering_39.png" srcSet="./static/81828afa0c2822becfbc7f9fef2c20f4/6fdb4/05_steering_39.png 288w,./static/81828afa0c2822becfbc7f9fef2c20f4/e9817/05_steering_39.png 576w,./static/81828afa0c2822becfbc7f9fef2c20f4/b09af/05_steering_39.png 1152w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
      <figcaption></figcaption>
    </figure>
  </div>
  <p>У своїй книзі “<em>Computational Beauty of Nature</em>” (Bradford Books, 2000), Гері Флейк описує четверте правило для <strong>поля зору</strong> зграї: “Відсуньтеся убік від будь-якого боїда, який блокує поле зору”. Нехай ваші боїди дотримуються цього правила.</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-518"><a class="heading-link" href="#exercise-518">Вправа 5.18</a></h3>
  <p>Створіть симуляцію флокінгу, де всі параметри (<em>коефіцієнт відокремлення</em>, <em>коефіцієнт зчеплення</em>, <em>коефіцієнт вирівнювання</em>, <em>максимальна сила</em>, <em>максимальна швидкість</em>) змінюються з часом. Вони можуть керуватись шумом Перліна або взаємодією з користувачем. Наприклад, ви можете використати функцію <code>createSlider()</code> із p5.js, щоб зв’язати бажані значення із положеннями повзунків, які можна змінювати в режимі реального часу.</p>
</div>
<div data-type="exercise" class="callout">
  <h3 id="exercise-519"><a class="heading-link" href="#exercise-519">Вправа 5.19</a></h3>
  <p>Візуалізуйте зграю зовсім інакшим способом.</p>
</div>
<h2 id="algorithmic-efficiency-or-why-does-my-sketch-run-so-slowly"><a class="heading-link" href="#algorithmic-efficiency-or-why-does-my-sketch-run-so-slowly">Ефективність алгоритмів (або чому моя програма працює так повільно?)</a></h2>
<p>Симуляція групових поведінок чудесна річ, але з важким серцем мушу визнати, що вона також може бути повільною. Фактично, чим більша група елементів, тим повільнішою може бути програма. Я б з радістю приховав від вас цю темну сторону правди, тому що хотів би, щоб ви були щасливі й жили сповненим та яскравим життям, вільним від занепокоєння щодо ефективності вашого коду. Але я також хочу спокійно спати вночі, не хвилюючись про ваше неминуче розчарування, коли ви спробуєте запустити свою симу ляцію із занадто великою кількістю боїдів.</p>
<p>Зазвичай, коли я говорю про повільну роботу програм p5.js, то маю на увазі повільне малювання на самому полотні — чим більше елементів малюється, тим повільніше працює програма. Якщо ви пам’ятаєте обговорення з <a href="/particles#section-particles">Розділу 4</a>, то перехід на WebGL рендерер іноді полегшує цю проблему, дозволяючи малювати велику систему частинок швидше. Але у симуляціях подібних до флокінгу, сповільнення походить від самого алгоритму. Комп’ютерні вчені розглядають цю проблему у термінах <strong>великого</strong> <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span></span></span></span></span><strong> (O-нотація)</strong>, де <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span></span></span></span></span> означає <em>порядок</em> (від слова order). Це скорочення для опису ефективності алгоритму, щоб описати відносну кількість обчислювальних циклів потрібних для виконання алгоритму.</p>
<p>Розглянемо просту пошукову задачу. У вас є кошик, що містить 100 шоколадних ласощів і лише одна із них з чистого чорного шоколаду. Саме та, яку ви хочете з’їсти. Щоб знайти її, ви дістаєте солодощі із кошика по одній штуці. Можливо, вам пощастить і ви знайдете її з першої спроби, але у найгіршому випадку вам доведеться перевірити всі 100, перш ніж знайти потрібну. Щоб знайти одну річ зі 100, вам потрібно перевірити 100 речей (або щоб знайти одну річ серед <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> речей, вам потрібно зробити перевірку <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> разів). Для цього завдання велика <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span></span></span></span></span>-нотація записується як <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mclose">)</span></span></span></span></span>. До речі, ця ж велика <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span></span></span></span></span>-нотація описує й ефективність простої системи частинок. Якщо у вас <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> частинок, вам потрібно пройти та відобразити ці частинки <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> разів.</p>
<p>Тепер подумаймо про групову поведінку, таку як зграя. Для кожного об’єкта <code>Boid</code> вам потрібно перевірити швидкість і положення кожного іншого об’єкта <code>Boid</code>, перш ніж ви зможете розрахувати його керувальну силу. Припустимо, що у вас 100 боїдів. Для боїда №1 вам потрібно перевірити 100 боїдів, для боїда №2 потрібно перевірити 100 боїдів і так далі. Всього для 100 боїдів потрібно виконати 10 000 перевірок (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mo>×</mo><mn>100</mn><mo>=</mo><mtext>10,000</mtext></mrow><annotation encoding="application/x-tex">100 \times 100 = \text{10,000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">10,000</span></span></span></span></span></span>).</p>
<p>Ви можете подумати: “Не проблема. Комп’ютери швидкі. Вони досить легко можуть виконувати 10 000 операцій”. Але що, якщо у нас 1000 боїдів? Тоді ви маєте наступне:</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>1,000</mtext><mo>×</mo><mtext>1,000</mtext><mo>=</mo><mtext>1,000,000 циклів</mtext></mrow><annotation encoding="application/x-tex">\text{1,000} \times \text{1,000} = \text{1,000,000 циклів}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">1,000</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">1,000</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">1,000,000 </span><span class="mord cyrillic_fallback">циклів</span></span></span></span></span></span></div>
<p>Це вже дещо сповільнює програму, але вона певною мірою залишається доволі керованою. А як щодо 10 000 об’єктів?</p>
<div data-type="equation" class="math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>10,000</mtext><mo>×</mo><mtext>10,000</mtext><mo>=</mo><mtext>100,000,000 циклів</mtext></mrow><annotation encoding="application/x-tex">\text{10,000} \times \text{10,000} = \text{100,000,000 циклів}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">10,000</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">10,000</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">100,000,000 </span><span class="mord cyrillic_fallback">циклів</span></span></span></span></span></span></div>
<p>Тепер все дійсно стає повільним. Дуже, дуже, дуже пові льним.</p>
<p>Помітили закономірність? Коли кількість елементів збільшується у 10 разів, тоді кількість необхідних циклів збільшується у 100 разів. Тобто, зі збільшенням кількості елементів у <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> разів, кількість необхідних циклів збільшується у <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">N \times N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> разів або <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">N^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>. У великій <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span></span></span></span></span>-нотації це записується як <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>.</p>
<p>Можливо, ви думаєте: “Не проблема. У зграї мені потрібно перевірити лише ті об’єкти, які поруч до поточного боїда. Отже, навіть якщо у мене 1000 боїдів, я можу просто переглянути, скажімо, по 5 найближчих об’єктів до кожного з них і тоді мені потрібно лише 5000 циклів обчислення”. Ви спиняєтеся на мить і починаєте думати: “Тож для кожного боїда мені просто потрібно перевірити всі об’єкти й знайти 5 найближчих і все в порядку!” Побачили заковику? Навіть якщо ви хочете переглянути лише найближчі елементи, єдиний спосіб дізнатися, які з них найближчі — це перевірити їх усіх.</p>
<p>Чи є якийсь інший спосіб?</p>
<h3 id="spatial-subdivisions"><a class="heading-link" href="#spatial-subdivisions">Просторовий поділ</a></h3>
<p>У своїй статті 2000 року <a href="https://www.red3d.com/cwr/papers/2000/pip.pdf" target="_blank" rel="noopener">“Interaction with Groups of Autonomous Characters”,</a> Рейнольдс (сюрприз, сюрприз) запропонував метод для оптимізації алгоритмів зграй та інших групових дій, який називається <strong>bin-lattice spatial subdivision</strong> (часто скорочено називають <em>binning</em>) — поділ простору двовимірною сіткою. Цей метод полягає у розділенні простору симуляції на сітку мен ших клітин або комірок.</p>
<p>Уявіть, що полотно поділено на сітку з 10 рядків і 10 стовпців, що загалом складає 100 клітинок (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo>×</mo><mn>10</mn><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">10 \times 10 = 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">100</span></span></span></span></span>). Тепер припустимо, що у вас є 2000 боїдів — число досить мале для ваших реальних бажань, але достатньо велике, щоб програма працювала доволі повільно (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>2,000</mtext><mo>×</mo><mtext>2,000</mtext><mo>=</mo><mtext>4,000,000 циклів)</mtext></mrow><annotation encoding="application/x-tex">\text{2,000} \times \text{2,000} = \text{4,000,000 циклів)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">2,000</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">2,000</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord text"><span class="mord">4,000,000 </span><span class="mord cyrillic_fallback">циклів</span><span class="mord">)</span></span></span></span></span></span>. У будь-який момент кожен боїд потрапляє у певну клітину сітки, як показано на малюнку 5.36. Маючи 2000 боїдів і 100 клітин, на кожну комірку в середньому припадає приблизно по 20 об’єктів (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>2,000</mtext><mo>÷</mo><mn>100</mn><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">\text{2,000} \div 100 = 20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">2,000</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">÷</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">20</span></span></span></span></span>).</p>
<figure>
  <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1591&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="./static/0a823d53b5fa690bfbaba596c8175c7b/1bd81/05_steering_40.webp 576w,./static/0a823d53b5fa690bfbaba596c8175c7b/224b8/05_steering_40.webp 1152w,./static/0a823d53b5fa690bfbaba596c8175c7b/1c20a/05_steering_40.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="/static/0a823d53b5fa690bfbaba596c8175c7b/49ca6/05_steering_40.png" data-srcset="/static/0a823d53b5fa690bfbaba596c8175c7b/491a2/05_steering_40.png 576w,./static/0a823d53b5fa690bfbaba596c8175c7b/a3b84/05_steering_40.png 1152w,./static/0a823d53b5fa690bfbaba596c8175c7b/49ca6/05_steering_40.png 2304w" alt="Малюнок 5.36: Квадратне полотно, повне об’єктів, поділене на сітку квадратних клітин"/></picture><noscript><picture><source type="image/webp" srcSet="/static/0a823d53b5fa690bfbaba596c8175c7b/1bd81/05_steering_40.webp 576w,./static/0a823d53b5fa690bfbaba596c8175c7b/224b8/05_steering_40.webp 1152w,./static/0a823d53b5fa690bfbaba596c8175c7b/1c20a/05_steering_40.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="/static/0a823d53b5fa690bfbaba596c8175c7b/49ca6/05_steering_40.png" srcSet="/static/0a823d53b5fa690bfbaba596c8175c7b/491a2/05_steering_40.png 576w,./static/0a823d53b5fa690bfbaba596c8175c7b/a3b84/05_steering_40.png 1152w,./static/0a823d53b5fa690bfbaba596c8175c7b/49ca6/05_steering_40.png 2304w" alt="Малюнок 5.36: Квадратне полотно, повне об’єктів, поділене на сітку квадратних клітин"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
  <figcaption>Малюнок 5.36: Квадратне полотно, повне об’єктів, поділене на сітку квадратних клітин</figcaption>
</figure>
<p>Тепер скажемо, що для застосування правил поведінки зграї для кожного боїда, вам потрібно переглянути лише ті об’єкти, які знаходяться у клітині цього боїда. Із середнім значенням у 20 боїдів на клітину, кожна комірка потребує 400 операцій (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mo>×</mo><mn>20</mn><mo>=</mo><mn>400</mn></mrow><annotation encoding="application/x-tex">20 \times 20 = 400</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">20</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">20</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">400</span></span></span></span></span>), а для 100 клітин це загалом 40 000 (<span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>400</mn><mo>×</mo><mn>100</mn><mo>=</mo><mtext>40,000</mtext></mrow><annotation encoding="application/x-tex">400 \times 100 = \text{40,000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">400</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">40,000</span></span></span></span></span></span>). Це значна економія порівняно з 4 000 000 цик лів!</p>
<p>Для реалізації алгоритму двовимірного просторового поділу у p5.js мені знадобляться кілька масивів. Перший масив потрібен для зберігання всіх боїдів, так само як у початковому прикладі флокінгу:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> boids = [];
</code></pre><div class="comment"><p></p></div></div></div>
<p>Другий — це 2D масив (перероблений з коду прикладу 5.4), який представляє клітини сітки:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> resolution = <span class="hljs-number">40</span>;
</code></pre><div class="comment"><p>Кожна клітинка має розмір 40 на 40 пікселів.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> cols = <span class="hljs-title function_">floor</span>(width / resolution);
<span class="hljs-keyword">let</span> rows = <span class="hljs-title function_">floor</span>(height / resolution);
</code></pre><div class="comment"><p>Кількість стовпців і рядків залежить від ширини та висоти сітки.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> grid = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(cols);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; grid.<span class="hljs-property">length</span>; i++) {
  grid[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(rows);
}
</code></pre><div class="comment"><p>Створення 2D масиву.</p></div></div></div>
<p>Кожне значення у 2D масиві сітки саме по собі буде також масивом, який міститиме посилання на об’єкти <code>Boid</code>, які наразі знаходяться у цій комірці сітки. Якщо ви ведете облік, то це масив у масиві всередині масиву:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cols; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; rows; j++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">      grid[i][j] = [];
</code></pre><div class="comment"><p>Масив для кожної клітинки сітки.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Кожного кадру анімації, при виконанні функції <code>draw()</code>, масив кожної комірки сітки спочатку очищається. Потім кожен боїд додається у відповідну комірку згідно зі своїм положенням. Таким чином, під час руху боїдів, значення коміро к з ними постійно оновлюється:</p>
<div class="snip-below">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cols; i++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; rows; j++) {
      grid[i][j] = [];
    }
  }
</code></pre><div class="comment"><p>У кожному кадрі сітка скидається до порожніх масивів.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> boid <span class="hljs-keyword">of</span> flock.<span class="hljs-property">boids</span>) {
</code></pre><div class="comment"><p>Розміщення кожного боїда у відповідній комірці сітки.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> column = <span class="hljs-title function_">floor</span>(boid.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> / resolution);
    <span class="hljs-keyword">let</span> row = <span class="hljs-title function_">floor</span>(boid.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> / resolution);
</code></pre><div class="comment"><p>Знаходження правильного стовпця і рядка.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    column = <span class="hljs-title function_">constrain</span>(column, <span class="hljs-number">0</span>, cols - <span class="hljs-number">1</span>);
    row = <span class="hljs-title function_">constrain</span>(row, <span class="hljs-number">0</span>, rows - <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p>Обмеження межами масиву.</p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    grid[column][row].<span class="hljs-title function_">push</span>(boid);
</code></pre><div class="comment"><p>Додавання боїду.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Нарешті, коли у боїда настає час перевірити своїх сусідів, він може переглянути лише тих, які знаходяться в його конкретній комірці.</p>
<div data-type="example">
  <h3 id="example-512-bin-lattice-spatial-subdivision"><a class="heading-link" href="#example-512-bin-lattice-spatial-subdivision">Приклад 5.12: Рівномірний поділ простору за допомогою сітки</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/example_5_9_flocking_with_binning"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/QXONgLiJ0" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">run</span>(<span class="hljs-params">boids</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> column = <span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> / resolution);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> row = <span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> / resolution);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    column = <span class="hljs-title function_">constrain</span>(column, <span class="hljs-number">0</span>, cols - <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    row = <span class="hljs-title function_">constrain</span>(row, <span class="hljs-number">0</span>, rows - <span class="hljs-number">1</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> neighbors = grid[column][row];
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">flock</span>(neighbors);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">update</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borders</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
</code></pre><div class="comment"><p>Перевірятимуться лише боїди з тої самої комірки. Перегляньте онлайн-код, щоб дізнатися, як включаються також і сусідні клітинки.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тут я охопив лише основи алгоритму просторого поділу. На практиці кожен бої д також повинен перевіряти й об’єкти у сусідніх клітинах (вгорі, внизу, ліворуч, праворуч та по діагоналях), так само як і свою комірку. Щоб дізнатися, як це робиться, перегляньте повний код на вебсайті книги. Однак навіть із цими додатковими перевірками алгоритм усе одно набагато ефективніший, ніж перевірка кожного окремого об’єкта.</p>
<p>Однак цей підхід все ще має недоліки. Наприклад, що, якщо всі боїди зберуться у кутку і житимуть в одній комірці? Хіба це не поверне мене знову до перевірки всіх елементів? Насправді просторовий поділ сіткою найкраще підходить для ситуацій, коли елементи рівномірно розподілені по всьому полотну. Однак, структура даних, відома як <strong>квадродерево</strong>, може опрацьовувати нерівномірно розподілені системи, запобігаючи найгіршому сценарію, коли всі елементи скупчуються в одній комірці.</p>
<p>Квадродерево або дерево квадрантів розширює стратегію просторового поділу, динамічно адаптуючи сітку в залежності від розподілу елементів. Замість фіксованої сітки квадродерево починається з однієї великої комірки, яка охоплює весь простір. Якщо в цій комірці вже знаходиться забагато елементів, вона розбивається на чотири менші комірки. Цей процес може повторюватися для кожної нової комірки, яка стає занадто переповненою, створюючи гнучку сітку, яка надає кращу роздільну здатність, там і коли це необхідно.</p>
<div data-type="example">
  <h3 id="example-513-quadtree"><a class="heading-link" href="#example-513-quadtree">Приклад 5.13: Квадродерево</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/5_11_quadtree_part_1"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/J5XVww9xQ" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<p>Структура даних квадродерева є ключовою для алгоритму Барнса-Хата, на який я посилався під час побудови симуляції N тіл у <a href="/forces#section-forces">Розділі 2</a>. Під час обчислення гравітаційних сил, цей метод використовує дерево квадрантів для апроксимації групи тіл в одне. Це суттєво зменшує кількість необхідних обчислень, дозволяючи симуляціям з великою кількістю тіл працювати ефективніше. Ви можете дізнатися більше про створення квадродерева і його застосування до системи флокінгу у відео <a href="https://thecodingtrain.com/quadtree" target="_blank" rel="noopener">Coding Challenge #98 на вебсайті Coding Train</a>.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-520"><a class="heading-link" href="#exercise-520">Вправа 5.20</a></h3>
  <p>Розширте приклад 5.12, додавши рівномірний поділ простору для флокінгу із використанням дерева квадрантів.</p>
</div>
<h3 id="more-optimization-tricks"><a class="heading-link" href="#more-optimization-tricks">Ще кілька хитрощів оптимізації</a></h3>
<p>Поки я тут, ось ще кілька порад, пов’язаних із підтримкою вашого коду в чудовій і швидкій формі:</p>
<ul>
  <li>Використовуйте квадрат магнітуди (іноді кажуть квадрат відстані).</li>
  <li>Використовуйте синуси й косинуси з пошукових таблиць.</li>
  <li>Не створюйте безліч непотрібних об’єктів <code>p5.Vector</code>.</li>
</ul>
<p>Кожну з цих порад докладно описано далі.</p>
<h4 id="use-the-magnitude-squared">Використовуйте квадрат магнітуди</h4>
<p>Що таке квадрат магнітуди й коли його слід використовувати? Згадайте, як обчислюється магнітуда вектора:</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mag</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">return</span> <span class="hljs-title function_">sqrt</span>(x * x + y * y);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Магнітуда потребує добування квадратного кореня. Так і повинно бути! Зрештою, якщо вам потрібна магнітуда вектора, ви повинні розв’язати теорему Піфагора (ми робили це в <a href="/vectors#section-vectors">Розділі 1</a>). Однак, якщо ви можете якось уникнути добування квадратного кореня, ваш код працюватиме швидше.</p>
<p>Скажімо, ви просто хочете знати <em>відносну</em> магнітуду деякого вектора <code>v</code>. Наприклад, чи ця магнітуда більша за 10?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">if</span> (v.<span class="hljs-title function_">mag</span>() &gt; <span class="hljs-number">10</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-comment">/* Якісь дії! */</span>
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Цей запис еквівалентний наступному:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">if</span> (v.<span class="hljs-title function_">magSq</span>() &gt; <span class="hljs-number">100</span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-comment">/* Якісь дії! */</span>
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>А як розраховується квадрат магнітуди?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">magSq</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">return</span> x * x + y * y;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Обчислюється так само як магнітуда, але без квадратного кореня. У випадку з одним вектором використання методу <code>magSq()</code> замість <code>mag()</code> ніколи суттєво не покращить продуктивність програми. Але якщо ви обчислюєте магнітуду тисяч векторів під час кожного кадру анімації, робота з квадратом магнітуди може допомогти вашому коду працювати трохи швидше.</p>
<h4 id="calculate-sine-and-cosine-lookup-tables">Використовуйте синуси й косинуси з пошукових таблиць</h4>
<p>Знаходження квадратного кореня не єдина математична операція, яка обчислюється повільно. Тригонометричні функції, такі як синус, косинус і тангенс, також повільні. Якщо вам потрібно лише окреме значення синуса чи косинуса тут або там у вашому коді, ви ніколи не зіткнетеся з проблемою. Але що, якщо у вас буде щось подібне?</p>
<div class="avoid-break">
  <div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-title function_">print</span>(<span class="hljs-title function_">sin</span>(<span class="hljs-variable constant_">PI</span>));
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
</div>
<p>Певно, це абсолютно безглуздий фрагмент коду, який ви б ніколи не написали. Але він ілюструє певну думку: якщо ви обчислюєте синус числа <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span> 10 000 разів, чому б просто не обчислити його один раз, зберегти це значення і звертатися до нього, коли це потрібно?</p>
<p> Це принцип, що лежить в основі <strong>таблиці пошу ку</strong> синусів і косинусів. Замість виклику функцій синуса і косинуса у вашому коді щоразу, коли вони вам потрібні, ви можете створити масив, який зберігає результати синусів й косинусів для різних кутів від <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span> до <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">2\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span> та просто отримувати попередньо обчислені значення, коли вони знадобляться. Наприклад, ось два масиви, які зберігають значення синусів і косинусів для кожного цілого кута від <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0</span></span></span></span></span> до <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>359</mn></mrow><annotation encoding="application/x-tex">359</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">359</span></span></span></span></span> градусів. Для спрощення я використовую тут режим обчислення кутів у градусах <code>angleMode(DEGREES)</code>, але ту саму техніку можна застосувати з радіанами:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-title function_">angleMode</span>(<span class="hljs-variable constant_">DEGREES</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> sinvalues = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> cosvalues = [];
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">360</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  sinvalues[i] = <span class="hljs-title function_">sin</span>(i);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  cosvalues[i] = <span class="hljs-title function_">cos</span>(i);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>А що, якщо тепер вам потрібно надрукувати синус кута <span data-type="equation" class="math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal" style="margin-right:0.03588em">π</span></span></span></span></span> (або 180 градусів)?</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> angle = <span class="hljs-number">180</span>;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-title function_">print</span>(sinvalues[angle]);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Суть у тому, що пошук попередньо обчисленого значення з масиву надзвичайно швидкий порівняно із безпосереднім виконанням операції синуса чи косинуса.</p>
<div data-type="example">
  <h3 id="example-514-sincos-lookup-table"><a class="heading-link" href="#example-514-sincos-lookup-table">Пр иклад 5.14: Таблиця пошуку синусів і косинусів</a></h3>
  <figure>
    <div class="not-prose clear-both my-4 overflow-hidden rounded border bg-gray-100" style="max-width:1152px"><div class="relative overflow-hidden rounded-t bg-white"><!-- <div class="absolute left-[50%] top-[50%] -translate-x-[50%] -translate-y-[50%] ">Loading sketch ...</div> --><iframe class="w-full border-none transition-opacity opacity-1000" style="aspect-ratio:2.667" loading="lazy" src="./examples/05_steering/example_5_12_sine_cosine_lookup_table"></iframe></div><div class="flex items-center justify-between border-t"><div class="flex"><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-[15px] w-[15px]" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><span class="ml-1.5">Reset</span></button><button class="flex items-center border-r px-2.5 py-1.5 text-sm hover:bg-gray-200"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" class="h-4 w-4" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-1">Pause</span></button></div><a href="https://editor.p5js.org/natureofcode/sketches/uqRJyVq8g" target="_blank" rel="noreferrer" class="flex items-center px-2.5 text-[0.8rem] hover:underline">Open in Web Editor<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="ml-1 text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></div></div>
    <figcaption></figcaption>
  </figure>
</div>
<p>Код, що стосується прикладу 5.14, покращує початкові фрагменти, включаючи змінну для точності таблиці пошуку, що дозволяє їй зберігати значення з кроком менше одного градуса.</p>
<h4 id="dont-make-gazillions-of-unnecessary-p5vector-objects">Не створюйте безліч непотрібних об’єктів <code>p5.Vector</code></h4>
<p>У будь-якій програмі кожен об’єкт, який ви створюєте, займає деякий обсяг пам’яті комп’ютера. Це не буде викликати проблеми з кількома об’єктами, але якщо програма генерує велику кількість об’єктів, особливо в циклах або з часом, це може сповільнити продуктивність. Іноді виявляється, що не всі об’єкти є дійсно необхідними.</p>
<p>Мушу визнати, що я можливо є найбільшим порушником, коли мова йде про створення надмірних об’єктів. Для написання чітких і зрозумілих прикладів я часто вирішую створювати додаткові об’єкти типу <code>p5.Vector</code>, коли це абсолютно не потрібно. Здебільшого це зовсім не проблема. Але іноді може нею бути. Подивіться на цей приклад:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> mouse = <span class="hljs-title function_">createVector</span>(mouseX, mouseY);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    v.<span class="hljs-title function_">seek</span>(mouse);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Скажімо, у масиві <code>vehicles</code> 1000 об’єктів. Це означає, що я також створюю 1000 нових об’єктів типу <code>p5.Vector</code> для позиції курсора мишки кожного разу під час виконання функції <code>draw()</code>. На будь-якому сучасному ноутбуці або настільному комп’ютері ця програма, швидше за все, не викличе скарги, не працюватиме повільно і не матиме жодних проблем. Все-таки сучасні комп’ютери мають велику кількість оперативної пам’яті, тож JavaScript зможе створити й видалити 1 000 тимчасових об’єктів без жодних проблем.</p>
<p>Однак якщо кількість об’єктів стає більшою, що може легко трапитися, це майже напевно викличе проблему. Отже, вам слід шукати способи зменшити кількість створення об’єктів типу <code>p5.Vector</code>. Для цього випадку є просте рішення:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">let</span> mouse = <span class="hljs-title function_">createVector</span>(mouseX, mouseY);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    v.<span class="hljs-title function_">seek</span>(mouse);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер я створюю лише 1 вектор замість 1000. Що ще краще, я можу зробити цей вектор глобальною змінною, а потім просто змінювати значення для властивостей <code>x</code> і <code>y</code> за допомогою методу <code>set()</code>:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">let</span> mouse;
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  mouse = <span class="hljs-title function_">createVector</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  mouse.<span class="hljs-title function_">set</span>(mouseX, mouseY);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> vehicles) {
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    v.<span class="hljs-title function_">seek</span>(mouse);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">  }
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">}
</code></pre><div class="comment"><p></p></div></div></div>
<p>Тепер я ніколи не створюю новий об’єкт <code>p5.Vector</code>, а просто використовую один і той самий об’єкт у всій програмі!</p>
<p>Я вже зізнався, що є головним порушником цього правила. Тож у прикладах книги ви знайдете багато можливостей зменшити кількість тимчасових об’єктів. Наприклад, ось уривок методу <code>seek()</code> із цього розділу:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    desired.<span class="hljs-title function_">normalize</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    desired.<span class="hljs-title function_">mult</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> steer = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(desired,<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
</code></pre><div class="comment"><p>Створення нового вектора для збереження керувальної сили.</p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    steer.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">return</span> steer;
</code></pre><div class="comment"><p></p></div></div></div>
<p>Бачите, як я створив два векторних об’єкти? Спочатку я обчислюю бажаний вектор швидкості, а потім керувальну силу. Щоб зробити це більш ефективно, я міг би переписати це інакше, щоб створювати лише один вектор:</p>
<div class="codesplit callout not-prose" data-code-language="javascript"><div class="pair"><pre><code class="hljs code language-javascript">    <span class="hljs-keyword">let</span> desired = p5.<span class="hljs-property">Vector</span>.<span class="hljs-title function_">sub</span>(target, <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>);
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    desired.<span class="hljs-title function_">normalize</span>();
</code></pre><div class="comment"><p></p></div></div><div class="pair"><pre><code class="hljs code language-javascript">    desired.<span class="hljs-title function_">mult</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxspeed</span>);
</code></pre><div class="comment"><p></p></div></div><div class="bold pair split"><pre><code class="hljs code language-javascript">    desired.<span class="hljs-title function_">sub</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>);
    desired.<span class="hljs-title function_">limit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxforce</span>);
    <span class="hljs-keyword">return</span> desired;
</code></pre><div class="comment"><p>Розрахування керувальної сили у потрібному векторі.</p></div></div></div>
<p>Насправді мені не потрібен другий вектор під назвою <code>steer</code>. Я можу просто повторно використати векторний об’єкт <code>desired</code> і перетворити його на керувальну силу, віднявши <code>velocity</code>. Я не робив цього у своєму прикладі, оскільки це робить код більш заплутаним і менш читабельним. Але в деяких випадках такі зміни можуть підвищити ефективність.</p>
<div data-type="exercise" class="callout">
  <h3 id="exercise-521"><a class="heading-link" href="#exercise-521">Вправа 5.21</a></h3>
  <p>Усуньте якомога більше тимчасових об’єктів <code>p5.Vector</code> із прикладу зі зграєю. Також, де це можливо, використовуйте метод <code>magSq()</code>.</p>
</div>
<div data-type="project" class="callout">
  <h3 id="the-ecosystem-project-6"><a class="heading-link" href="#the-ecosystem-project-6">Проєкт “Екосистема”</a></h3>
  <p>Використовуйте концепцію керувальних сил для керування поведінкою створінь у вашій екосистемі. Ось деякі ідеї та можливості:</p>
  <ul>
    <li>Створюйте зграї створінь.</li>
    <li>Використовуйте для створінь пошукову поведінку, щоб шукати їжу (для погоні за рухомою здобиччю розгляньте переслідування).</li>
    <li>Використовуйте поле потоків для налаштування середовища екосистеми. Наприклад, як поводиться ваша система, якщо створіння живуть у текучій річці?</li>
    <li>Створіть створіння з безліччю керувальних поведінок (розумну кількість, яку ви зможете додати). Подумайте про способи зміни ваги поведінок, щоб ви могли збільшувати чи зменшувати їх вплив, змінюючи значення на льоту. Як встановлюються початкові ваги для поведінок створінь? Які правила керують зміною ваги з часом?</li>
    <li>Складні системи можуть бути вкладеними. Чи можете ви зі зграї боїдів створити єдину істоту? І чи можете потім створити зграю таких створінь?</li>
    <li>Складні системи можуть мати пам’ять і бути адаптивними. Чи може історія вашої екосистеми вплинути на її поведінку у поточному стані? (Це може бути рушійною причиною того, як істоти регулюють свої ваги поведінкових сил.)</li>
  </ul>
  <figure>
    <div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:2304px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1420&#x27; width=&#x27;2304&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#b8b8b8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/4b231f70bc9fc08bccdd39b796e5f103/be6fc/05_steering_41.webp 576w,./static/4b231f70bc9fc08bccdd39b796e5f103/7c4ba/05_steering_41.webp 1152w,./static/4b231f70bc9fc08bccdd39b796e5f103/2e9c6/05_steering_41.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" data-src="/static/4b231f70bc9fc08bccdd39b796e5f103/43bff/05_steering_41.png" data-srcset="/static/4b231f70bc9fc08bccdd39b796e5f103/09264/05_steering_41.png 576w,./static/4b231f70bc9fc08bccdd39b796e5f103/8a8ae/05_steering_41.png 1152w,./static/4b231f70bc9fc08bccdd39b796e5f103/43bff/05_steering_41.png 2304w" alt=""/></picture><noscript><picture><source type="image/webp" srcSet="/static/4b231f70bc9fc08bccdd39b796e5f103/be6fc/05_steering_41.webp 576w,./static/4b231f70bc9fc08bccdd39b796e5f103/7c4ba/05_steering_41.webp 1152w,./static/4b231f70bc9fc08bccdd39b796e5f103/2e9c6/05_steering_41.webp 2304w" sizes="(min-width: 2304px) 2304px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2304px) 2304px, 100vw" decoding="async" loading="lazy" src="/static/4b231f70bc9fc08bccdd39b796e5f103/43bff/05_steering_41.png" srcSet="/static/4b231f70bc9fc08bccdd39b796e5f103/09264/05_steering_41.png 576w,./static/4b231f70bc9fc08bccdd39b796e5f103/8a8ae/05_steering_41.png 1152w,./static/4b231f70bc9fc08bccdd39b796e5f103/43bff/05_steering_41.png 2304w" alt=""/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div>
    <figcaption></figcaption>
  </figure>
</div>
</section>
<hr/><section class="not-prose flex w-full justify-between"><div><a class="group block" href="./particles.html"><p class="text-gray-500">Попередній розділ</p><span class="text-lg font-semibold group-hover:underline">← <!-- -->4. Системи частинок</span></a></div><div><a class="group block text-right" href="./physics-libraries.html"><p class="text-gray-500">Наступний розділм</p><span class="text-lg font-semibold group-hover:underline">6. Фізичні бібліотеки<!-- --> →</span></a></div></section></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script src="./assets/js/main.js"></script></body></html>